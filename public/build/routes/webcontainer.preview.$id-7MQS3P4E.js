import{a as h}from"/build/_shared/chunk-JW4P2HUS.js";import{a as f}from"/build/_shared/chunk-7VSEXQFG.js";import{a as m,j as d}from"/build/_shared/chunk-TGGDRRNK.js";import{e as a}from"/build/_shared/chunk-XDMRC4Q6.js";var v=a(h(),1);var e=a(m(),1),l=a(f(),1),y="preview-updates";function p(){let{previewId:o}=d(),r=(0,e.useRef)(null),t=(0,e.useRef)(),[n,w]=(0,e.useState)(""),c=(0,e.useCallback)(()=>{r.current&&n&&(r.current.src="",requestAnimationFrame(()=>{r.current&&(r.current.src=n)}))},[n]),s=(0,e.useCallback)(()=>{t.current&&n&&t.current.postMessage({type:"preview-ready",previewId:o,url:n,timestamp:Date.now()})},[o,n]);return(0,e.useEffect)(()=>{typeof window<"u"&&typeof window.BroadcastChannel=="function"?(t.current=new window.BroadcastChannel(y),t.current.onmessage=i=>{i.data.previewId===o&&(i.data.type==="refresh-preview"||i.data.type==="file-change")&&c()}):t.current=void 0;let u=`https://${o}.local-credentialless.webcontainer-api.io`;return w(u),r.current&&(r.current.src=u),s(),()=>{t.current?.close()}},[o,c,s]),(0,l.jsx)("div",{className:"w-full h-full",children:(0,l.jsx)("iframe",{ref:r,title:"WebContainer Preview",className:"w-full h-full border-none",sandbox:"allow-scripts allow-forms allow-popups allow-modals allow-storage-access-by-user-activation allow-same-origin",allow:"cross-origin-isolated",loading:"eager",onLoad:s})})}export{p as default};
