import{a as d,b as _,c as b,d as w}from"/build/_shared/chunk-TETG2QWD.js";import{m as h,s as f}from"/build/_shared/chunk-5Z4LRYQI.js";import{a as s}from"/build/_shared/chunk-AJH6SR5C.js";import"/build/_shared/chunk-XDMRC4Q6.js";var m=null,y=()=>{if(!m&&typeof window<"u")try{import("/build/_shared/logs-YAJ5TQNO.js").then(({logStore:o})=>{m=o}).catch(()=>{})}catch{}return m},c=class{constructor(e){this._capacity=e;this._buffer=new Array(e)}_buffer;_head=0;_tail=0;_size=0;push(e){this._buffer[this._tail]=e,this._tail=(this._tail+1)%this._capacity,this._size<this._capacity?this._size++:this._head=(this._head+1)%this._capacity}toArray(){let e=[],t=this._head;for(let r=0;r<this._size;r++){let i=this._buffer[t];i!==void 0&&e.push(i),t=(t+1)%this._capacity}return e}clear(){this._buffer=new Array(this._capacity),this._head=0,this._tail=0,this._size=0}getSize(){return this._size}},p=class{_logs;_errors;_networkRequests;_userActions;_terminalLogs;_config;_isCapturing=!1;_isInitialized=!1;_originalConsoleLog;_originalConsoleError;_originalConsoleWarn;_originalFetch=null;_boundErrorHandler;_boundRejectionHandler;_boundUnloadHandler;_terminalLogQueue=[];_terminalLogTimer=null;_seenObjects=new WeakSet;constructor(e={}){this._config={enabled:!1,maxEntries:1e3,captureConsole:!0,captureNetwork:!0,captureErrors:!0,debounceTerminal:100,...e},this._logs=new c(this._config.maxEntries),this._errors=new c(this._config.maxEntries),this._networkRequests=new c(this._config.maxEntries),this._userActions=new c(this._config.maxEntries),this._terminalLogs=new c(this._config.maxEntries),this._originalConsoleLog=console.log,this._originalConsoleError=console.error,this._originalConsoleWarn=console.warn,this._boundErrorHandler=this._handleError.bind(this),this._boundRejectionHandler=this._handleUnhandledRejection.bind(this),this._boundUnloadHandler=this._cleanup.bind(this),typeof window<"u"&&window.addEventListener("beforeunload",this._boundUnloadHandler)}initialize(){if(!this._isInitialized)try{if(typeof window>"u")return;this._isInitialized=!0,this._config.enabled&&this.startCapture(),s.info("Debug logger initialized")}catch(e){s.error("Failed to initialize debug logger:",e)}}startCapture(){if(!this._isCapturing)try{this._isCapturing=!0,this._config.enabled=!0,this._config.captureConsole&&this._interceptConsole(),this._config.captureErrors&&this._interceptErrors(),this._config.captureNetwork&&this._interceptNetwork(),s.info("Debug logging started")}catch(e){s.error("Failed to start debug capture:",e),this._isCapturing=!1}}stopCapture(){if(this._isCapturing)try{this._isCapturing=!1,this._config.enabled=!1,this._restoreConsole(),this._restoreErrors(),this._restoreNetwork(),this._terminalLogTimer&&(clearTimeout(this._terminalLogTimer),this._terminalLogTimer=null,this._flushTerminalLogs()),s.info("Debug logging stopped")}catch(e){s.error("Failed to stop debug capture:",e)}}enableDebugMode(){this._config.enabled=!0,this._isInitialized?this._isCapturing||this.startCapture():this.initialize()}disableDebugMode(){this.stopCapture()}getStatus(){return{initialized:this._isInitialized,capturing:this._isCapturing,enabled:this._config.enabled}}updateConfig(e){let t=this._isCapturing;if(t&&this.stopCapture(),this._config={...this._config,...e},e.maxEntries&&e.maxEntries!==this._config.maxEntries){let r=this._logs.toArray(),i=this._errors.toArray(),n=this._networkRequests.toArray(),l=this._userActions.toArray(),u=this._terminalLogs.toArray();this._logs=new c(this._config.maxEntries),this._errors=new c(this._config.maxEntries),this._networkRequests=new c(this._config.maxEntries),this._userActions=new c(this._config.maxEntries),this._terminalLogs=new c(this._config.maxEntries),r.forEach(a=>this._logs.push(a)),i.forEach(a=>this._errors.push(a)),n.forEach(a=>this._networkRequests.push(a)),l.forEach(a=>this._userActions.push(a)),u.forEach(a=>this._terminalLogs.push(a))}t&&this._config.enabled&&this.startCapture()}_cleanup(){this.stopCapture(),typeof window<"u"&&window.removeEventListener("beforeunload",this._boundUnloadHandler)}_interceptConsole(){let e=this;console.log=function(...t){e.captureLog("info",void 0,t),e._originalConsoleLog.apply(console,t)},console.error=function(...t){e.captureLog("error",void 0,t),e._originalConsoleError.apply(console,t)},console.warn=function(...t){e.captureLog("warn",void 0,t),e._originalConsoleWarn.apply(console,t)}}_restoreConsole(){console.log=this._originalConsoleLog,console.error=this._originalConsoleError,console.warn=this._originalConsoleWarn}_interceptErrors(){try{window.addEventListener("error",this._boundErrorHandler),window.addEventListener("unhandledrejection",this._boundRejectionHandler)}catch(e){s.error("Failed to intercept errors:",e)}}_restoreErrors(){try{window.removeEventListener("error",this._boundErrorHandler),window.removeEventListener("unhandledrejection",this._boundRejectionHandler)}catch(e){s.error("Failed to restore error handlers:",e)}}_interceptNetwork(){try{if(!this._originalFetch&&typeof window<"u"&&(this._originalFetch=window.fetch),!this._originalFetch)return;let e=this._originalFetch,t=this;window.fetch=async function(...r){if(!t._isCapturing)return e.apply(this,r);let i=performance.now(),[n,l]=r;try{let u=await e.apply(this,r),a=Math.round(performance.now()-i);return t._isCapturing&&t.captureNetworkRequest({timestamp:new Date().toISOString(),method:l?.method||"GET",url:typeof n=="string"?n:n.url,status:u.status,duration:a}),u}catch(u){let a=Math.round(performance.now()-i);throw t._isCapturing&&t.captureNetworkRequest({timestamp:new Date().toISOString(),method:l?.method||"GET",url:typeof n=="string"?n:n.url,duration:a,error:u instanceof Error?u.message:"Network error"}),u}}}catch(e){s.error("Failed to intercept network requests:",e)}}_restoreNetwork(){try{this._originalFetch&&typeof window<"u"&&(window.fetch=this._originalFetch)}catch(e){s.error("Failed to restore network fetch:",e)}}_handleError(e){this.captureError({timestamp:new Date().toISOString(),type:"javascript",message:e.message,stack:e.error?.stack,url:e.filename,line:e.lineno,column:e.colno,userAgent:navigator.userAgent})}_handleUnhandledRejection(e){this.captureError({timestamp:new Date().toISOString(),type:"javascript",message:e.reason?.message||"Unhandled promise rejection",stack:e.reason?.stack,userAgent:navigator.userAgent})}captureLog(e,t,r=[]){if(this._isCapturing)try{let i={timestamp:new Date().toISOString(),level:e,scope:t,message:this._formatMessage(r),data:r.length===1&&typeof r[0]=="object"?r[0]:void 0};this._logs.push(i)}catch(i){console.error("Debug logger failed to capture log:",i)}}_formatMessage(e){return this._seenObjects=new WeakSet,e.map(t=>{if(typeof t=="object"&&t!==null)try{return JSON.stringify(t,this._jsonReplacer.bind(this),2)}catch{return"[Object]"}return String(t)}).join(" ")}_jsonReplacer(e,t){if(typeof t=="object"&&t!==null){if(this._seenObjects.has(t))return"[Circular]";this._seenObjects.add(t)}return t}captureError(e){try{this._errors.push(e)}catch(t){console.error("Debug logger failed to capture error:",t)}}captureNetworkRequest(e){try{this._networkRequests.push(e)}catch(t){console.error("Debug logger failed to capture network request:",t)}}captureUserAction(e,t,r){if(this._isCapturing)try{let i={timestamp:new Date().toISOString(),action:e,target:t,data:r};this._userActions.push(i)}catch(i){console.error("Debug logger failed to capture user action:",i)}}captureTerminalLog(e){try{this._config.debounceTerminal>0?(this._terminalLogQueue.push(e),this._terminalLogTimer&&clearTimeout(this._terminalLogTimer),this._terminalLogTimer=setTimeout(()=>{this._flushTerminalLogs()},this._config.debounceTerminal)):this._terminalLogs.push(e)}catch(t){console.error("Debug logger failed to capture terminal log:",t)}}_flushTerminalLogs(){try{for(;this._terminalLogQueue.length>0;){let e=this._terminalLogQueue.shift();e&&this._terminalLogs.push(e)}this._terminalLogTimer=null}catch(e){console.error("Debug logger failed to flush terminal logs:",e)}}async generateDebugLog(){try{let e=this._config.enabled;e||this.enableDebugMode(),this._terminalLogTimer&&(clearTimeout(this._terminalLogTimer),this._flushTerminalLogs());let[t,r,i,n]=await Promise.all([this._collectSystemInfo(),this._collectAppInfo(),Promise.resolve(this._collectPerformanceInfo()),Promise.resolve(this._collectStateInfo())]),l=await this._getLogStoreLogs(),u={timestamp:new Date().toISOString(),sessionId:this._generateSessionId(),systemInfo:t,appInfo:r,logs:[...this._logs.toArray(),...l],errors:this._errors.toArray(),networkRequests:this._networkRequests.toArray(),performance:i,state:n,userActions:this._userActions.toArray(),terminalLogs:this._terminalLogs.toArray()};return e||this.disableDebugMode(),u}catch(e){throw s.error("Failed to generate debug log:",e),e}}async _getLogStoreLogs(){try{let e=y();if(!e)try{let{logStore:r}=await import("/build/_shared/logs-YAJ5TQNO.js");return m=r,this._getLogStoreLogs()}catch{return[]}return(e.getLogs?.()||[]).slice(0,500).map(r=>({timestamp:r.timestamp,level:r.level,scope:r.category,message:r.message,data:r.details}))}catch(e){return s.warn("Failed to get logStore logs:",e),[]}}async _collectSystemInfo(){let e="Unknown";return d?e="macOS":_?e="Windows":b&&(e="Linux"),{platform:e,userAgent:navigator.userAgent,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,isMobile:w(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,cookiesEnabled:navigator.cookieEnabled,localStorageEnabled:this._testLocalStorage(),sessionStorageEnabled:this._testSessionStorage()}}async _collectAppInfo(){let e={currentView:"code",showWorkbench:!1,showTerminal:!0,artifactsCount:0,filesCount:0,unsavedFiles:0,hasActivePreview:!1};try{if(typeof window<"u"){let t=window.__bolt_workbench_store;if(t){let r=t.get?.()||{};e={currentView:r.currentView||"code",showWorkbench:r.showWorkbench||!1,showTerminal:r.showTerminal!==void 0?r.showTerminal:!0,artifactsCount:Object.keys(r.artifacts||{}).length,filesCount:Object.keys(r.files||{}).length,unsavedFiles:r.unsavedFiles?.size||0,hasActivePreview:(r.previews||[]).length>0}}}}catch{}return{version:this._getAppVersion(),buildTime:new Date().toISOString(),currentModel:this._getCurrentModel(),currentProvider:this._getCurrentProvider(),projectType:this._getProjectType(),workbenchView:e.currentView,hasActivePreview:e.hasActivePreview,unsavedFiles:e.unsavedFiles,workbenchState:e,gitInfo:await this._getGitInfo()}}_getAppVersion(){try{return import.meta.env?.VITE_APP_VERSION||"1.0.0"}catch{return"1.0.0"}}_getCurrentModel(){try{if(typeof window<"u"){let e=localStorage.getItem("bolt_current_model");if(e)return e}return h}catch{return h}}_getCurrentProvider(){try{if(typeof window<"u"){let e=localStorage.getItem("bolt_current_provider");if(e)return e}return f[0]?.name||"unknown"}catch{return f[0]?.name||"unknown"}}_getProjectType(){try{if(typeof window<"u"){let e=localStorage.getItem("bolt_project_type");if(e)return e}return"unknown"}catch{return"unknown"}}async _getGitInfo(){try{let e=await fetch("/api/system/git-info");if(e.ok){let r=await e.json();return{branch:r.local?.branch||"unknown",commit:r.local?.commitHash||"unknown",isDirty:!1,remoteUrl:r.local?.remoteUrl,lastCommit:r.local?{message:"Latest commit",date:r.local.commitTime,author:r.local.author}:void 0}}}catch{console.warn("Git info API not available, using fallback")}return this._getGitInfoFallback()}_getGitInfoFallback(){try{let e=localStorage.getItem("bolt_git_info");if(e)return JSON.parse(e);let t=import.meta.env?.VITE_GIT_BRANCH||"unknown",r=import.meta.env?.VITE_GIT_COMMIT||"unknown";return{branch:t,commit:r,isDirty:!1}}catch{return{branch:"unknown",commit:"unknown",isDirty:!1}}}_collectPerformanceInfo(){let e=performance.timing,t=performance.getEntriesByType("paint");return{navigationStart:e.navigationStart,loadTime:e.loadEventEnd-e.navigationStart,domContentLoaded:e.domContentLoadedEventEnd-e.navigationStart,firstPaint:t.find(r=>r.name==="first-paint")?.startTime,firstContentfulPaint:t.find(r=>r.name==="first-contentful-paint")?.startTime,memoryUsage:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:void 0,timing:e}}_collectStateInfo(){let e=y(),t=[];if(e)try{t=(e.getLogs?.()||[]).filter(n=>["error","warning"].includes(n.level)).slice(0,10).map(n=>({type:n.level,title:n.message.substring(0,100),source:n.category}))}catch{}let r={currentView:"code",showWorkbench:!1,showTerminal:!0,artifactsCount:0,filesCount:0};try{if(typeof window<"u"){let i=window.__bolt_workbench_store;if(i){let n=i.get?.()||{};r={currentView:n.currentView||"code",showWorkbench:n.showWorkbench||!1,showTerminal:n.showTerminal!==void 0?n.showTerminal:!0,artifactsCount:Object.keys(n.artifacts||{}).length,filesCount:Object.keys(n.files||{}).length}}}}catch{}return{currentView:r.currentView,showWorkbench:r.showWorkbench,showTerminal:r.showTerminal,artifactsCount:r.artifactsCount,filesCount:r.filesCount,alerts:t}}_testLocalStorage(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch{return!1}}_testSessionStorage(){try{return sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),!0}catch{return!1}}_generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}clearLogs(){try{this._logs.clear(),this._errors.clear(),this._networkRequests.clear(),this._userActions.clear(),this._terminalLogs.clear(),this._terminalLogQueue=[],this._terminalLogTimer&&(clearTimeout(this._terminalLogTimer),this._terminalLogTimer=null),s.info("Debug logs cleared")}catch(e){s.error("Failed to clear logs:",e)}}getMemoryStats(){let e={logs:this._logs.getSize(),errors:this._errors.getSize(),networkRequests:this._networkRequests.getSize(),userActions:this._userActions.getSize(),terminalLogs:this._terminalLogs.getSize(),total:0};return e.total=e.logs+e.errors+e.networkRequests+e.userActions+e.terminalLogs,e}},g=new p({enabled:!1,maxEntries:1e3,captureConsole:!0,captureNetwork:!0,captureErrors:!0,debounceTerminal:100});async function T(o){try{let e=await g.generateDebugLog(),r=`${v(e)}

=== DETAILED DEBUG DATA ===

${JSON.stringify(e,null,2)}`,i=new Blob([r],{type:"text/plain"}),n=URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.download=o||`bolt-debug-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n),s.info("Debug log downloaded successfully")}catch(e){s.error("Failed to download debug log:",e)}}function v(o){return["=== BOLT DIY DEBUG LOG SUMMARY ===",`Generated: ${new Date(o.timestamp).toLocaleString()}`,`Session ID: ${o.sessionId}`,"","=== SYSTEM INFORMATION ===",`Platform: ${o.systemInfo.platform}`,`Browser: ${o.systemInfo.userAgent.split(" ").slice(0,2).join(" ")}`,`Screen: ${o.systemInfo.screenResolution}`,`Mobile: ${o.systemInfo.isMobile?"Yes":"No"}`,`Timezone: ${o.systemInfo.timezone}`,"","=== APPLICATION INFORMATION ===",`Version: ${o.appInfo.version}`,`Current Model: ${o.appInfo.currentModel}`,`Current Provider: ${o.appInfo.currentProvider}`,`Project Type: ${o.appInfo.projectType}`,`Workbench View: ${o.appInfo.workbenchView}`,`Active Preview: ${o.appInfo.hasActivePreview?"Yes":"No"}`,`Unsaved Files: ${o.appInfo.unsavedFiles}`,"","=== GIT INFORMATION ===",o.appInfo.gitInfo?[`Branch: ${o.appInfo.gitInfo.branch}`,`Commit: ${o.appInfo.gitInfo.commit.substring(0,8)}`,`Working Directory: ${o.appInfo.gitInfo.isDirty?"Dirty":"Clean"}`,o.appInfo.gitInfo.remoteUrl?`Remote: ${o.appInfo.gitInfo.remoteUrl}`:"",o.appInfo.gitInfo.lastCommit?`Last Commit: ${o.appInfo.gitInfo.lastCommit.message.substring(0,50)}...`:""].filter(Boolean).join(`
`):"Git information not available","","=== SESSION STATISTICS ===",`Total Logs: ${o.logs.length}`,`Errors: ${o.errors.length}`,`Network Requests: ${o.networkRequests.length}`,`User Actions: ${o.userActions.length}`,`Terminal Logs: ${o.terminalLogs.length}`,"","=== RECENT ALERTS ===",...o.state.alerts.slice(0,5).map(t=>`${t.type.toUpperCase()}: ${t.title}`),"","=== PERFORMANCE ===",`Page Load Time: ${o.performance.loadTime}ms`,`DOM Content Loaded: ${o.performance.domContentLoaded}ms`,o.performance.memoryUsage?`Memory Usage: ${(o.performance.memoryUsage.used/1024/1024).toFixed(2)} MB`:"Memory Usage: N/A","","=== WORKBENCH STATE ===",`Current View: ${o.state.currentView}`,`Show Workbench: ${o.state.showWorkbench}`,`Show Terminal: ${o.state.showTerminal}`,`Artifacts: ${o.state.artifactsCount}`,`Files: ${o.state.filesCount}`].join(`
`)}function C(o,e="output",t){if(!(!o||o.trim().length===0))try{g.captureTerminalLog({timestamp:new Date().toISOString(),type:e,content:o.trim(),command:t})}catch(r){console.error("Failed to capture terminal log:",r)}}function k(o,e,t){try{g.captureUserAction(o,e,t)}catch(r){console.error("Failed to capture user action:",r)}}function A(){return g}function D(){g.enableDebugMode()}function R(){g.disableDebugMode()}function P(){return g.getStatus()}function x(o){g.updateConfig(o)}typeof window<"u"&&setTimeout(()=>{g.initialize()},0);export{C as captureTerminalLog,k as captureUserAction,g as debugLogger,R as disableDebugMode,T as downloadDebugLog,D as enableDebugMode,A as getDebugLogger,P as getDebugStatus,x as updateDebugConfig};
