import{a as Ao,b as vc}from"/build/_shared/chunk-AJH6SR5C.js";import{c as So,d as gc,e as ct,g as yc}from"/build/_shared/chunk-XDMRC4Q6.js";var Ht=So((EA,gr)=>{"use strict";var Dg=typeof Buffer<"u",il=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,cl=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function ll(e,t,r){r==null&&t!==null&&typeof t=="object"&&(r=t,t=void 0),Dg&&Buffer.isBuffer(e)&&(e=e.toString()),e&&e.charCodeAt(0)===65279&&(e=e.slice(1));let n=JSON.parse(e,t);if(n===null||typeof n!="object")return n;let o=r&&r.protoAction||"error",s=r&&r.constructorAction||"error";if(o==="ignore"&&s==="ignore")return n;if(o!=="ignore"&&s!=="ignore"){if(il.test(e)===!1&&cl.test(e)===!1)return n}else if(o!=="ignore"&&s==="ignore"){if(il.test(e)===!1)return n}else if(cl.test(e)===!1)return n;return ul(n,{protoAction:o,constructorAction:s,safe:r&&r.safe})}function ul(e,{protoAction:t="error",constructorAction:r="error",safe:n}={}){let o=[e];for(;o.length;){let s=o;o=[];for(let i of s){if(t!=="ignore"&&Object.prototype.hasOwnProperty.call(i,"__proto__")){if(n===!0)return null;if(t==="error")throw new SyntaxError("Object contains forbidden prototype property");delete i.__proto__}if(r!=="ignore"&&Object.prototype.hasOwnProperty.call(i,"constructor")&&Object.prototype.hasOwnProperty.call(i.constructor,"prototype")){if(n===!0)return null;if(r==="error")throw new SyntaxError("Object contains forbidden prototype property");delete i.constructor}for(let a in i){let c=i[a];c&&typeof c=="object"&&o.push(c)}}}return e}function ga(e,t,r){let n=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ll(e,t,r)}finally{Error.stackTraceLimit=n}}function Bg(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return ll(e,t,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=r}}gr.exports=ga;gr.exports.default=ga;gr.exports.parse=ga;gr.exports.safeParse=Bg;gr.exports.scan=ul});var oi=So(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.Allow=k.ALL=k.COLLECTION=k.ATOM=k.SPECIAL=k.INF=k._INFINITY=k.INFINITY=k.NAN=k.BOOL=k.NULL=k.OBJ=k.ARR=k.NUM=k.STR=void 0;k.STR=1;k.NUM=2;k.ARR=4;k.OBJ=8;k.NULL=16;k.BOOL=32;k.NAN=64;k.INFINITY=128;k._INFINITY=256;k.INF=k.INFINITY|k._INFINITY;k.SPECIAL=k.NULL|k.BOOL|k.INF|k.NAN;k.ATOM=k.STR|k.NUM|k.SPECIAL;k.COLLECTION=k.ARR|k.OBJ;k.ALL=k.ATOM|k.COLLECTION;k.Allow={STR:k.STR,NUM:k.NUM,ARR:k.ARR,OBJ:k.OBJ,NULL:k.NULL,BOOL:k.BOOL,NAN:k.NAN,INFINITY:k.INFINITY,_INFINITY:k._INFINITY,INF:k.INF,SPECIAL:k.SPECIAL,ATOM:k.ATOM,COLLECTION:k.COLLECTION,ALL:k.ALL};k.default=k.Allow});var xd=So(ce=>{"use strict";var vw=ce&&ce.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),bw=ce&&ce.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&vw(t,e,r)};Object.defineProperty(ce,"__esModule",{value:!0});ce.Allow=ce.MalformedJSON=ce.PartialJSON=ce.parseJSON=ce.parse=void 0;var he=oi();Object.defineProperty(ce,"Allow",{enumerable:!0,get:function(){return he.Allow}});bw(oi(),ce);var qo=class extends Error{};ce.PartialJSON=qo;var Jo=class extends Error{};ce.MalformedJSON=Jo;function bd(e,t=he.Allow.ALL){if(typeof e!="string")throw new TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw new Error(`${e} is empty`);return xw(e.trim(),t)}ce.parseJSON=bd;var xw=(e,t)=>{let r=e.length,n=0,o=d=>{throw new qo(`${d} at position ${n}`)},s=d=>{throw new Jo(`${d} at position ${n}`)},i=()=>(p(),n>=r&&o("Unexpected end of input"),e[n]==='"'?a():e[n]==="{"?c():e[n]==="["?l():e.substring(n,n+4)==="null"||he.Allow.NULL&t&&r-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):e.substring(n,n+4)==="true"||he.Allow.BOOL&t&&r-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):e.substring(n,n+5)==="false"||he.Allow.BOOL&t&&r-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):e.substring(n,n+8)==="Infinity"||he.Allow.INFINITY&t&&r-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):e.substring(n,n+9)==="-Infinity"||he.Allow._INFINITY&t&&1<r-n&&r-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):e.substring(n,n+3)==="NaN"||he.Allow.NAN&t&&r-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):f()),a=()=>{let d=n,m=!1;for(n++;n<r&&(e[n]!=='"'||m&&e[n-1]==="\\");)m=e[n]==="\\"?!m:!1,n++;if(e.charAt(n)=='"')try{return JSON.parse(e.substring(d,++n-Number(m)))}catch(h){s(String(h))}else if(he.Allow.STR&t)try{return JSON.parse(e.substring(d,n-Number(m))+'"')}catch{return JSON.parse(e.substring(d,e.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},c=()=>{n++,p();let d={};try{for(;e[n]!=="}";){if(p(),n>=r&&he.Allow.OBJ&t)return d;let m=a();p(),n++;try{let h=i();d[m]=h}catch(h){if(he.Allow.OBJ&t)return d;throw h}p(),e[n]===","&&n++}}catch{if(he.Allow.OBJ&t)return d;o("Expected '}' at end of object")}return n++,d},l=()=>{n++;let d=[];try{for(;e[n]!=="]";)d.push(i()),p(),e[n]===","&&n++}catch{if(he.Allow.ARR&t)return d;o("Expected ']' at end of array")}return n++,d},f=()=>{if(n===0){e==="-"&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(m){if(he.Allow.NUM&t)try{return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch{}s(String(m))}}let d=n;for(e[n]==="-"&&n++;e[n]&&",]}".indexOf(e[n])===-1;)n++;n==r&&!(he.Allow.NUM&t)&&o("Unterminated number literal");try{return JSON.parse(e.substring(d,n))}catch{e.substring(d,n)==="-"&&o("Not sure what '-' is");try{return JSON.parse(e.substring(d,e.lastIndexOf("e")))}catch(h){s(String(h))}}},p=()=>{for(;n<r&&` 
\r	`.includes(e[n]);)n++};return i()},ww=bd;ce.parse=ww});var ic=So((yo,ac)=>{(function(e,t){typeof yo=="object"&&typeof ac=="object"?ac.exports=t():typeof define=="function"&&define.amd?define([],t):typeof yo=="object"?yo.bowser=t():e.bowser=t()})(yo,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(n,o,s){r.o(n,o)||Object.defineProperty(n,o,{enumerable:!0,get:s})},r.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,o){if(1&o&&(n=r(n)),8&o||4&o&&typeof n=="object"&&n&&n.__esModule)return n;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:n}),2&o&&typeof n!="string")for(var i in n)r.d(s,i,function(a){return n[a]}.bind(null,i));return s},r.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(o,"a",o),o},r.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},r.p="",r(r.s=90)}({17:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(18),o=function(){function s(){}return s.getFirstMatch=function(i,a){var c=a.match(i);return c&&c.length>0&&c[1]||""},s.getSecondMatch=function(i,a){var c=a.match(i);return c&&c.length>1&&c[2]||""},s.matchAndReturnConst=function(i,a,c){if(i.test(a))return c},s.getWindowsVersionName=function(i){switch(i){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},s.getMacOSVersionName=function(i){var a=i.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(a.push(0),a[0]===10)switch(a[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},s.getAndroidVersionName=function(i){var a=i.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(a.push(0),!(a[0]===1&&a[1]<5))return a[0]===1&&a[1]<6?"Cupcake":a[0]===1&&a[1]>=6?"Donut":a[0]===2&&a[1]<2?"Eclair":a[0]===2&&a[1]===2?"Froyo":a[0]===2&&a[1]>2?"Gingerbread":a[0]===3?"Honeycomb":a[0]===4&&a[1]<1?"Ice Cream Sandwich":a[0]===4&&a[1]<4?"Jelly Bean":a[0]===4&&a[1]>=4?"KitKat":a[0]===5?"Lollipop":a[0]===6?"Marshmallow":a[0]===7?"Nougat":a[0]===8?"Oreo":a[0]===9?"Pie":void 0},s.getVersionPrecision=function(i){return i.split(".").length},s.compareVersions=function(i,a,c){c===void 0&&(c=!1);var l=s.getVersionPrecision(i),f=s.getVersionPrecision(a),p=Math.max(l,f),d=0,m=s.map([i,a],function(h){var y=p-s.getVersionPrecision(h),g=h+new Array(y+1).join(".0");return s.map(g.split("."),function(v){return new Array(20-v.length).join("0")+v}).reverse()});for(c&&(d=p-Math.min(l,f)),p-=1;p>=d;){if(m[0][p]>m[1][p])return 1;if(m[0][p]===m[1][p]){if(p===d)return 0;p-=1}else if(m[0][p]<m[1][p])return-1}},s.map=function(i,a){var c,l=[];if(Array.prototype.map)return Array.prototype.map.call(i,a);for(c=0;c<i.length;c+=1)l.push(a(i[c]));return l},s.find=function(i,a){var c,l;if(Array.prototype.find)return Array.prototype.find.call(i,a);for(c=0,l=i.length;c<l;c+=1){var f=i[c];if(a(f,c))return f}},s.assign=function(i){for(var a,c,l=i,f=arguments.length,p=new Array(f>1?f-1:0),d=1;d<f;d++)p[d-1]=arguments[d];if(Object.assign)return Object.assign.apply(Object,[i].concat(p));var m=function(){var h=p[a];typeof h=="object"&&h!==null&&Object.keys(h).forEach(function(y){l[y]=h[y]})};for(a=0,c=p.length;a<c;a+=1)m();return i},s.getBrowserAlias=function(i){return n.BROWSER_ALIASES_MAP[i]},s.getBrowserTypeByAlias=function(i){return n.BROWSER_MAP[i]||""},s}();t.default=o,e.exports=t.default},18:function(e,t,r){"use strict";t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,o=(n=r(91))&&n.__esModule?n:{default:n},s=r(18);function i(c,l){for(var f=0;f<l.length;f++){var p=l[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(c,p.key,p)}}var a=function(){function c(){}var l,f,p;return c.getParser=function(d,m){if(m===void 0&&(m=!1),typeof d!="string")throw new Error("UserAgent should be a string");return new o.default(d,m)},c.parse=function(d){return new o.default(d).getResult()},l=c,p=[{key:"BROWSER_MAP",get:function(){return s.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return s.ENGINE_MAP}},{key:"OS_MAP",get:function(){return s.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return s.PLATFORMS_MAP}}],(f=null)&&i(l.prototype,f),p&&i(l,p),c}();t.default=a,e.exports=t.default},91:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=c(r(92)),o=c(r(93)),s=c(r(94)),i=c(r(95)),a=c(r(17));function c(f){return f&&f.__esModule?f:{default:f}}var l=function(){function f(d,m){if(m===void 0&&(m=!1),d==null||d==="")throw new Error("UserAgent parameter can't be empty");this._ua=d,this.parsedResult={},m!==!0&&this.parse()}var p=f.prototype;return p.getUA=function(){return this._ua},p.test=function(d){return d.test(this._ua)},p.parseBrowser=function(){var d=this;this.parsedResult.browser={};var m=a.default.find(n.default,function(h){if(typeof h.test=="function")return h.test(d);if(h.test instanceof Array)return h.test.some(function(y){return d.test(y)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.browser=m.describe(this.getUA())),this.parsedResult.browser},p.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},p.getBrowserName=function(d){return d?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},p.getBrowserVersion=function(){return this.getBrowser().version},p.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},p.parseOS=function(){var d=this;this.parsedResult.os={};var m=a.default.find(o.default,function(h){if(typeof h.test=="function")return h.test(d);if(h.test instanceof Array)return h.test.some(function(y){return d.test(y)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.os=m.describe(this.getUA())),this.parsedResult.os},p.getOSName=function(d){var m=this.getOS().name;return d?String(m).toLowerCase()||"":m||""},p.getOSVersion=function(){return this.getOS().version},p.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},p.getPlatformType=function(d){d===void 0&&(d=!1);var m=this.getPlatform().type;return d?String(m).toLowerCase()||"":m||""},p.parsePlatform=function(){var d=this;this.parsedResult.platform={};var m=a.default.find(s.default,function(h){if(typeof h.test=="function")return h.test(d);if(h.test instanceof Array)return h.test.some(function(y){return d.test(y)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.platform=m.describe(this.getUA())),this.parsedResult.platform},p.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},p.getEngineName=function(d){return d?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},p.parseEngine=function(){var d=this;this.parsedResult.engine={};var m=a.default.find(i.default,function(h){if(typeof h.test=="function")return h.test(d);if(h.test instanceof Array)return h.test.some(function(y){return d.test(y)});throw new Error("Browser's test function is not valid")});return m&&(this.parsedResult.engine=m.describe(this.getUA())),this.parsedResult.engine},p.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},p.getResult=function(){return a.default.assign({},this.parsedResult)},p.satisfies=function(d){var m=this,h={},y=0,g={},v=0;if(Object.keys(d).forEach(function(F){var q=d[F];typeof q=="string"?(g[F]=q,v+=1):typeof q=="object"&&(h[F]=q,y+=1)}),y>0){var b=Object.keys(h),w=a.default.find(b,function(F){return m.isOS(F)});if(w){var S=this.satisfies(h[w]);if(S!==void 0)return S}var T=a.default.find(b,function(F){return m.isPlatform(F)});if(T){var U=this.satisfies(h[T]);if(U!==void 0)return U}}if(v>0){var I=Object.keys(g),G=a.default.find(I,function(F){return m.isBrowser(F,!0)});if(G!==void 0)return this.compareVersion(g[G])}},p.isBrowser=function(d,m){m===void 0&&(m=!1);var h=this.getBrowserName().toLowerCase(),y=d.toLowerCase(),g=a.default.getBrowserTypeByAlias(y);return m&&g&&(y=g.toLowerCase()),y===h},p.compareVersion=function(d){var m=[0],h=d,y=!1,g=this.getBrowserVersion();if(typeof g=="string")return d[0]===">"||d[0]==="<"?(h=d.substr(1),d[1]==="="?(y=!0,h=d.substr(2)):m=[],d[0]===">"?m.push(1):m.push(-1)):d[0]==="="?h=d.substr(1):d[0]==="~"&&(y=!0,h=d.substr(1)),m.indexOf(a.default.compareVersions(g,h,y))>-1},p.isOS=function(d){return this.getOSName(!0)===String(d).toLowerCase()},p.isPlatform=function(d){return this.getPlatformType(!0)===String(d).toLowerCase()},p.isEngine=function(d){return this.getEngineName(!0)===String(d).toLowerCase()},p.is=function(d,m){return m===void 0&&(m=!1),this.isBrowser(d,m)||this.isOS(d)||this.isPlatform(d)},p.some=function(d){var m=this;return d===void 0&&(d=[]),d.some(function(h){return m.is(h)})},f}();t.default=l,e.exports=t.default},92:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},s=/version\/(\d+(\.?_?\d+)+)/i,i=[{test:[/googlebot/i],describe:function(a){var c={name:"Googlebot"},l=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/opera/i],describe:function(a){var c={name:"Opera"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/opr\/|opios/i],describe:function(a){var c={name:"Opera"},l=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/SamsungBrowser/i],describe:function(a){var c={name:"Samsung Internet for Android"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/Whale/i],describe:function(a){var c={name:"NAVER Whale Browser"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/MZBrowser/i],describe:function(a){var c={name:"MZ Browser"},l=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/focus/i],describe:function(a){var c={name:"Focus"},l=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/swing/i],describe:function(a){var c={name:"Swing"},l=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/coast/i],describe:function(a){var c={name:"Opera Coast"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(a){var c={name:"Opera Touch"},l=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/yabrowser/i],describe:function(a){var c={name:"Yandex Browser"},l=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/ucbrowser/i],describe:function(a){var c={name:"UC Browser"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/Maxthon|mxios/i],describe:function(a){var c={name:"Maxthon"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/epiphany/i],describe:function(a){var c={name:"Epiphany"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/puffin/i],describe:function(a){var c={name:"Puffin"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/sleipnir/i],describe:function(a){var c={name:"Sleipnir"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/k-meleon/i],describe:function(a){var c={name:"K-Meleon"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/micromessenger/i],describe:function(a){var c={name:"WeChat"},l=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/qqbrowser/i],describe:function(a){var c={name:/qqbrowserlite/i.test(a)?"QQ Browser Lite":"QQ Browser"},l=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/msie|trident/i],describe:function(a){var c={name:"Internet Explorer"},l=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/\sedg\//i],describe:function(a){var c={name:"Microsoft Edge"},l=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/edg([ea]|ios)/i],describe:function(a){var c={name:"Microsoft Edge"},l=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/vivaldi/i],describe:function(a){var c={name:"Vivaldi"},l=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/seamonkey/i],describe:function(a){var c={name:"SeaMonkey"},l=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/sailfish/i],describe:function(a){var c={name:"Sailfish"},l=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,a);return l&&(c.version=l),c}},{test:[/silk/i],describe:function(a){var c={name:"Amazon Silk"},l=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/phantom/i],describe:function(a){var c={name:"PhantomJS"},l=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/slimerjs/i],describe:function(a){var c={name:"SlimerJS"},l=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var c={name:"BlackBerry"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var c={name:"WebOS Browser"},l=o.default.getFirstMatch(s,a)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/bada/i],describe:function(a){var c={name:"Bada"},l=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/tizen/i],describe:function(a){var c={name:"Tizen"},l=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/qupzilla/i],describe:function(a){var c={name:"QupZilla"},l=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/firefox|iceweasel|fxios/i],describe:function(a){var c={name:"Firefox"},l=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/electron/i],describe:function(a){var c={name:"Electron"},l=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/MiuiBrowser/i],describe:function(a){var c={name:"Miui"},l=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/chromium/i],describe:function(a){var c={name:"Chromium"},l=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,a)||o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/chrome|crios|crmo/i],describe:function(a){var c={name:"Chrome"},l=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/GSA/i],describe:function(a){var c={name:"Google Search"},l=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:function(a){var c=!a.test(/like android/i),l=a.test(/android/i);return c&&l},describe:function(a){var c={name:"Android Browser"},l=o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/playstation 4/i],describe:function(a){var c={name:"PlayStation 4"},l=o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/safari|applewebkit/i],describe:function(a){var c={name:"Safari"},l=o.default.getFirstMatch(s,a);return l&&(c.version=l),c}},{test:[/.*/i],describe:function(a){var c=a.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(c,a),version:o.default.getSecondMatch(c,a)}}}];t.default=i,e.exports=t.default},93:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),i=[{test:[/Roku\/DVP/],describe:function(a){var c=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,a);return{name:s.OS_MAP.Roku,version:c}}},{test:[/windows phone/i],describe:function(a){var c=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,a);return{name:s.OS_MAP.WindowsPhone,version:c}}},{test:[/windows /i],describe:function(a){var c=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,a),l=o.default.getWindowsVersionName(c);return{name:s.OS_MAP.Windows,version:c,versionName:l}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(a){var c={name:s.OS_MAP.iOS},l=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,a);return l&&(c.version=l),c}},{test:[/macintosh/i],describe:function(a){var c=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,a).replace(/[_\s]/g,"."),l=o.default.getMacOSVersionName(c),f={name:s.OS_MAP.MacOS,version:c};return l&&(f.versionName=l),f}},{test:[/(ipod|iphone|ipad)/i],describe:function(a){var c=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,a).replace(/[_\s]/g,".");return{name:s.OS_MAP.iOS,version:c}}},{test:function(a){var c=!a.test(/like android/i),l=a.test(/android/i);return c&&l},describe:function(a){var c=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,a),l=o.default.getAndroidVersionName(c),f={name:s.OS_MAP.Android,version:c};return l&&(f.versionName=l),f}},{test:[/(web|hpw)[o0]s/i],describe:function(a){var c=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,a),l={name:s.OS_MAP.WebOS};return c&&c.length&&(l.version=c),l}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(a){var c=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,a)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,a)||o.default.getFirstMatch(/\bbb(\d+)/i,a);return{name:s.OS_MAP.BlackBerry,version:c}}},{test:[/bada/i],describe:function(a){var c=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,a);return{name:s.OS_MAP.Bada,version:c}}},{test:[/tizen/i],describe:function(a){var c=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,a);return{name:s.OS_MAP.Tizen,version:c}}},{test:[/linux/i],describe:function(){return{name:s.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:s.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(a){var c=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,a);return{name:s.OS_MAP.PlayStation4,version:c}}}];t.default=i,e.exports=t.default},94:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),i=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(a){var c=o.default.getFirstMatch(/(can-l01)/i,a)&&"Nova",l={type:s.PLATFORMS_MAP.mobile,vendor:"Huawei"};return c&&(l.model=c),l}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(a){var c=a.test(/ipod|iphone/i),l=a.test(/like (ipod|iphone)/i);return c&&!l},describe:function(a){var c=o.default.getFirstMatch(/(ipod|iphone)/i,a);return{type:s.PLATFORMS_MAP.mobile,vendor:"Apple",model:c}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getBrowserName(!0)==="blackberry"},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(a){return a.getBrowserName(!0)==="bada"},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getBrowserName()==="windows phone"},describe:function(){return{type:s.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(a){var c=Number(String(a.getOSVersion()).split(".")[0]);return a.getOSName(!0)==="android"&&c>=3},describe:function(){return{type:s.PLATFORMS_MAP.tablet}}},{test:function(a){return a.getOSName(!0)==="android"},describe:function(){return{type:s.PLATFORMS_MAP.mobile}}},{test:function(a){return a.getOSName(!0)==="macos"},describe:function(){return{type:s.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(a){return a.getOSName(!0)==="windows"},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(a){return a.getOSName(!0)==="linux"},describe:function(){return{type:s.PLATFORMS_MAP.desktop}}},{test:function(a){return a.getOSName(!0)==="playstation 4"},describe:function(){return{type:s.PLATFORMS_MAP.tv}}},{test:function(a){return a.getOSName(!0)==="roku"},describe:function(){return{type:s.PLATFORMS_MAP.tv}}}];t.default=i,e.exports=t.default},95:function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n,o=(n=r(17))&&n.__esModule?n:{default:n},s=r(18),i=[{test:function(a){return a.getBrowserName(!0)==="microsoft edge"},describe:function(a){if(/\sedg\//i.test(a))return{name:s.ENGINE_MAP.Blink};var c=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,a);return{name:s.ENGINE_MAP.EdgeHTML,version:c}}},{test:[/trident/i],describe:function(a){var c={name:s.ENGINE_MAP.Trident},l=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:function(a){return a.test(/presto/i)},describe:function(a){var c={name:s.ENGINE_MAP.Presto},l=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:function(a){var c=a.test(/gecko/i),l=a.test(/like gecko/i);return c&&!l},describe:function(a){var c={name:s.ENGINE_MAP.Gecko},l=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:s.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(a){var c={name:s.ENGINE_MAP.WebKit},l=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,a);return l&&(c.version=l),c}}];t.default=i,e.exports=t.default}})})});var bc="vercel.ai.error",fg=Symbol.for(bc),xc,mg=class wc extends Error{constructor({name:t,message:r,cause:n}){super(r),this[xc]=!0,this.name=t,this.cause=n}static isInstance(t){return wc.hasMarker(t,bc)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};xc=fg;var Q=mg,_c="AI_APICallError",Ec=`vercel.ai.error.${_c}`,hg=Symbol.for(Ec),Sc,Ue=class extends Q{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:o,responseBody:s,cause:i,isRetryable:a=n!=null&&(n===408||n===409||n===429||n>=500),data:c}){super({name:_c,message:e,cause:i}),this[Sc]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=o,this.responseBody=s,this.isRetryable=a,this.data=c}static isInstance(e){return Q.hasMarker(e,Ec)}};Sc=hg;var Ac="AI_EmptyResponseBodyError",kc=`vercel.ai.error.${Ac}`,gg=Symbol.for(kc),Tc,Ic=class extends Q{constructor({message:e="Empty response body"}={}){super({name:Ac,message:e}),this[Tc]=!0}static isInstance(e){return Q.hasMarker(e,kc)}};Tc=gg;function Cc(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Rc="AI_InvalidArgumentError",Oc=`vercel.ai.error.${Rc}`,yg=Symbol.for(Oc),Pc,Nc=class extends Q{constructor({message:e,cause:t,argument:r}){super({name:Rc,message:e,cause:t}),this[Pc]=!0,this.argument=r}static isInstance(e){return Q.hasMarker(e,Oc)}};Pc=yg;var Mc="AI_InvalidPromptError",Dc=`vercel.ai.error.${Mc}`,vg=Symbol.for(Dc),Bc,$c=class extends Q{constructor({prompt:e,message:t,cause:r}){super({name:Mc,message:`Invalid prompt: ${t}`,cause:r}),this[Bc]=!0,this.prompt=e}static isInstance(e){return Q.hasMarker(e,Dc)}};Bc=vg;var Uc="AI_InvalidResponseDataError",Lc=`vercel.ai.error.${Uc}`,bg=Symbol.for(Lc),Fc,Et=class extends Q{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:Uc,message:t}),this[Fc]=!0,this.data=e}static isInstance(e){return Q.hasMarker(e,Lc)}};Fc=bg;var Hc="AI_JSONParseError",jc=`vercel.ai.error.${Hc}`,xg=Symbol.for(jc),Kc,bn=class extends Q{constructor({text:e,cause:t}){super({name:Hc,message:`JSON parsing failed: Text: ${e}.
Error message: ${Cc(t)}`,cause:t}),this[Kc]=!0,this.text=e}static isInstance(e){return Q.hasMarker(e,jc)}};Kc=xg;var Gc="AI_LoadAPIKeyError",Vc=`vercel.ai.error.${Gc}`,wg=Symbol.for(Vc),qc,xn=class extends Q{constructor({message:e}){super({name:Gc,message:e}),this[qc]=!0}static isInstance(e){return Q.hasMarker(e,Vc)}};qc=wg;var _g="AI_LoadSettingError",Eg=`vercel.ai.error.${_g}`,Sg=Symbol.for(Eg),Ag;Ag=Sg;var kg="AI_NoContentGeneratedError",Tg=`vercel.ai.error.${kg}`,Ig=Symbol.for(Tg),Cg;Cg=Ig;var Jc="AI_NoSuchModelError",zc=`vercel.ai.error.${Jc}`,Rg=Symbol.for(zc),Wc,Yc=class extends Q{constructor({errorName:e=Jc,modelId:t,modelType:r,message:n=`No such ${r}: ${t}`}){super({name:e,message:n}),this[Wc]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return Q.hasMarker(e,zc)}};Wc=Rg;var Qc="AI_TooManyEmbeddingValuesForCallError",Xc=`vercel.ai.error.${Qc}`,Og=Symbol.for(Xc),Zc,el=class extends Q{constructor(e){super({name:Qc,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Zc]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return Q.hasMarker(e,Xc)}};Zc=Og;var tl="AI_TypeValidationError",rl=`vercel.ai.error.${tl}`,Pg=Symbol.for(rl),nl,Ng=class ha extends Q{constructor({value:t,cause:r}){super({name:tl,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Cc(r)}`,cause:r}),this[nl]=!0,this.value=t}static isInstance(t){return Q.hasMarker(t,rl)}static wrap({value:t,cause:r}){return ha.isInstance(r)&&r.value===t?r:new ha({value:t,cause:r})}};nl=Pg;var mr=Ng,ol="AI_UnsupportedFunctionalityError",sl=`vercel.ai.error.${ol}`,Mg=Symbol.for(sl),al,Y=class extends Q{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:ol,message:t}),this[al]=!0,this.functionality=e}static isInstance(e){return Q.hasMarker(e,sl)}};al=Mg;var hr=(e,t=21)=>(r=t)=>{let n="",o=r|0;for(;o--;)n+=e[Math.random()*e.length|0];return n};var Co=ct(Ht(),1);var ko=class extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}};function ya(e){}function dl(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=ya,onError:r=ya,onRetry:n=ya,onComment:o}=e,s="",i=!0,a,c="",l="";function f(y){let g=i?y.replace(/^\xEF\xBB\xBF/,""):y,[v,b]=$g(`${s}${g}`);for(let w of v)p(w);s=b,i=!1}function p(y){if(y===""){m();return}if(y.startsWith(":")){o&&o(y.slice(y.startsWith(": ")?2:1));return}let g=y.indexOf(":");if(g!==-1){let v=y.slice(0,g),b=y[g+1]===" "?2:1,w=y.slice(g+b);d(v,w,y);return}d(y,"",y)}function d(y,g,v){switch(y){case"event":l=g;break;case"data":c=`${c}${g}
`;break;case"id":a=g.includes("\0")?void 0:g;break;case"retry":/^\d+$/.test(g)?n(parseInt(g,10)):r(new ko(`Invalid \`retry\` value: "${g}"`,{type:"invalid-retry",value:g,line:v}));break;default:r(new ko(`Unknown field "${y.length>20?`${y.slice(0,20)}\u2026`:y}"`,{type:"unknown-field",field:y,value:g,line:v}));break}}function m(){c.length>0&&t({id:a,event:l||void 0,data:c.endsWith(`
`)?c.slice(0,-1):c}),a=void 0,c="",l=""}function h(y={}){s&&y.consume&&p(s),i=!0,a=void 0,c="",l="",s=""}return{feed:f,reset:h}}function $g(e){let t=[],r="",n=0;for(;n<e.length;){let o=e.indexOf("\r",n),s=e.indexOf(`
`,n),i=-1;if(o!==-1&&s!==-1?i=Math.min(o,s):o!==-1?i=o:s!==-1&&(i=s),i===-1){r=e.slice(n);break}else{let a=e.slice(n,i);t.push(a),n=i+1,e[n-1]==="\r"&&e[n]===`
`&&n++}}return[t,r]}var yr=class extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let o;super({start(s){o=dl({onEvent:i=>{s.enqueue(i)},onError(i){t==="terminate"?s.error(i):typeof t=="function"&&t(i)},onRetry:r,onComment:n})},transform(s){o.feed(s)}})}};function Se(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function To(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r}),t}var Ug=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{let o=hr(r,t);if(e==null)return o;if(r.includes(n))throw new Nc({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return s=>`${e}${n}${o(s)}`},Ye=Ug();function va(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function Io({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new xn({message:`${n} API key must be a string.`});if(typeof process>"u")throw new xn({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new xn({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new xn({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var ba=Symbol.for("vercel.ai.validator");function Lg(e){return{[ba]:!0,validate:e}}function Fg(e){return typeof e=="object"&&e!==null&&ba in e&&e[ba]===!0&&"validate"in e}function Hg(e){return Fg(e)?e:jg(e)}function jg(e){return Lg(t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Kg({value:e,schema:t}){let r=wn({value:e,schema:t});if(!r.success)throw mr.wrap({value:e,cause:r.error});return r.value}function wn({value:e,schema:t}){let r=Hg(t);try{if(r.validate==null)return{success:!0,value:e};let n=r.validate(e);return n.success?n:{success:!1,error:mr.wrap({value:e,cause:n.error})}}catch(n){return{success:!1,error:mr.wrap({value:e,cause:n})}}}function Gg({text:e,schema:t}){try{let r=Co.default.parse(e);return t==null?r:Kg({value:r,schema:t})}catch(r){throw bn.isInstance(r)||mr.isInstance(r)?r:new bn({text:e,cause:r})}}function pl({text:e,schema:t}){try{let r=Co.default.parse(e);if(t==null)return{success:!0,value:r,rawValue:r};let n=wn({value:r,schema:t});return n.success?{...n,rawValue:r}:n}catch(r){return{success:!1,error:bn.isInstance(r)?r:new bn({text:e,cause:r})}}}function vr(e){try{return Co.default.parse(e),!0}catch{return!1}}function Vg(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var qg=()=>globalThis.fetch,Ae=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i})=>Jg({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i}),Jg=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:o,abortSignal:s,fetch:i=qg()})=>{try{let a=await i(e,{method:"POST",headers:Vg(t),body:r.content,signal:s}),c=To(a);if(!a.ok){let l;try{l=await o({response:a,url:e,requestBodyValues:r.values})}catch(f){throw va(f)||Ue.isInstance(f)?f:new Ue({message:"Failed to process error response",cause:f,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw l.value}try{return await n({response:a,url:e,requestBodyValues:r.values})}catch(l){throw l instanceof Error&&(va(l)||Ue.isInstance(l))?l:new Ue({message:"Failed to process successful response",cause:l,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(a){if(va(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){let c=a.cause;if(c!=null)throw new Ue({message:`Cannot connect to API: ${c.message}`,cause:c,url:e,requestBodyValues:r.values,isRetryable:!0})}throw a}};var Ro=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:o,requestBodyValues:s})=>{let i=await n.text(),a=To(n);if(i.trim()==="")return{responseHeaders:a,value:new Ue({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})};try{let c=Gg({text:i,schema:e});return{responseHeaders:a,value:new Ue({message:t(c),url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,data:c,isRetryable:r?.(n,c)})}}catch{return{responseHeaders:a,value:new Ue({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})}}},br=e=>async({response:t})=>{let r=To(t);if(t.body==null)throw new Ic({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new yr).pipeThrough(new TransformStream({transform({data:n},o){n!=="[DONE]"&&o.enqueue(pl({text:n,schema:e}))}}))}};var Qe=e=>async({response:t,url:r,requestBodyValues:n})=>{let o=await t.text(),s=pl({text:o,schema:e}),i=To(t);if(!s.success)throw new Ue({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:o,url:r,requestBodyValues:n});return{responseHeaders:i,value:s.value,rawValue:s.rawValue}},{btoa:zg,atob:DA}=globalThis;function Oo(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return zg(t)}function Po(e){return e?.replace(/\/$/,"")}var u={};gc(u,{BRAND:()=>xy,DIRTY:()=>jt,EMPTY_PATH:()=>Xg,INVALID:()=>R,NEVER:()=>ov,OK:()=>pe,ParseStatus:()=>oe,Schema:()=>B,ZodAny:()=>kt,ZodArray:()=>Te,ZodBigInt:()=>et,ZodBoolean:()=>Kt,ZodBranded:()=>En,ZodCatch:()=>Zt,ZodDate:()=>pt,ZodDefault:()=>Xt,ZodDiscriminatedUnion:()=>Ar,ZodEffects:()=>Pe,ZodEnum:()=>tt,ZodError:()=>de,ZodFirstPartyTypeKind:()=>O,ZodFunction:()=>At,ZodIntersection:()=>Jt,ZodIssueCode:()=>x,ZodLazy:()=>Wt,ZodLiteral:()=>Yt,ZodMap:()=>kr,ZodNaN:()=>Tr,ZodNativeEnum:()=>Qt,ZodNever:()=>Le,ZodNull:()=>Vt,ZodNullable:()=>rt,ZodNumber:()=>Ze,ZodObject:()=>V,ZodOptional:()=>Ce,ZodParsedType:()=>E,ZodPipeline:()=>er,ZodPromise:()=>Tt,ZodReadonly:()=>tr,ZodRecord:()=>zt,ZodSchema:()=>B,ZodSet:()=>ft,ZodString:()=>ke,ZodSymbol:()=>Er,ZodTransformer:()=>Pe,ZodTuple:()=>Oe,ZodType:()=>B,ZodUndefined:()=>Gt,ZodUnion:()=>qt,ZodUnknown:()=>dt,ZodVoid:()=>Sr,addIssueToContext:()=>_,any:()=>Cy,array:()=>Ny,bigint:()=>Sy,boolean:()=>El,coerce:()=>nv,custom:()=>xl,date:()=>Ay,datetimeRegex:()=>vl,defaultErrorMap:()=>lt,discriminatedUnion:()=>$y,effect:()=>Wy,enum:()=>qy,function:()=>Ky,getErrorMap:()=>xr,getParsedType:()=>Xe,instanceof:()=>_y,intersection:()=>Uy,isAborted:()=>No,isAsync:()=>wr,isDirty:()=>Mo,isValid:()=>St,late:()=>wy,lazy:()=>Gy,literal:()=>Vy,makeIssue:()=>_n,map:()=>Hy,nan:()=>Ey,nativeEnum:()=>Jy,never:()=>Oy,null:()=>Iy,nullable:()=>Qy,number:()=>_l,object:()=>My,objectUtil:()=>xa,oboolean:()=>rv,onumber:()=>tv,optional:()=>Yy,ostring:()=>ev,pipeline:()=>Zy,preprocess:()=>Xy,promise:()=>zy,quotelessJson:()=>Wg,record:()=>Fy,set:()=>jy,setErrorMap:()=>Qg,strictObject:()=>Dy,string:()=>wl,symbol:()=>ky,transformer:()=>Wy,tuple:()=>Ly,undefined:()=>Ty,union:()=>By,unknown:()=>Ry,util:()=>$,void:()=>Py});var $;(function(e){e.assertEqual=o=>{};function t(o){}e.assertIs=t;function r(o){throw new Error}e.assertNever=r,e.arrayToEnum=o=>{let s={};for(let i of o)s[i]=i;return s},e.getValidEnumValues=o=>{let s=e.objectKeys(o).filter(a=>typeof o[o[a]]!="number"),i={};for(let a of s)i[a]=o[a];return e.objectValues(i)},e.objectValues=o=>e.objectKeys(o).map(function(s){return o[s]}),e.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{let s=[];for(let i in o)Object.prototype.hasOwnProperty.call(o,i)&&s.push(i);return s},e.find=(o,s)=>{for(let i of o)if(s(i))return i},e.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,s=" | "){return o.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}e.joinValues=n,e.jsonStringifyReplacer=(o,s)=>typeof s=="bigint"?s.toString():s})($||($={}));var xa;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(xa||(xa={}));var E=$.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Xe=e=>{switch(typeof e){case"undefined":return E.undefined;case"string":return E.string;case"number":return Number.isNaN(e)?E.nan:E.number;case"boolean":return E.boolean;case"function":return E.function;case"bigint":return E.bigint;case"symbol":return E.symbol;case"object":return Array.isArray(e)?E.array:e===null?E.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?E.promise:typeof Map<"u"&&e instanceof Map?E.map:typeof Set<"u"&&e instanceof Set?E.set:typeof Date<"u"&&e instanceof Date?E.date:E.object;default:return E.unknown}};var x=$.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Wg=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),de=class extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){let r=t||function(s){return s.message},n={_errors:[]},o=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(o);else if(i.code==="invalid_return_type")o(i.returnTypeError);else if(i.code==="invalid_arguments")o(i.argumentsError);else if(i.path.length===0)n._errors.push(r(i));else{let a=n,c=0;for(;c<i.path.length;){let l=i.path[c];c===i.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(r(i))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return o(this),n}static assert(t){if(!(t instanceof de))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,$.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){let r={},n=[];for(let o of this.issues)if(o.path.length>0){let s=o.path[0];r[s]=r[s]||[],r[s].push(t(o))}else n.push(t(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};de.create=e=>new de(e);var Yg=(e,t)=>{let r;switch(e.code){case x.invalid_type:e.received===E.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case x.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,$.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:r=`Unrecognized key(s) in object: ${$.joinValues(e.keys,", ")}`;break;case x.invalid_union:r="Invalid input";break;case x.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${$.joinValues(e.options)}`;break;case x.invalid_enum_value:r=`Invalid enum value. Expected ${$.joinValues(e.options)}, received '${e.received}'`;break;case x.invalid_arguments:r="Invalid function arguments";break;case x.invalid_return_type:r="Invalid function return type";break;case x.invalid_date:r="Invalid date";break;case x.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:$.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case x.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case x.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case x.custom:r="Invalid input";break;case x.invalid_intersection_types:r="Intersection results could not be merged";break;case x.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case x.not_finite:r="Number must be finite";break;default:r=t.defaultError,$.assertNever(e)}return{message:r}},lt=Yg;var fl=lt;function Qg(e){fl=e}function xr(){return fl}var _n=e=>{let{data:t,path:r,errorMaps:n,issueData:o}=e,s=[...r,...o.path||[]],i={...o,path:s};if(o.message!==void 0)return{...o,path:s,message:o.message};let a="",c=n.filter(l=>!!l).slice().reverse();for(let l of c)a=l(i,{data:t,defaultError:a}).message;return{...o,path:s,message:a}},Xg=[];function _(e,t){let r=xr(),n=_n({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===lt?void 0:lt].filter(o=>!!o)});e.common.issues.push(n)}var oe=class{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){let n=[];for(let o of r){if(o.status==="aborted")return R;o.status==="dirty"&&t.dirty(),n.push(o.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){let n=[];for(let o of r){let s=await o.key,i=await o.value;n.push({key:s,value:i})}return oe.mergeObjectSync(t,n)}static mergeObjectSync(t,r){let n={};for(let o of r){let{key:s,value:i}=o;if(s.status==="aborted"||i.status==="aborted")return R;s.status==="dirty"&&t.dirty(),i.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||o.alwaysSet)&&(n[s.value]=i.value)}return{status:t.value,value:n}}},R=Object.freeze({status:"aborted"}),jt=e=>({status:"dirty",value:e}),pe=e=>({status:"valid",value:e}),No=e=>e.status==="aborted",Mo=e=>e.status==="dirty",St=e=>e.status==="valid",wr=e=>typeof Promise<"u"&&e instanceof Promise;var A;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(A||(A={}));var Re=class{constructor(t,r,n,o){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},ml=(e,t)=>{if(St(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new de(e.common.issues);return this._error=r,this._error}}};function N(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:n,description:o}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:o}:{errorMap:(i,a)=>{let{message:c}=e;return i.code==="invalid_enum_value"?{message:c??a.defaultError}:typeof a.data>"u"?{message:c??n??a.defaultError}:i.code!=="invalid_type"?{message:a.defaultError}:{message:c??r??a.defaultError}},description:o}}var B=class{get description(){return this._def.description}_getType(t){return Xe(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Xe(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new oe,ctx:{common:t.parent.common,data:t.data,parsedType:Xe(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let r=this._parse(t);if(wr(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){let r=this._parse(t);return Promise.resolve(r)}parse(t,r){let n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){let n={common:{issues:[],async:r?.async??!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Xe(t)},o=this._parseSync({data:t,path:n.path,parent:n});return ml(n,o)}"~validate"(t){let r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Xe(t)};if(!this["~standard"].async)try{let n=this._parseSync({data:t,path:[],parent:r});return St(n)?{value:n.value}:{issues:r.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(n=>St(n)?{value:n.value}:{issues:r.common.issues})}async parseAsync(t,r){let n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Xe(t)},o=this._parse({data:t,path:n.path,parent:n}),s=await(wr(o)?o:Promise.resolve(o));return ml(n,s)}refine(t,r){let n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,s)=>{let i=t(o),a=()=>s.addIssue({code:x.custom,...n(o)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(a(),!1)):i?!0:(a(),!1)})}refinement(t,r){return this._refinement((n,o)=>t(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(t){return new Pe({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Ce.create(this,this._def)}nullable(){return rt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Te.create(this)}promise(){return Tt.create(this,this._def)}or(t){return qt.create([this,t],this._def)}and(t){return Jt.create(this,t,this._def)}transform(t){return new Pe({...N(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let r=typeof t=="function"?t:()=>t;return new Xt({...N(this._def),innerType:this,defaultValue:r,typeName:O.ZodDefault})}brand(){return new En({typeName:O.ZodBranded,type:this,...N(this._def)})}catch(t){let r=typeof t=="function"?t:()=>t;return new Zt({...N(this._def),innerType:this,catchValue:r,typeName:O.ZodCatch})}describe(t){let r=this.constructor;return new r({...this._def,description:t})}pipe(t){return er.create(this,t)}readonly(){return tr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Zg=/^c[^\s-]{8,}$/i,ey=/^[0-9a-z]+$/,ty=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ry=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ny=/^[a-z0-9_-]{21}$/i,oy=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,sy=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ay=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,iy="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",wa,cy=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ly=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,uy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,dy=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,py=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,fy=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",my=new RegExp(`^${gl}$`);function yl(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function hy(e){return new RegExp(`^${yl(e)}$`)}function vl(e){let t=`${gl}T${yl(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function gy(e,t){return!!((t==="v4"||!t)&&cy.test(e)||(t==="v6"||!t)&&uy.test(e))}function yy(e,t){if(!oy.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&o?.typ!=="JWT"||!o.alg||t&&o.alg!==t)}catch{return!1}}function vy(e,t){return!!((t==="v4"||!t)&&ly.test(e)||(t==="v6"||!t)&&dy.test(e))}var ke=class extends B{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==E.string){let s=this._getOrReturnCtx(t);return _(s,{code:x.invalid_type,expected:E.string,received:s.parsedType}),R}let n=new oe,o;for(let s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(o=this._getOrReturnCtx(t,o),_(o,{code:x.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")t.data.length>s.value&&(o=this._getOrReturnCtx(t,o),_(o,{code:x.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let i=t.data.length>s.value,a=t.data.length<s.value;(i||a)&&(o=this._getOrReturnCtx(t,o),i?_(o,{code:x.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):a&&_(o,{code:x.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")ay.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"email",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")wa||(wa=new RegExp(iy,"u")),wa.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"emoji",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")ry.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"uuid",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")ny.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"nanoid",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")Zg.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"cuid",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")ey.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"cuid2",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")ty.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"ulid",code:x.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{o=this._getOrReturnCtx(t,o),_(o,{validation:"url",code:x.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"regex",code:x.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(o=this._getOrReturnCtx(t,o),_(o,{code:x.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(o=this._getOrReturnCtx(t,o),_(o,{code:x.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(o=this._getOrReturnCtx(t,o),_(o,{code:x.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?vl(s).test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{code:x.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?my.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{code:x.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?hy(s).test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{code:x.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?sy.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"duration",code:x.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?gy(t.data,s.version)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"ip",code:x.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?yy(t.data,s.alg)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"jwt",code:x.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?vy(t.data,s.version)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"cidr",code:x.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?py.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"base64",code:x.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?fy.test(t.data)||(o=this._getOrReturnCtx(t,o),_(o,{validation:"base64url",code:x.invalid_string,message:s.message}),n.dirty()):$.assertNever(s);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(o=>t.test(o),{validation:r,code:x.invalid_string,...A.errToObj(n)})}_addCheck(t){return new ke({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...A.errToObj(t)})}url(t){return this._addCheck({kind:"url",...A.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...A.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...A.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...A.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...A.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...A.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...A.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...A.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...A.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...A.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...A.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...A.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:t?.offset??!1,local:t?.local??!1,...A.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision,...A.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...A.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...A.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r?.position,...A.errToObj(r?.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...A.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...A.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...A.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...A.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...A.errToObj(r)})}nonempty(t){return this.min(1,A.errToObj(t))}trim(){return new ke({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ke({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ke({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};ke.create=e=>new ke({checks:[],typeName:O.ZodString,coerce:e?.coerce??!1,...N(e)});function by(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,o=r>n?r:n,s=Number.parseInt(e.toFixed(o).replace(".","")),i=Number.parseInt(t.toFixed(o).replace(".",""));return s%i/10**o}var Ze=class extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==E.number){let s=this._getOrReturnCtx(t);return _(s,{code:x.invalid_type,expected:E.number,received:s.parsedType}),R}let n,o=new oe;for(let s of this._def.checks)s.kind==="int"?$.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),_(n,{code:x.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),_(n,{code:x.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),_(n,{code:x.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty()):s.kind==="multipleOf"?by(t.data,s.value)!==0&&(n=this._getOrReturnCtx(t,n),_(n,{code:x.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),_(n,{code:x.not_finite,message:s.message}),o.dirty()):$.assertNever(s);return{status:o.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,A.toString(r))}gt(t,r){return this.setLimit("min",t,!1,A.toString(r))}lte(t,r){return this.setLimit("max",t,!0,A.toString(r))}lt(t,r){return this.setLimit("max",t,!1,A.toString(r))}setLimit(t,r,n,o){return new Ze({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:A.toString(o)}]})}_addCheck(t){return new Ze({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:A.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:A.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:A.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:A.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:A.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:A.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:A.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:A.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:A.toString(t)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&$.isInteger(t.value))}get isFinite(){let t=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}};Ze.create=e=>new Ze({checks:[],typeName:O.ZodNumber,coerce:e?.coerce||!1,...N(e)});var et=class extends B{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==E.bigint)return this._getInvalidInput(t);let n,o=new oe;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(n=this._getOrReturnCtx(t,n),_(n,{code:x.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(n=this._getOrReturnCtx(t,n),_(n,{code:x.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),_(n,{code:x.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):$.assertNever(s);return{status:o.value,value:t.data}}_getInvalidInput(t){let r=this._getOrReturnCtx(t);return _(r,{code:x.invalid_type,expected:E.bigint,received:r.parsedType}),R}gte(t,r){return this.setLimit("min",t,!0,A.toString(r))}gt(t,r){return this.setLimit("min",t,!1,A.toString(r))}lte(t,r){return this.setLimit("max",t,!0,A.toString(r))}lt(t,r){return this.setLimit("max",t,!1,A.toString(r))}setLimit(t,r,n,o){return new et({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:A.toString(o)}]})}_addCheck(t){return new et({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:A.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:A.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:A.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:A.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:A.toString(r)})}get minValue(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};et.create=e=>new et({checks:[],typeName:O.ZodBigInt,coerce:e?.coerce??!1,...N(e)});var Kt=class extends B{_parse(t){if(this._def.coerce&&(t.data=Boolean(t.data)),this._getType(t)!==E.boolean){let n=this._getOrReturnCtx(t);return _(n,{code:x.invalid_type,expected:E.boolean,received:n.parsedType}),R}return pe(t.data)}};Kt.create=e=>new Kt({typeName:O.ZodBoolean,coerce:e?.coerce||!1,...N(e)});var pt=class extends B{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==E.date){let s=this._getOrReturnCtx(t);return _(s,{code:x.invalid_type,expected:E.date,received:s.parsedType}),R}if(Number.isNaN(t.data.getTime())){let s=this._getOrReturnCtx(t);return _(s,{code:x.invalid_date}),R}let n=new oe,o;for(let s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(o=this._getOrReturnCtx(t,o),_(o,{code:x.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(o=this._getOrReturnCtx(t,o),_(o,{code:x.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):$.assertNever(s);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new pt({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:A.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:A.toString(r)})}get minDate(){let t=null;for(let r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(let r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}};pt.create=e=>new pt({checks:[],coerce:e?.coerce||!1,typeName:O.ZodDate,...N(e)});var Er=class extends B{_parse(t){if(this._getType(t)!==E.symbol){let n=this._getOrReturnCtx(t);return _(n,{code:x.invalid_type,expected:E.symbol,received:n.parsedType}),R}return pe(t.data)}};Er.create=e=>new Er({typeName:O.ZodSymbol,...N(e)});var Gt=class extends B{_parse(t){if(this._getType(t)!==E.undefined){let n=this._getOrReturnCtx(t);return _(n,{code:x.invalid_type,expected:E.undefined,received:n.parsedType}),R}return pe(t.data)}};Gt.create=e=>new Gt({typeName:O.ZodUndefined,...N(e)});var Vt=class extends B{_parse(t){if(this._getType(t)!==E.null){let n=this._getOrReturnCtx(t);return _(n,{code:x.invalid_type,expected:E.null,received:n.parsedType}),R}return pe(t.data)}};Vt.create=e=>new Vt({typeName:O.ZodNull,...N(e)});var kt=class extends B{constructor(){super(...arguments),this._any=!0}_parse(t){return pe(t.data)}};kt.create=e=>new kt({typeName:O.ZodAny,...N(e)});var dt=class extends B{constructor(){super(...arguments),this._unknown=!0}_parse(t){return pe(t.data)}};dt.create=e=>new dt({typeName:O.ZodUnknown,...N(e)});var Le=class extends B{_parse(t){let r=this._getOrReturnCtx(t);return _(r,{code:x.invalid_type,expected:E.never,received:r.parsedType}),R}};Le.create=e=>new Le({typeName:O.ZodNever,...N(e)});var Sr=class extends B{_parse(t){if(this._getType(t)!==E.undefined){let n=this._getOrReturnCtx(t);return _(n,{code:x.invalid_type,expected:E.void,received:n.parsedType}),R}return pe(t.data)}};Sr.create=e=>new Sr({typeName:O.ZodVoid,...N(e)});var Te=class extends B{_parse(t){let{ctx:r,status:n}=this._processInputParams(t),o=this._def;if(r.parsedType!==E.array)return _(r,{code:x.invalid_type,expected:E.array,received:r.parsedType}),R;if(o.exactLength!==null){let i=r.data.length>o.exactLength.value,a=r.data.length<o.exactLength.value;(i||a)&&(_(r,{code:i?x.too_big:x.too_small,minimum:a?o.exactLength.value:void 0,maximum:i?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(_(r,{code:x.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(_(r,{code:x.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((i,a)=>o.type._parseAsync(new Re(r,i,r.path,a)))).then(i=>oe.mergeArray(n,i));let s=[...r.data].map((i,a)=>o.type._parseSync(new Re(r,i,r.path,a)));return oe.mergeArray(n,s)}get element(){return this._def.type}min(t,r){return new Te({...this._def,minLength:{value:t,message:A.toString(r)}})}max(t,r){return new Te({...this._def,maxLength:{value:t,message:A.toString(r)}})}length(t,r){return new Te({...this._def,exactLength:{value:t,message:A.toString(r)}})}nonempty(t){return this.min(1,t)}};Te.create=(e,t)=>new Te({type:e,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...N(t)});function _r(e){if(e instanceof V){let t={};for(let r in e.shape){let n=e.shape[r];t[r]=Ce.create(_r(n))}return new V({...e._def,shape:()=>t})}else return e instanceof Te?new Te({...e._def,type:_r(e.element)}):e instanceof Ce?Ce.create(_r(e.unwrap())):e instanceof rt?rt.create(_r(e.unwrap())):e instanceof Oe?Oe.create(e.items.map(t=>_r(t))):e}var V=class extends B{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let t=this._def.shape(),r=$.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==E.object){let l=this._getOrReturnCtx(t);return _(l,{code:x.invalid_type,expected:E.object,received:l.parsedType}),R}let{status:n,ctx:o}=this._processInputParams(t),{shape:s,keys:i}=this._getCached(),a=[];if(!(this._def.catchall instanceof Le&&this._def.unknownKeys==="strip"))for(let l in o.data)i.includes(l)||a.push(l);let c=[];for(let l of i){let f=s[l],p=o.data[l];c.push({key:{status:"valid",value:l},value:f._parse(new Re(o,p,o.path,l)),alwaysSet:l in o.data})}if(this._def.catchall instanceof Le){let l=this._def.unknownKeys;if(l==="passthrough")for(let f of a)c.push({key:{status:"valid",value:f},value:{status:"valid",value:o.data[f]}});else if(l==="strict")a.length>0&&(_(o,{code:x.unrecognized_keys,keys:a}),n.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let f of a){let p=o.data[f];c.push({key:{status:"valid",value:f},value:l._parse(new Re(o,p,o.path,f)),alwaysSet:f in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let l=[];for(let f of c){let p=await f.key,d=await f.value;l.push({key:p,value:d,alwaysSet:f.alwaysSet})}return l}).then(l=>oe.mergeObjectSync(n,l)):oe.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(t){return A.errToObj,new V({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{let o=this._def.errorMap?.(r,n).message??n.defaultError;return r.code==="unrecognized_keys"?{message:A.errToObj(t).message??o}:{message:o}}}:{}})}strip(){return new V({...this._def,unknownKeys:"strip"})}passthrough(){return new V({...this._def,unknownKeys:"passthrough"})}extend(t){return new V({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new V({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:O.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new V({...this._def,catchall:t})}pick(t){let r={};for(let n of $.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new V({...this._def,shape:()=>r})}omit(t){let r={};for(let n of $.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new V({...this._def,shape:()=>r})}deepPartial(){return _r(this)}partial(t){let r={};for(let n of $.objectKeys(this.shape)){let o=this.shape[n];t&&!t[n]?r[n]=o:r[n]=o.optional()}return new V({...this._def,shape:()=>r})}required(t){let r={};for(let n of $.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let s=this.shape[n];for(;s instanceof Ce;)s=s._def.innerType;r[n]=s}return new V({...this._def,shape:()=>r})}keyof(){return bl($.objectKeys(this.shape))}};V.create=(e,t)=>new V({shape:()=>e,unknownKeys:"strip",catchall:Le.create(),typeName:O.ZodObject,...N(t)});V.strictCreate=(e,t)=>new V({shape:()=>e,unknownKeys:"strict",catchall:Le.create(),typeName:O.ZodObject,...N(t)});V.lazycreate=(e,t)=>new V({shape:e,unknownKeys:"strip",catchall:Le.create(),typeName:O.ZodObject,...N(t)});var qt=class extends B{_parse(t){let{ctx:r}=this._processInputParams(t),n=this._def.options;function o(s){for(let a of s)if(a.result.status==="valid")return a.result;for(let a of s)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;let i=s.map(a=>new de(a.ctx.common.issues));return _(r,{code:x.invalid_union,unionErrors:i}),R}if(r.common.async)return Promise.all(n.map(async s=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await s._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(o);{let s,i=[];for(let c of n){let l={...r,common:{...r.common,issues:[]},parent:null},f=c._parseSync({data:r.data,path:r.path,parent:l});if(f.status==="valid")return f;f.status==="dirty"&&!s&&(s={result:f,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(s)return r.common.issues.push(...s.ctx.common.issues),s.result;let a=i.map(c=>new de(c));return _(r,{code:x.invalid_union,unionErrors:a}),R}}get options(){return this._def.options}};qt.create=(e,t)=>new qt({options:e,typeName:O.ZodUnion,...N(t)});var ut=e=>e instanceof Wt?ut(e.schema):e instanceof Pe?ut(e.innerType()):e instanceof Yt?[e.value]:e instanceof tt?e.options:e instanceof Qt?$.objectValues(e.enum):e instanceof Xt?ut(e._def.innerType):e instanceof Gt?[void 0]:e instanceof Vt?[null]:e instanceof Ce?[void 0,...ut(e.unwrap())]:e instanceof rt?[null,...ut(e.unwrap())]:e instanceof En||e instanceof tr?ut(e.unwrap()):e instanceof Zt?ut(e._def.innerType):[],Ar=class extends B{_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==E.object)return _(r,{code:x.invalid_type,expected:E.object,received:r.parsedType}),R;let n=this.discriminator,o=r.data[n],s=this.optionsMap.get(o);return s?r.common.async?s._parseAsync({data:r.data,path:r.path,parent:r}):s._parseSync({data:r.data,path:r.path,parent:r}):(_(r,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),R)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,r,n){let o=new Map;for(let s of r){let i=ut(s.shape[t]);if(!i.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let a of i){if(o.has(a))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(a)}`);o.set(a,s)}}return new Ar({typeName:O.ZodDiscriminatedUnion,discriminator:t,options:r,optionsMap:o,...N(n)})}};function _a(e,t){let r=Xe(e),n=Xe(t);if(e===t)return{valid:!0,data:e};if(r===E.object&&n===E.object){let o=$.objectKeys(t),s=$.objectKeys(e).filter(a=>o.indexOf(a)!==-1),i={...e,...t};for(let a of s){let c=_a(e[a],t[a]);if(!c.valid)return{valid:!1};i[a]=c.data}return{valid:!0,data:i}}else if(r===E.array&&n===E.array){if(e.length!==t.length)return{valid:!1};let o=[];for(let s=0;s<e.length;s++){let i=e[s],a=t[s],c=_a(i,a);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}else return r===E.date&&n===E.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}var Jt=class extends B{_parse(t){let{status:r,ctx:n}=this._processInputParams(t),o=(s,i)=>{if(No(s)||No(i))return R;let a=_a(s.value,i.value);return a.valid?((Mo(s)||Mo(i))&&r.dirty(),{status:r.value,value:a.data}):(_(n,{code:x.invalid_intersection_types}),R)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([s,i])=>o(s,i)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Jt.create=(e,t,r)=>new Jt({left:e,right:t,typeName:O.ZodIntersection,...N(r)});var Oe=class extends B{_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==E.array)return _(n,{code:x.invalid_type,expected:E.array,received:n.parsedType}),R;if(n.data.length<this._def.items.length)return _(n,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&n.data.length>this._def.items.length&&(_(n,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let s=[...n.data].map((i,a)=>{let c=this._def.items[a]||this._def.rest;return c?c._parse(new Re(n,i,n.path,a)):null}).filter(i=>!!i);return n.common.async?Promise.all(s).then(i=>oe.mergeArray(r,i)):oe.mergeArray(r,s)}get items(){return this._def.items}rest(t){return new Oe({...this._def,rest:t})}};Oe.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Oe({items:e,typeName:O.ZodTuple,rest:null,...N(t)})};var zt=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==E.object)return _(n,{code:x.invalid_type,expected:E.object,received:n.parsedType}),R;let o=[],s=this._def.keyType,i=this._def.valueType;for(let a in n.data)o.push({key:s._parse(new Re(n,a,n.path,a)),value:i._parse(new Re(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?oe.mergeObjectAsync(r,o):oe.mergeObjectSync(r,o)}get element(){return this._def.valueType}static create(t,r,n){return r instanceof B?new zt({keyType:t,valueType:r,typeName:O.ZodRecord,...N(n)}):new zt({keyType:ke.create(),valueType:t,typeName:O.ZodRecord,...N(r)})}},kr=class extends B{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==E.map)return _(n,{code:x.invalid_type,expected:E.map,received:n.parsedType}),R;let o=this._def.keyType,s=this._def.valueType,i=[...n.data.entries()].map(([a,c],l)=>({key:o._parse(new Re(n,a,n.path,[l,"key"])),value:s._parse(new Re(n,c,n.path,[l,"value"]))}));if(n.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of i){let l=await c.key,f=await c.value;if(l.status==="aborted"||f.status==="aborted")return R;(l.status==="dirty"||f.status==="dirty")&&r.dirty(),a.set(l.value,f.value)}return{status:r.value,value:a}})}else{let a=new Map;for(let c of i){let l=c.key,f=c.value;if(l.status==="aborted"||f.status==="aborted")return R;(l.status==="dirty"||f.status==="dirty")&&r.dirty(),a.set(l.value,f.value)}return{status:r.value,value:a}}}};kr.create=(e,t,r)=>new kr({valueType:t,keyType:e,typeName:O.ZodMap,...N(r)});var ft=class extends B{_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==E.set)return _(n,{code:x.invalid_type,expected:E.set,received:n.parsedType}),R;let o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(_(n,{code:x.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(_(n,{code:x.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());let s=this._def.valueType;function i(c){let l=new Set;for(let f of c){if(f.status==="aborted")return R;f.status==="dirty"&&r.dirty(),l.add(f.value)}return{status:r.value,value:l}}let a=[...n.data.values()].map((c,l)=>s._parse(new Re(n,c,n.path,l)));return n.common.async?Promise.all(a).then(c=>i(c)):i(a)}min(t,r){return new ft({...this._def,minSize:{value:t,message:A.toString(r)}})}max(t,r){return new ft({...this._def,maxSize:{value:t,message:A.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}};ft.create=(e,t)=>new ft({valueType:e,minSize:null,maxSize:null,typeName:O.ZodSet,...N(t)});var At=class extends B{constructor(){super(...arguments),this.validate=this.implement}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==E.function)return _(r,{code:x.invalid_type,expected:E.function,received:r.parsedType}),R;function n(a,c){return _n({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,xr(),lt].filter(l=>!!l),issueData:{code:x.invalid_arguments,argumentsError:c}})}function o(a,c){return _n({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,xr(),lt].filter(l=>!!l),issueData:{code:x.invalid_return_type,returnTypeError:c}})}let s={errorMap:r.common.contextualErrorMap},i=r.data;if(this._def.returns instanceof Tt){let a=this;return pe(async function(...c){let l=new de([]),f=await a._def.args.parseAsync(c,s).catch(m=>{throw l.addIssue(n(c,m)),l}),p=await Reflect.apply(i,this,f);return await a._def.returns._def.type.parseAsync(p,s).catch(m=>{throw l.addIssue(o(p,m)),l})})}else{let a=this;return pe(function(...c){let l=a._def.args.safeParse(c,s);if(!l.success)throw new de([n(c,l.error)]);let f=Reflect.apply(i,this,l.data),p=a._def.returns.safeParse(f,s);if(!p.success)throw new de([o(f,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new At({...this._def,args:Oe.create(t).rest(dt.create())})}returns(t){return new At({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,r,n){return new At({args:t||Oe.create([]).rest(dt.create()),returns:r||dt.create(),typeName:O.ZodFunction,...N(n)})}},Wt=class extends B{get schema(){return this._def.getter()}_parse(t){let{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Wt.create=(e,t)=>new Wt({getter:e,typeName:O.ZodLazy,...N(t)});var Yt=class extends B{_parse(t){if(t.data!==this._def.value){let r=this._getOrReturnCtx(t);return _(r,{received:r.data,code:x.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:t.data}}get value(){return this._def.value}};Yt.create=(e,t)=>new Yt({value:e,typeName:O.ZodLiteral,...N(t)});function bl(e,t){return new tt({values:e,typeName:O.ZodEnum,...N(t)})}var tt=class extends B{_parse(t){if(typeof t.data!="string"){let r=this._getOrReturnCtx(t),n=this._def.values;return _(r,{expected:$.joinValues(n),received:r.parsedType,code:x.invalid_type}),R}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){let r=this._getOrReturnCtx(t),n=this._def.values;return _(r,{received:r.data,code:x.invalid_enum_value,options:n}),R}return pe(t.data)}get options(){return this._def.values}get enum(){let t={};for(let r of this._def.values)t[r]=r;return t}get Values(){let t={};for(let r of this._def.values)t[r]=r;return t}get Enum(){let t={};for(let r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return tt.create(t,{...this._def,...r})}exclude(t,r=this._def){return tt.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}};tt.create=bl;var Qt=class extends B{_parse(t){let r=$.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==E.string&&n.parsedType!==E.number){let o=$.objectValues(r);return _(n,{expected:$.joinValues(o),received:n.parsedType,code:x.invalid_type}),R}if(this._cache||(this._cache=new Set($.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let o=$.objectValues(r);return _(n,{received:n.data,code:x.invalid_enum_value,options:o}),R}return pe(t.data)}get enum(){return this._def.values}};Qt.create=(e,t)=>new Qt({values:e,typeName:O.ZodNativeEnum,...N(t)});var Tt=class extends B{unwrap(){return this._def.type}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==E.promise&&r.common.async===!1)return _(r,{code:x.invalid_type,expected:E.promise,received:r.parsedType}),R;let n=r.parsedType===E.promise?r.data:Promise.resolve(r.data);return pe(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Tt.create=(e,t)=>new Tt({type:e,typeName:O.ZodPromise,...N(t)});var Pe=class extends B{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:r,ctx:n}=this._processInputParams(t),o=this._def.effect||null,s={addIssue:i=>{_(n,i),i.fatal?r.abort():r.dirty()},get path(){return n.path}};if(s.addIssue=s.addIssue.bind(s),o.type==="preprocess"){let i=o.transform(n.data,s);if(n.common.async)return Promise.resolve(i).then(async a=>{if(r.value==="aborted")return R;let c=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return c.status==="aborted"?R:c.status==="dirty"?jt(c.value):r.value==="dirty"?jt(c.value):c});{if(r.value==="aborted")return R;let a=this._def.schema._parseSync({data:i,path:n.path,parent:n});return a.status==="aborted"?R:a.status==="dirty"?jt(a.value):r.value==="dirty"?jt(a.value):a}}if(o.type==="refinement"){let i=a=>{let c=o.refinement(a,s);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?R:(a.status==="dirty"&&r.dirty(),i(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?R:(a.status==="dirty"&&r.dirty(),i(a.value).then(()=>({status:r.value,value:a.value}))))}if(o.type==="transform")if(n.common.async===!1){let i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!St(i))return R;let a=o.transform(i.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>St(i)?Promise.resolve(o.transform(i.value,s)).then(a=>({status:r.value,value:a})):R);$.assertNever(o)}};Pe.create=(e,t,r)=>new Pe({schema:e,typeName:O.ZodEffects,effect:t,...N(r)});Pe.createWithPreprocess=(e,t,r)=>new Pe({schema:t,effect:{type:"preprocess",transform:e},typeName:O.ZodEffects,...N(r)});var Ce=class extends B{_parse(t){return this._getType(t)===E.undefined?pe(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Ce.create=(e,t)=>new Ce({innerType:e,typeName:O.ZodOptional,...N(t)});var rt=class extends B{_parse(t){return this._getType(t)===E.null?pe(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};rt.create=(e,t)=>new rt({innerType:e,typeName:O.ZodNullable,...N(t)});var Xt=class extends B{_parse(t){let{ctx:r}=this._processInputParams(t),n=r.data;return r.parsedType===E.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Xt.create=(e,t)=>new Xt({innerType:e,typeName:O.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...N(t)});var Zt=class extends B{_parse(t){let{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return wr(o)?o.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new de(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new de(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Zt.create=(e,t)=>new Zt({innerType:e,typeName:O.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...N(t)});var Tr=class extends B{_parse(t){if(this._getType(t)!==E.nan){let n=this._getOrReturnCtx(t);return _(n,{code:x.invalid_type,expected:E.nan,received:n.parsedType}),R}return{status:"valid",value:t.data}}};Tr.create=e=>new Tr({typeName:O.ZodNaN,...N(e)});var xy=Symbol("zod_brand"),En=class extends B{_parse(t){let{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}},er=class extends B{_parse(t){let{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?R:s.status==="dirty"?(r.dirty(),jt(s.value)):this._def.out._parseAsync({data:s.value,path:n.path,parent:n})})();{let o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?R:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(t,r){return new er({in:t,out:r,typeName:O.ZodPipeline})}},tr=class extends B{_parse(t){let r=this._def.innerType._parse(t),n=o=>(St(o)&&(o.value=Object.freeze(o.value)),o);return wr(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}};tr.create=(e,t)=>new tr({innerType:e,typeName:O.ZodReadonly,...N(t)});function hl(e,t){let r=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof r=="string"?{message:r}:r}function xl(e,t={},r){return e?kt.create().superRefine((n,o)=>{let s=e(n);if(s instanceof Promise)return s.then(i=>{if(!i){let a=hl(t,n),c=a.fatal??r??!0;o.addIssue({code:"custom",...a,fatal:c})}});if(!s){let i=hl(t,n),a=i.fatal??r??!0;o.addIssue({code:"custom",...i,fatal:a})}}):kt.create()}var wy={object:V.lazycreate},O;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(O||(O={}));var _y=(e,t={message:`Input not instance of ${e.name}`})=>xl(r=>r instanceof e,t),wl=ke.create,_l=Ze.create,Ey=Tr.create,Sy=et.create,El=Kt.create,Ay=pt.create,ky=Er.create,Ty=Gt.create,Iy=Vt.create,Cy=kt.create,Ry=dt.create,Oy=Le.create,Py=Sr.create,Ny=Te.create,My=V.create,Dy=V.strictCreate,By=qt.create,$y=Ar.create,Uy=Jt.create,Ly=Oe.create,Fy=zt.create,Hy=kr.create,jy=ft.create,Ky=At.create,Gy=Wt.create,Vy=Yt.create,qy=tt.create,Jy=Qt.create,zy=Tt.create,Wy=Pe.create,Yy=Ce.create,Qy=rt.create,Xy=Pe.createWithPreprocess,Zy=er.create,ev=()=>wl().optional(),tv=()=>_l().optional(),rv=()=>El().optional(),nv={string:e=>ke.create({...e,coerce:!0}),number:e=>Ze.create({...e,coerce:!0}),boolean:e=>Kt.create({...e,coerce:!0}),bigint:e=>et.create({...e,coerce:!0}),date:e=>pt.create({...e,coerce:!0})};var ov=R;function sv({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:r="system"}){let n=[];for(let{role:o,content:s}of e)switch(o){case"system":{switch(r){case"system":{n.push({role:"system",content:s});break}case"developer":{n.push({role:"developer",content:s});break}case"remove":break;default:{let i=r;throw new Error(`Unsupported system message mode: ${i}`)}}break}case"user":{if(s.length===1&&s[0].type==="text"){n.push({role:"user",content:s[0].text});break}n.push({role:"user",content:s.map(i=>{var a,c,l;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(a=i.mimeType)!=null?a:"image/jpeg"};base64,${Oo(i.image)}`,detail:(l=(c=i.providerMetadata)==null?void 0:c.openai)==null?void 0:l.imageDetail}};case"file":{if(i.data instanceof URL)throw new Y({functionality:"'File content parts with URL data' functionality not supported."});switch(i.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:i.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:i.data,format:"mp3"}};default:throw new Y({functionality:`File content part type ${i.mimeType} in user messages`})}}}})});break}case"assistant":{let i="",a=[];for(let c of s)switch(c.type){case"text":{i+=c.text;break}case"tool-call":{a.push({id:c.toolCallId,type:"function",function:{name:c.toolName,arguments:JSON.stringify(c.args)}});break}default:{let l=c;throw new Error(`Unsupported part: ${l}`)}}if(t){if(a.length>1)throw new Y({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});n.push({role:"assistant",content:i,function_call:a.length>0?a[0].function:void 0})}else n.push({role:"assistant",content:i,tool_calls:a.length>0?a:void 0});break}case"tool":{for(let i of s)t?n.push({role:"function",name:i.toolName,content:JSON.stringify(i.result)}):n.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result)});break}default:{let i=o;throw new Error(`Unsupported role: ${i}`)}}return n}function Sl(e){var t,r;return(r=(t=e?.content)==null?void 0:t.map(({token:n,logprob:o,top_logprobs:s})=>({token:n,logprob:o,topLogprobs:s?s.map(({token:i,logprob:a})=>({token:i,logprob:a})):[]})))!=null?r:void 0}function Do(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Ea=u.object({error:u.object({message:u.string(),type:u.string().nullish(),param:u.any().nullish(),code:u.union([u.string(),u.number()]).nullish()})}),Ir=Ro({errorSchema:Ea,errorToMessage:e=>e.error.message});function Bo({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function av({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r}){var n;let o=(n=e.tools)!=null&&n.length?e.tools:void 0,s=[];if(o==null)return{tools:void 0,tool_choice:void 0,toolWarnings:s};let i=e.toolChoice;if(t){let l=[];for(let p of o)p.type==="provider-defined"?s.push({type:"unsupported-tool",tool:p}):l.push({name:p.name,description:p.description,parameters:p.parameters});if(i==null)return{functions:l,function_call:void 0,toolWarnings:s};switch(i.type){case"auto":case"none":case void 0:return{functions:l,function_call:void 0,toolWarnings:s};case"required":throw new Y({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:l,function_call:{name:i.toolName},toolWarnings:s}}}let a=[];for(let l of o)l.type==="provider-defined"?s.push({type:"unsupported-tool",tool:l}):a.push({type:"function",function:{name:l.name,description:l.description,parameters:l.parameters,strict:r?!0:void 0}});if(i==null)return{tools:a,tool_choice:void 0,toolWarnings:s};let c=i.type;switch(c){case"auto":case"none":case"required":return{tools:a,tool_choice:c,toolWarnings:s};case"tool":return{tools:a,tool_choice:{type:"function",function:{name:i.toolName}},toolWarnings:s};default:{let l=c;throw new Y({functionality:`Unsupported tool choice type: ${l}`})}}}var iv=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return(e=this.settings.structuredOutputs)!=null?e:$o(this.modelId)}get defaultObjectGenerationMode(){return uv(this.modelId)?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f,providerMetadata:p}){var d,m,h,y,g,v,b,w;let S=e.type,T=[];s!=null&&T.push({type:"unsupported-setting",setting:"topK"}),l?.type==="json"&&l.schema!=null&&!this.supportsStructuredOutputs&&T.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let U=this.settings.useLegacyFunctionCalling;if(U&&this.settings.parallelToolCalls===!0)throw new Y({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(U&&this.supportsStructuredOutputs)throw new Y({functionality:"structuredOutputs with useLegacyFunctionCalling"});Al(this.modelId)==="remove"&&t.some(G=>G.role==="system")&&T.push({type:"other",message:"system messages are removed for this model"});let I={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:n,top_p:o,frequency_penalty:i,presence_penalty:a,response_format:l?.type==="json"?this.supportsStructuredOutputs&&l.schema!=null?{type:"json_schema",json_schema:{schema:l.schema,strict:!0,name:(d=l.name)!=null?d:"response",description:l.description}}:{type:"json_object"}:void 0,stop:c,seed:f,max_completion_tokens:(m=p?.openai)==null?void 0:m.maxCompletionTokens,store:(h=p?.openai)==null?void 0:h.store,metadata:(y=p?.openai)==null?void 0:y.metadata,prediction:(g=p?.openai)==null?void 0:g.prediction,reasoning_effort:(b=(v=p?.openai)==null?void 0:v.reasoningEffort)!=null?b:this.settings.reasoningEffort,messages:sv({prompt:t,useLegacyFunctionCalling:U,systemMessageMode:Al(this.modelId)})};switch($o(this.modelId)&&(I.temperature!=null&&(I.temperature=void 0,T.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),I.top_p!=null&&(I.top_p=void 0,T.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),I.frequency_penalty!=null&&(I.frequency_penalty=void 0,T.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),I.presence_penalty!=null&&(I.presence_penalty=void 0,T.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),I.logit_bias!=null&&(I.logit_bias=void 0,T.push({type:"other",message:"logitBias is not supported for reasoning models"})),I.logprobs!=null&&(I.logprobs=void 0,T.push({type:"other",message:"logprobs is not supported for reasoning models"})),I.top_logprobs!=null&&(I.top_logprobs=void 0,T.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),I.max_tokens!=null&&(I.max_completion_tokens==null&&(I.max_completion_tokens=I.max_tokens),I.max_tokens=void 0)),S){case"regular":{let{tools:G,tool_choice:F,functions:q,function_call:J,toolWarnings:ee}=av({mode:e,useLegacyFunctionCalling:U,structuredOutputs:this.supportsStructuredOutputs});return{args:{...I,tools:G,tool_choice:F,functions:q,function_call:J},warnings:[...T,...ee]}}case"object-json":return{args:{...I,response_format:this.supportsStructuredOutputs&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:(w=e.name)!=null?w:"response",description:e.description}}:{type:"json_object"}},warnings:T};case"object-tool":return{args:U?{...I,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...I,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:this.supportsStructuredOutputs?!0:void 0}}]},warnings:T};default:{let G=S;throw new Error(`Unsupported type: ${G}`)}}}async doGenerate(e){var t,r,n,o,s,i,a,c;let{args:l,warnings:f}=this.getArgs(e),{responseHeaders:p,value:d}=await Ae({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Se(this.config.headers(),e.headers),body:l,failedResponseHandler:Ir,successfulResponseHandler:Qe(cv),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:m,...h}=l,y=d.choices[0],g=(t=d.usage)==null?void 0:t.completion_tokens_details,v=(r=d.usage)==null?void 0:r.prompt_tokens_details,b={openai:{}};return g?.reasoning_tokens!=null&&(b.openai.reasoningTokens=g?.reasoning_tokens),g?.accepted_prediction_tokens!=null&&(b.openai.acceptedPredictionTokens=g?.accepted_prediction_tokens),g?.rejected_prediction_tokens!=null&&(b.openai.rejectedPredictionTokens=g?.rejected_prediction_tokens),v?.cached_tokens!=null&&(b.openai.cachedPromptTokens=v?.cached_tokens),{text:(n=y.message.content)!=null?n:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&y.message.function_call?[{toolCallType:"function",toolCallId:Ye(),toolName:y.message.function_call.name,args:y.message.function_call.arguments}]:(o=y.message.tool_calls)==null?void 0:o.map(w=>{var S;return{toolCallType:"function",toolCallId:(S=w.id)!=null?S:Ye(),toolName:w.function.name,args:w.function.arguments}}),finishReason:Do(y.finish_reason),usage:{promptTokens:(i=(s=d.usage)==null?void 0:s.prompt_tokens)!=null?i:NaN,completionTokens:(c=(a=d.usage)==null?void 0:a.completion_tokens)!=null?c:NaN},rawCall:{rawPrompt:m,rawSettings:h},rawResponse:{headers:p},request:{body:JSON.stringify(l)},response:Bo(d),warnings:f,logprobs:Sl(y.logprobs),providerMetadata:b}}async doStream(e){var t;if((t=this.settings.simulateStreaming)!=null?t:dv(this.modelId)){let g=await this.doGenerate(e);return{stream:new ReadableStream({start(b){if(b.enqueue({type:"response-metadata",...g.response}),g.text&&b.enqueue({type:"text-delta",textDelta:g.text}),g.toolCalls)for(let w of g.toolCalls)b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:w.toolCallId,toolName:w.toolName,argsTextDelta:w.args}),b.enqueue({type:"tool-call",...w});b.enqueue({type:"finish",finishReason:g.finishReason,usage:g.usage,logprobs:g.logprobs,providerMetadata:g.providerMetadata}),b.close()}}),rawCall:g.rawCall,rawResponse:g.rawResponse,warnings:g.warnings}}let{args:r,warnings:n}=this.getArgs(e),o={...r,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:s,value:i}=await Ae({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Se(this.config.headers(),e.headers),body:o,failedResponseHandler:Ir,successfulResponseHandler:br(lv),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:a,...c}=r,l=[],f="unknown",p={promptTokens:void 0,completionTokens:void 0},d,m=!0,{useLegacyFunctionCalling:h}=this.settings,y={openai:{}};return{stream:i.pipeThrough(new TransformStream({transform(g,v){var b,w,S,T,U,I,G,F,q,J,ee,te;if(!g.success){f="error",v.enqueue({type:"error",error:g.error});return}let re=g.value;if("error"in re){f="error",v.enqueue({type:"error",error:re.error});return}if(m&&(m=!1,v.enqueue({type:"response-metadata",...Bo(re)})),re.usage!=null){let{prompt_tokens:H,completion_tokens:ne,prompt_tokens_details:ue,completion_tokens_details:z}=re.usage;p={promptTokens:H??void 0,completionTokens:ne??void 0},z?.reasoning_tokens!=null&&(y.openai.reasoningTokens=z?.reasoning_tokens),z?.accepted_prediction_tokens!=null&&(y.openai.acceptedPredictionTokens=z?.accepted_prediction_tokens),z?.rejected_prediction_tokens!=null&&(y.openai.rejectedPredictionTokens=z?.rejected_prediction_tokens),ue?.cached_tokens!=null&&(y.openai.cachedPromptTokens=ue?.cached_tokens)}let j=re.choices[0];if(j?.finish_reason!=null&&(f=Do(j.finish_reason)),j?.delta==null)return;let W=j.delta;W.content!=null&&v.enqueue({type:"text-delta",textDelta:W.content});let ie=Sl(j?.logprobs);ie?.length&&(d===void 0&&(d=[]),d.push(...ie));let Ft=h&&W.function_call!=null?[{type:"function",id:Ye(),function:W.function_call,index:0}]:W.tool_calls;if(Ft!=null)for(let H of Ft){let ne=H.index;if(l[ne]==null){if(H.type!=="function")throw new Et({data:H,message:"Expected 'function' type."});if(H.id==null)throw new Et({data:H,message:"Expected 'id' to be a string."});if(((b=H.function)==null?void 0:b.name)==null)throw new Et({data:H,message:"Expected 'function.name' to be a string."});l[ne]={id:H.id,type:"function",function:{name:H.function.name,arguments:(w=H.function.arguments)!=null?w:""},hasFinished:!1};let z=l[ne];((S=z.function)==null?void 0:S.name)!=null&&((T=z.function)==null?void 0:T.arguments)!=null&&(z.function.arguments.length>0&&v.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:z.id,toolName:z.function.name,argsTextDelta:z.function.arguments}),vr(z.function.arguments)&&(v.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(U=z.id)!=null?U:Ye(),toolName:z.function.name,args:z.function.arguments}),z.hasFinished=!0));continue}let ue=l[ne];ue.hasFinished||(((I=H.function)==null?void 0:I.arguments)!=null&&(ue.function.arguments+=(F=(G=H.function)==null?void 0:G.arguments)!=null?F:""),v.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:ue.id,toolName:ue.function.name,argsTextDelta:(q=H.function.arguments)!=null?q:""}),((J=ue.function)==null?void 0:J.name)!=null&&((ee=ue.function)==null?void 0:ee.arguments)!=null&&vr(ue.function.arguments)&&(v.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(te=ue.id)!=null?te:Ye(),toolName:ue.function.name,args:ue.function.arguments}),ue.hasFinished=!0))}},flush(g){var v,b;g.enqueue({type:"finish",finishReason:f,logprobs:d,usage:{promptTokens:(v=p.promptTokens)!=null?v:NaN,completionTokens:(b=p.completionTokens)!=null?b:NaN},...y!=null?{providerMetadata:y}:{}})}})),rawCall:{rawPrompt:a,rawSettings:c},rawResponse:{headers:s},request:{body:JSON.stringify(o)},warnings:n}}},Tl=u.object({prompt_tokens:u.number().nullish(),completion_tokens:u.number().nullish(),prompt_tokens_details:u.object({cached_tokens:u.number().nullish()}).nullish(),completion_tokens_details:u.object({reasoning_tokens:u.number().nullish(),accepted_prediction_tokens:u.number().nullish(),rejected_prediction_tokens:u.number().nullish()}).nullish()}).nullish(),cv=u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({message:u.object({role:u.literal("assistant").nullish(),content:u.string().nullish(),function_call:u.object({arguments:u.string(),name:u.string()}).nullish(),tool_calls:u.array(u.object({id:u.string().nullish(),type:u.literal("function"),function:u.object({name:u.string(),arguments:u.string()})})).nullish()}),index:u.number(),logprobs:u.object({content:u.array(u.object({token:u.string(),logprob:u.number(),top_logprobs:u.array(u.object({token:u.string(),logprob:u.number()}))})).nullable()}).nullish(),finish_reason:u.string().nullish()})),usage:Tl}),lv=u.union([u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({delta:u.object({role:u.enum(["assistant"]).nullish(),content:u.string().nullish(),function_call:u.object({name:u.string().optional(),arguments:u.string().optional()}).nullish(),tool_calls:u.array(u.object({index:u.number(),id:u.string().nullish(),type:u.literal("function").optional(),function:u.object({name:u.string().nullish(),arguments:u.string().nullish()})})).nullish()}).nullish(),logprobs:u.object({content:u.array(u.object({token:u.string(),logprob:u.number(),top_logprobs:u.array(u.object({token:u.string(),logprob:u.number()}))})).nullable()}).nullish(),finish_reason:u.string().nullable().optional(),index:u.number()})),usage:Tl}),Ea]);function $o(e){return e==="o1"||e.startsWith("o1-")||e==="o3"||e.startsWith("o3-")}function uv(e){return e.startsWith("gpt-4o-audio-preview")}function Al(e){var t,r;return $o(e)?(r=(t=Il[e])==null?void 0:t.systemMessageMode)!=null?r:"developer":"system"}function dv(e){var t,r;return $o(e)?(r=(t=Il[e])==null?void 0:t.simulateStreamingByDefault)!=null?r:!0:!1}var Il={"o1-mini":{systemMessageMode:"remove",simulateStreamingByDefault:!1},"o1-mini-2024-09-12":{systemMessageMode:"remove",simulateStreamingByDefault:!1},"o1-preview":{systemMessageMode:"remove",simulateStreamingByDefault:!1},"o1-preview-2024-09-12":{systemMessageMode:"remove",simulateStreamingByDefault:!1}};function pv({prompt:e,inputFormat:t,user:r="user",assistant:n="assistant"}){if(t==="prompt"&&e.length===1&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let o="";e[0].role==="system"&&(o+=`${e[0].content}

`,e=e.slice(1));for(let{role:s,content:i}of e)switch(s){case"system":throw new $c({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let a=i.map(c=>{switch(c.type){case"text":return c.text;case"image":throw new Y({functionality:"images"})}}).join("");o+=`${r}:
${a}

`;break}case"assistant":{let a=i.map(c=>{switch(c.type){case"text":return c.text;case"tool-call":throw new Y({functionality:"tool-call messages"})}}).join("");o+=`${n}:
${a}

`;break}case"tool":throw new Y({functionality:"tool messages"});default:{let a=s;throw new Error(`Unsupported role: ${a}`)}}return o+=`${n}:
`,{prompt:o,stopSequences:[`
${r}:`]}}function kl(e){return e?.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([n,o])=>({token:n,logprob:o})):[]}))}var fv=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:n,temperature:o,topP:s,topK:i,frequencyPenalty:a,presencePenalty:c,stopSequences:l,responseFormat:f,seed:p}){var d;let m=e.type,h=[];i!=null&&h.push({type:"unsupported-setting",setting:"topK"}),f!=null&&f.type!=="text"&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:y,stopSequences:g}=pv({prompt:r,inputFormat:t}),v=[...g??[],...l??[]],b={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:o,top_p:s,frequency_penalty:a,presence_penalty:c,seed:p,prompt:y,stop:v.length>0?v:void 0};switch(m){case"regular":{if((d=e.tools)!=null&&d.length)throw new Y({functionality:"tools"});if(e.toolChoice)throw new Y({functionality:"toolChoice"});return{args:b,warnings:h}}case"object-json":throw new Y({functionality:"object-json mode"});case"object-tool":throw new Y({functionality:"object-tool mode"});default:{let w=m;throw new Error(`Unsupported type: ${w}`)}}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:n,value:o}=await Ae({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Se(this.config.headers(),e.headers),body:t,failedResponseHandler:Ir,successfulResponseHandler:Qe(mv),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:s,...i}=t,a=o.choices[0];return{text:a.text,usage:{promptTokens:o.usage.prompt_tokens,completionTokens:o.usage.completion_tokens},finishReason:Do(a.finish_reason),logprobs:kl(a.logprobs),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:n},response:Bo(o),warnings:r,request:{body:JSON.stringify(t)}}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),n={...t,stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0},{responseHeaders:o,value:s}=await Ae({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Se(this.config.headers(),e.headers),body:n,failedResponseHandler:Ir,successfulResponseHandler:br(hv),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:i,...a}=t,c="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},f,p=!0;return{stream:s.pipeThrough(new TransformStream({transform(d,m){if(!d.success){c="error",m.enqueue({type:"error",error:d.error});return}let h=d.value;if("error"in h){c="error",m.enqueue({type:"error",error:h.error});return}p&&(p=!1,m.enqueue({type:"response-metadata",...Bo(h)})),h.usage!=null&&(l={promptTokens:h.usage.prompt_tokens,completionTokens:h.usage.completion_tokens});let y=h.choices[0];y?.finish_reason!=null&&(c=Do(y.finish_reason)),y?.text!=null&&m.enqueue({type:"text-delta",textDelta:y.text});let g=kl(y?.logprobs);g?.length&&(f===void 0&&(f=[]),f.push(...g))},flush(d){d.enqueue({type:"finish",finishReason:c,logprobs:f,usage:l})}})),rawCall:{rawPrompt:i,rawSettings:a},rawResponse:{headers:o},warnings:r,request:{body:JSON.stringify(n)}}}},mv=u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({text:u.string(),finish_reason:u.string(),logprobs:u.object({tokens:u.array(u.string()),token_logprobs:u.array(u.number()),top_logprobs:u.array(u.record(u.string(),u.number())).nullable()}).nullish()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()})}),hv=u.union([u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({text:u.string(),finish_reason:u.string().nullish(),index:u.number(),logprobs:u.object({tokens:u.array(u.string()),token_logprobs:u.array(u.number()),top_logprobs:u.array(u.record(u.string(),u.number())).nullable()}).nullish()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()}).nullish()}),Ea]),gv=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!0}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new el({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:n,value:o}=await Ae({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:Se(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:Ir,successfulResponseHandler:Qe(yv),abortSignal:r,fetch:this.config.fetch});return{embeddings:o.data.map(s=>s.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,rawResponse:{headers:n}}}},yv=u.object({data:u.array(u.object({embedding:u.array(u.number())})),usage:u.object({prompt_tokens:u.number()}).nullish()}),vv={"dall-e-3":1,"dall-e-2":10},bv=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return(t=(e=this.settings.maxImagesPerCall)!=null?e:vv[this.modelId])!=null?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:n,seed:o,providerOptions:s,headers:i,abortSignal:a}){var c,l,f,p;let d=[];n!=null&&d.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),o!=null&&d.push({type:"unsupported-setting",setting:"seed"});let m=(f=(l=(c=this.config._internal)==null?void 0:c.currentDate)==null?void 0:l.call(c))!=null?f:new Date,{value:h,responseHeaders:y}=await Ae({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:Se(this.config.headers(),i),body:{model:this.modelId,prompt:e,n:t,size:r,...(p=s.openai)!=null?p:{},response_format:"b64_json"},failedResponseHandler:Ir,successfulResponseHandler:Qe(xv),abortSignal:a,fetch:this.config.fetch});return{images:h.data.map(g=>g.b64_json),warnings:d,response:{timestamp:m,modelId:this.modelId,headers:y}}}},xv=u.object({data:u.array(u.object({b64_json:u.string()}))});function X(e={}){var t,r,n;let o=(t=Po(e.baseURL))!=null?t:"https://api.openai.com/v1",s=(r=e.compatibility)!=null?r:"compatible",i=(n=e.name)!=null?n:"openai",a=()=>({Authorization:`Bearer ${Io({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),c=(h,y={})=>new iv(h,y,{provider:`${i}.chat`,url:({path:g})=>`${o}${g}`,headers:a,compatibility:s,fetch:e.fetch}),l=(h,y={})=>new fv(h,y,{provider:`${i}.completion`,url:({path:g})=>`${o}${g}`,headers:a,compatibility:s,fetch:e.fetch}),f=(h,y={})=>new gv(h,y,{provider:`${i}.embedding`,url:({path:g})=>`${o}${g}`,headers:a,fetch:e.fetch}),p=(h,y={})=>new bv(h,y,{provider:`${i}.image`,url:({path:g})=>`${o}${g}`,headers:a,fetch:e.fetch}),d=(h,y)=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return h==="gpt-3.5-turbo-instruct"?l(h,y):c(h,y)},m=function(h,y){return d(h,y)};return m.languageModel=d,m.chat=c,m.completion=l,m.embedding=f,m.textEmbedding=f,m.textEmbeddingModel=f,m.image=p,m}var Tk=X({compatibility:"strict"});var M=class{cachedDynamicModels;getApiKeyLink;labelForGetApiKey;icon;getProviderBaseUrlAndKey(t){let{apiKeys:r,providerSettings:n,serverEnv:o,defaultBaseUrlKey:s,defaultApiTokenKey:i}=t,a=n?.baseUrl,c=rr.getInstance();a&&a.length==0&&(a=void 0);let l=this.config.baseUrlKey||s,f=a||o?.[l]||process?.env?.[l]||c.env?.[l]||this.config.baseUrl;f&&f.endsWith("/")&&(f=f.slice(0,-1));let p=this.config.apiTokenKey||i,d=r?.[this.name]||o?.[p]||process?.env?.[p]||c.env?.[p];return{baseUrl:f,apiKey:d}}getModelsFromCache(t){if(!this.cachedDynamicModels)return null;let r=this.cachedDynamicModels.cacheId,n=this.getDynamicModelsCacheKey(t);return r!==n?(this.cachedDynamicModels=void 0,null):this.cachedDynamicModels.models}getDynamicModelsCacheKey(t){return JSON.stringify({apiKeys:t.apiKeys?.[this.name],providerSettings:t.providerSettings?.[this.name],serverEnv:t.serverEnv})}storeDynamicModels(t,r){let n=this.getDynamicModelsCacheKey(t);this.cachedDynamicModels={cacheId:n,models:r}}};function Uo(e,t,r){return X({baseURL:e,apiKey:t})(r)}var hc={};gc(hc,{AmazonBedrockProvider:()=>wo,AnthropicProvider:()=>Tn,CohereProvider:()=>Pn,DeepseekProvider:()=>Mn,GithubProvider:()=>_o,GoogleProvider:()=>$n,GroqProvider:()=>Un,HuggingFaceProvider:()=>Ln,HyperbolicProvider:()=>Qn,LMStudioProvider:()=>Fn,MistralProvider:()=>Hn,MoonshotProvider:()=>Eo,OllamaProvider:()=>jn,OpenAILikeProvider:()=>qn,OpenAIProvider:()=>Jn,OpenRouterProvider:()=>Vn,PerplexityProvider:()=>zn,TogetherProvider:()=>Wn,XAIProvider:()=>Yn});var Cr=(e,t=21)=>(r=t)=>{let n="",o=r;for(;o--;)n+=e[Math.random()*e.length|0];return n};var Cl="vercel.ai.error",wv=Symbol.for(Cl),Rl,_v=class Ol extends Error{constructor({name:t,message:r,cause:n}){super(r),this[Rl]=!0,this.name=t,this.cause=n}static isInstance(t){return Ol.hasMarker(t,Cl)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}toJSON(){return{name:this.name,message:this.message}}};Rl=wv;var Ne=_v,Sa="AI_APICallError",Pl=`vercel.ai.error.${Sa}`,Ev=Symbol.for(Pl),Nl,Fe=class extends Ne{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:o,responseBody:s,cause:i,isRetryable:a=n!=null&&(n===408||n===409||n===429||n>=500),data:c}){super({name:Sa,message:e,cause:i}),this[Nl]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=o,this.responseBody=s,this.isRetryable=a,this.data=c}static isInstance(e){return Ne.hasMarker(e,Pl)}static isAPICallError(e){return e instanceof Error&&e.name===Sa&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};Nl=Ev;var Aa="AI_EmptyResponseBodyError",Ml=`vercel.ai.error.${Aa}`,Sv=Symbol.for(Ml),Dl,Bl=class extends Ne{constructor({message:e="Empty response body"}={}){super({name:Aa,message:e}),this[Dl]=!0}static isInstance(e){return Ne.hasMarker(e,Ml)}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name===Aa}};Dl=Sv;function $l(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Av="AI_InvalidPromptError",kv=`vercel.ai.error.${Av}`,Tv=Symbol.for(kv),Iv;Iv=Tv;var Cv="AI_InvalidResponseDataError",Rv=`vercel.ai.error.${Cv}`,Ov=Symbol.for(Rv),Pv;Pv=Ov;var ka="AI_JSONParseError",Ul=`vercel.ai.error.${ka}`,Nv=Symbol.for(Ul),Ll,Sn=class extends Ne{constructor({text:e,cause:t}){super({name:ka,message:`JSON parsing failed: Text: ${e}.
Error message: ${$l(t)}`,cause:t}),this[Ll]=!0,this.text=e}static isInstance(e){return Ne.hasMarker(e,Ul)}static isJSONParseError(e){return e instanceof Error&&e.name===ka&&typeof e.text=="string"&&typeof e.cause=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};Ll=Nv;var Ta="AI_LoadAPIKeyError",Fl=`vercel.ai.error.${Ta}`,Mv=Symbol.for(Fl),Hl,An=class extends Ne{constructor({message:e}){super({name:Ta,message:e}),this[Hl]=!0}static isInstance(e){return Ne.hasMarker(e,Fl)}static isLoadAPIKeyError(e){return e instanceof Error&&e.name===Ta}};Hl=Mv;var Dv="AI_LoadSettingError",Bv=`vercel.ai.error.${Dv}`,$v=Symbol.for(Bv),Uv;Uv=$v;var Lv="AI_NoContentGeneratedError",Fv=`vercel.ai.error.${Lv}`,Hv=Symbol.for(Fv),jv;jv=Hv;var Kv="AI_TooManyEmbeddingValuesForCallError",Gv=`vercel.ai.error.${Kv}`,Vv=Symbol.for(Gv),qv;qv=Vv;var Ia="AI_TypeValidationError",jl=`vercel.ai.error.${Ia}`,Jv=Symbol.for(jl),Kl,nr=class extends Ne{constructor({value:e,cause:t}){super({name:Ia,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${$l(t)}`,cause:t}),this[Kl]=!0,this.value=e}static isInstance(e){return Ne.hasMarker(e,jl)}static isTypeValidationError(e){return e instanceof Error&&e.name===Ia}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};Kl=Jv;var Ca="AI_UnsupportedFunctionalityError",Gl=`vercel.ai.error.${Ca}`,zv=Symbol.for(Gl),Vl,kn=class extends Ne{constructor({functionality:e}){super({name:Ca,message:`'${e}' functionality not supported.`}),this[Vl]=!0,this.functionality=e}static isInstance(e){return Ne.hasMarker(e,Gl)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===Ca&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};Vl=zv;var Na=ct(Ht(),1);function ql(e){let t,r,n,o,s,i,a;return c(),{feed:l,reset:c};function c(){t=!0,r="",n=0,o=-1,s=void 0,i=void 0,a=""}function l(p){r=r?r+p:p,t&&Wv(r)&&(r=r.slice(Jl.length)),t=!1;let d=r.length,m=0,h=!1;for(;m<d;){h&&(r[m]===`
`&&++m,h=!1);let y=-1,g=o,v;for(let b=n;y<0&&b<d;++b)v=r[b],v===":"&&g<0?g=b-m:v==="\r"?(h=!0,y=b-m):v===`
`&&(y=b-m);if(y<0){n=d-m,o=g;break}else n=0,o=-1;f(r,m,g,y),m+=y+1}m===d?r="":m>0&&(r=r.slice(m))}function f(p,d,m,h){if(h===0){a.length>0&&(e({type:"event",id:s,event:i||void 0,data:a.slice(0,-1)}),a="",s=void 0),i=void 0;return}let y=m<0,g=p.slice(d,d+(y?h:m)),v=0;y?v=h:p[d+m+1]===" "?v=m+2:v=m+1;let b=d+v,w=h-v,S=p.slice(b,b+w).toString();if(g==="data")a+=S?"".concat(S,`
`):`
`;else if(g==="event")i=S;else if(g==="id"&&!S.includes("\0"))s=S;else if(g==="retry"){let T=parseInt(S,10);Number.isNaN(T)||e({type:"reconnect-interval",value:T})}}}var Jl=[239,187,191];function Wv(e){return Jl.every((t,r)=>e.charCodeAt(r)===t)}var It=class extends TransformStream{constructor(){let t;super({start(r){t=ql(n=>{n.type==="event"&&r.enqueue(n)})},transform(r){t.feed(r)}})}};function Pa(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function Lo(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r}),t}var zk=Cr("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function Ra(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function zl({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new An({message:`${n} API key must be a string.`});if(typeof process>"u")throw new An({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new An({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new An({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var Oa=Symbol.for("vercel.ai.validator");function Yv(e){return{[Oa]:!0,validate:e}}function Qv(e){return typeof e=="object"&&e!==null&&Oa in e&&e[Oa]===!0&&"validate"in e}function Xv(e){return Yv(t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Zv({value:e,schema:t}){let r=Wl({value:e,schema:t});if(!r.success)throw new nr({value:e,cause:r.error});return r.value}function Wl({value:e,schema:t}){let r=Qv(t)?t:Xv(t);try{if(r.validate==null)return{success:!0,value:e};let n=r.validate(e);return n.success?n:{success:!1,error:new nr({value:e,cause:n.error})}}catch(n){return{success:!1,error:nr.isTypeValidationError(n)?n:new nr({value:e,cause:n})}}}function eb({text:e,schema:t}){try{let r=Na.default.parse(e);return t==null?r:Zv({value:r,schema:t})}catch(r){throw Sn.isJSONParseError(r)||nr.isTypeValidationError(r)?r:new Sn({text:e,cause:r})}}function Yl({text:e,schema:t}){try{let r=Na.default.parse(e);return t==null?{success:!0,value:r}:Wl({value:r,schema:t})}catch(r){return{success:!1,error:Sn.isJSONParseError(r)?r:new Sn({text:e,cause:r})}}}function tb(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var rb=()=>fetch,Ma=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i})=>nb({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i}),nb=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:o,abortSignal:s,fetch:i=rb()})=>{try{let a=await i(e,{method:"POST",headers:tb(t),body:r.content,signal:s}),c=Lo(a);if(!a.ok){let l;try{l=await o({response:a,url:e,requestBodyValues:r.values})}catch(f){throw Ra(f)||Fe.isAPICallError(f)?f:new Fe({message:"Failed to process error response",cause:f,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw l.value}try{return await n({response:a,url:e,requestBodyValues:r.values})}catch(l){throw l instanceof Error&&(Ra(l)||Fe.isAPICallError(l))?l:new Fe({message:"Failed to process successful response",cause:l,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(a){if(Ra(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){let c=a.cause;if(c!=null)throw new Fe({message:`Cannot connect to API: ${c.message}`,cause:c,url:e,requestBodyValues:r.values,isRetryable:!0})}throw a}},Ql=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:o,requestBodyValues:s})=>{let i=await n.text(),a=Lo(n);if(i.trim()==="")return{responseHeaders:a,value:new Fe({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})};try{let c=eb({text:i,schema:e});return{responseHeaders:a,value:new Fe({message:t(c),url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,data:c,isRetryable:r?.(n,c)})}}catch{return{responseHeaders:a,value:new Fe({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})}}},Xl=e=>async({response:t})=>{let r=Lo(t);if(t.body==null)throw new Bl({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new It).pipeThrough(new TransformStream({transform({data:n},o){n!=="[DONE]"&&o.enqueue(Yl({text:n,schema:e}))}}))}};var Zl=e=>async({response:t,url:r,requestBodyValues:n})=>{let o=await t.text(),s=Yl({text:o,schema:e}),i=Lo(t);if(!s.success)throw new Fe({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:o,url:r,requestBodyValues:n});return{responseHeaders:i,value:s.value}};function eu(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return globalThis.btoa(t)}function tu(e){return e?.replace(/\/$/,"")}var ob=u.object({type:u.literal("error"),error:u.object({type:u.string(),message:u.string()})}),ru=Ql({errorSchema:ob,errorToMessage:e=>e.error.message});function sb(e){var t;let r=ab(e),n,o=[];for(let s=0;s<r.length;s++){let i=r[s],a=i.type;switch(a){case"system":{if(n!=null)throw new kn({functionality:"Multiple system messages that are separated by user/assistant messages"});n=i.messages.map(({content:c})=>c).join(`
`);break}case"user":{let c=[];for(let{role:l,content:f}of i.messages)switch(l){case"user":{for(let p of f)switch(p.type){case"text":{c.push({type:"text",text:p.text});break}case"image":{if(p.image instanceof URL)throw new kn({functionality:"Image URLs in user messages"});c.push({type:"image",source:{type:"base64",media_type:(t=p.mimeType)!=null?t:"image/jpeg",data:eu(p.image)}});break}}break}case"tool":{for(let p of f)c.push({type:"tool_result",tool_use_id:p.toolCallId,content:JSON.stringify(p.result),is_error:p.isError});break}default:{let p=l;throw new Error(`Unsupported role: ${p}`)}}o.push({role:"user",content:c});break}case"assistant":{let c=[];for(let{content:l}of i.messages)for(let f=0;f<l.length;f++){let p=l[f];switch(p.type){case"text":{c.push({type:"text",text:s===r.length-1&&f===i.messages.length-1?p.text.trim():p.text});break}case"tool-call":{c.push({type:"tool_use",id:p.toolCallId,name:p.toolName,input:p.args});break}}}o.push({role:"assistant",content:c});break}default:{let c=a;throw new Error(`Unsupported type: ${c}`)}}}return{system:n,messages:o}}function ab(e){let t=[],r;for(let{role:n,content:o}of e)switch(n){case"system":{r?.type!=="system"&&(r={type:"system",messages:[]},t.push(r)),r.messages.push({role:n,content:o});break}case"assistant":{r?.type!=="assistant"&&(r={type:"assistant",messages:[]},t.push(r)),r.messages.push({role:n,content:o});break}case"user":{r?.type!=="user"&&(r={type:"user",messages:[]},t.push(r)),r.messages.push({role:n,content:o});break}case"tool":{r?.type!=="user"&&(r={type:"user",messages:[]},t.push(r)),r.messages.push({role:n,content:o});break}default:{let s=n;throw new Error(`Unsupported role: ${s}`)}}return t}function nu(e){switch(e){case"end_turn":case"stop_sequence":return"stop";case"tool_use":return"tool-calls";case"max_tokens":return"length";default:return"other"}}var ib=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f}){let p=e.type,d=[];i!=null&&d.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&d.push({type:"unsupported-setting",setting:"presencePenalty"}),f!=null&&d.push({type:"unsupported-setting",setting:"seed"}),l!=null&&l.type!=="text"&&d.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let m=sb(t),h={model:this.modelId,top_k:s??this.settings.topK,max_tokens:r??4096,temperature:n,top_p:o,stop_sequences:c,system:m.system,messages:m.messages};switch(p){case"regular":return{args:{...h,...ub(e)},warnings:d};case"object-json":throw new kn({functionality:"json-mode object generation"});case"object-tool":{let{name:y,description:g,parameters:v}=e.tool;return{args:{...h,tools:[{name:y,description:g,input_schema:v}],tool_choice:{type:"tool",name:y}},warnings:d}}default:{let y=p;throw new Error(`Unsupported type: ${y}`)}}}async doGenerate(e){let{args:t,warnings:r}=await this.getArgs(e),{responseHeaders:n,value:o}=await Ma({url:`${this.config.baseURL}/messages`,headers:Pa(this.config.headers(),e.headers),body:t,failedResponseHandler:ru,successfulResponseHandler:Zl(cb),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:s,...i}=t,a="";for(let l of o.content)l.type==="text"&&(a+=l.text);let c;if(o.content.some(l=>l.type==="tool_use")){c=[];for(let l of o.content)l.type==="tool_use"&&c.push({toolCallType:"function",toolCallId:l.id,toolName:l.name,args:JSON.stringify(l.input)})}return{text:a,toolCalls:c,finishReason:nu(o.stop_reason),usage:{promptTokens:o.usage.input_tokens,completionTokens:o.usage.output_tokens},rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:n},warnings:r}}async doStream(e){let{args:t,warnings:r}=await this.getArgs(e),{responseHeaders:n,value:o}=await Ma({url:`${this.config.baseURL}/messages`,headers:Pa(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:ru,successfulResponseHandler:Xl(lb),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:s,...i}=t,a="other",c={promptTokens:Number.NaN,completionTokens:Number.NaN},l={};return{stream:o.pipeThrough(new TransformStream({transform(f,p){if(!f.success){p.enqueue({type:"error",error:f.error});return}let d=f.value;switch(d.type){case"ping":return;case"content_block_start":{let m=d.content_block.type;switch(m){case"text":return;case"tool_use":{l[d.index]={toolCallId:d.content_block.id,toolName:d.content_block.name,jsonText:""};return}default:{let h=m;throw new Error(`Unsupported content block type: ${h}`)}}}case"content_block_stop":{if(l[d.index]!=null){let m=l[d.index];p.enqueue({type:"tool-call",toolCallType:"function",toolCallId:m.toolCallId,toolName:m.toolName,args:m.jsonText}),delete l[d.index]}return}case"content_block_delta":{let m=d.delta.type;switch(m){case"text_delta":{p.enqueue({type:"text-delta",textDelta:d.delta.text});return}case"input_json_delta":{let h=l[d.index];p.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:h.toolCallId,toolName:h.toolName,argsTextDelta:d.delta.partial_json}),h.jsonText+=d.delta.partial_json;return}default:{let h=m;throw new Error(`Unsupported delta type: ${h}`)}}}case"message_start":{c.promptTokens=d.message.usage.input_tokens,c.completionTokens=d.message.usage.output_tokens;return}case"message_delta":{c.completionTokens=d.usage.output_tokens,a=nu(d.delta.stop_reason);return}case"message_stop":{p.enqueue({type:"finish",finishReason:a,usage:c});return}case"error":{p.enqueue({type:"error",error:d.error});return}default:{let m=d;throw new Error(`Unsupported chunk type: ${m}`)}}}})),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:n},warnings:r}}},cb=u.object({type:u.literal("message"),content:u.array(u.discriminatedUnion("type",[u.object({type:u.literal("text"),text:u.string()}),u.object({type:u.literal("tool_use"),id:u.string(),name:u.string(),input:u.unknown()})])),stop_reason:u.string().optional().nullable(),usage:u.object({input_tokens:u.number(),output_tokens:u.number()})}),lb=u.discriminatedUnion("type",[u.object({type:u.literal("message_start"),message:u.object({usage:u.object({input_tokens:u.number(),output_tokens:u.number()})})}),u.object({type:u.literal("content_block_start"),index:u.number(),content_block:u.discriminatedUnion("type",[u.object({type:u.literal("text"),text:u.string()}),u.object({type:u.literal("tool_use"),id:u.string(),name:u.string()})])}),u.object({type:u.literal("content_block_delta"),index:u.number(),delta:u.discriminatedUnion("type",[u.object({type:u.literal("input_json_delta"),partial_json:u.string()}),u.object({type:u.literal("text_delta"),text:u.string()})])}),u.object({type:u.literal("content_block_stop"),index:u.number()}),u.object({type:u.literal("error"),error:u.object({type:u.string(),message:u.string()})}),u.object({type:u.literal("message_delta"),delta:u.object({stop_reason:u.string().optional().nullable()}),usage:u.object({output_tokens:u.number()})}),u.object({type:u.literal("message_stop")}),u.object({type:u.literal("ping")})]);function ub(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0;if(r==null)return{tools:void 0,tool_choice:void 0};let n=r.map(i=>({name:i.name,description:i.description,input_schema:i.parameters})),o=e.toolChoice;if(o==null)return{tools:n,tool_choice:void 0};let s=o.type;switch(s){case"auto":return{tools:n,tool_choice:{type:"auto"}};case"required":return{tools:n,tool_choice:{type:"any"}};case"none":return{tools:void 0,tool_choice:void 0};case"tool":return{tools:n,tool_choice:{type:"tool",name:o.toolName}};default:{let i=s;throw new Error(`Unsupported tool choice type: ${i}`)}}}function Da(e={}){var t,r;let n=(r=tu((t=e.baseURL)!=null?t:e.baseUrl))!=null?r:"https://api.anthropic.com/v1",o=()=>({"anthropic-version":"2023-06-01","x-api-key":zl({apiKey:e.apiKey,environmentVariableName:"ANTHROPIC_API_KEY",description:"Anthropic"}),...e.headers}),s=(a,c={})=>new ib(a,c,{provider:"anthropic.messages",baseURL:n,headers:o,fetch:e.fetch}),i=function(a,c){if(new.target)throw new Error("The Anthropic model function cannot be called with the new keyword.");return s(a,c)};return i.languageModel=s,i.chat=s,i.messages=s,i}var uT=Da();var Tn=class extends M{name="Anthropic";getApiKeyLink="https://console.anthropic.com/settings/keys";config={apiTokenKey:"ANTHROPIC_API_KEY"};staticModels=[{name:"claude-3-5-sonnet-20241022",label:"Claude 3.5 Sonnet",provider:"Anthropic",maxTokenAllowed:2e5,maxCompletionTokens:128e3},{name:"claude-3-haiku-20240307",label:"Claude 3 Haiku",provider:"Anthropic",maxTokenAllowed:2e5,maxCompletionTokens:128e3},{name:"claude-opus-4-20250514",label:"Claude 4 Opus",provider:"Anthropic",maxTokenAllowed:2e5,maxCompletionTokens:32e3}];async getDynamicModels(t,r,n){let{apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"ANTHROPIC_API_KEY"});if(!o)throw`Missing Api Key configuration for ${this.name} provider`;let i=await(await fetch("https://api.anthropic.com/v1/models",{headers:{"x-api-key":`${o}`,"anthropic-version":"2023-06-01"}})).json(),a=this.staticModels.map(l=>l.name);return i.data.filter(l=>l.type==="model"&&!a.includes(l.id)).map(l=>{let f=32e3;l.max_tokens?f=l.max_tokens:(l.id?.includes("claude-3-5-sonnet")||l.id?.includes("claude-3-haiku")||l.id?.includes("claude-3-opus")||l.id?.includes("claude-3-sonnet"))&&(f=2e5);let p=128e3;return l.id?.includes("claude-opus-4")?p=32e3:l.id?.includes("claude-sonnet-4")?p=64e3:l.id?.includes("claude-4")&&(p=32e3),{name:l.id,label:`${l.display_name} (${Math.floor(f/1e3)}k context)`,provider:this.name,maxTokenAllowed:f,maxCompletionTokens:p}})}getModelInstance=t=>{let{apiKeys:r,providerSettings:n,serverEnv:o,model:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:r,providerSettings:n,serverEnv:o,defaultBaseUrlKey:"",defaultApiTokenKey:"ANTHROPIC_API_KEY"});return Da({apiKey:i,headers:{"anthropic-beta":"output-128k-2025-02-19"}})(s)}};var ou="vercel.ai.error",db=Symbol.for(ou),su,pb=class au extends Error{constructor({name:t,message:r,cause:n}){super(r),this[su]=!0,this.name=t,this.cause=n}static isInstance(t){return au.hasMarker(t,ou)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};su=db;var fe=pb,iu="AI_APICallError",cu=`vercel.ai.error.${iu}`,fb=Symbol.for(cu),lu,He=class extends fe{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:o,responseBody:s,cause:i,isRetryable:a=n!=null&&(n===408||n===409||n===429||n>=500),data:c}){super({name:iu,message:e,cause:i}),this[lu]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=o,this.responseBody=s,this.isRetryable=a,this.data=c}static isInstance(e){return fe.hasMarker(e,cu)}};lu=fb;var uu="AI_EmptyResponseBodyError",du=`vercel.ai.error.${uu}`,mb=Symbol.for(du),pu,fu=class extends fe{constructor({message:e="Empty response body"}={}){super({name:uu,message:e}),this[pu]=!0}static isInstance(e){return fe.hasMarker(e,du)}};pu=mb;function mu(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var hu="AI_InvalidArgumentError",gu=`vercel.ai.error.${hu}`,hb=Symbol.for(gu),yu,vu=class extends fe{constructor({message:e,cause:t,argument:r}){super({name:hu,message:e,cause:t}),this[yu]=!0,this.argument=r}static isInstance(e){return fe.hasMarker(e,gu)}};yu=hb;var gb="AI_InvalidPromptError",yb=`vercel.ai.error.${gb}`,vb=Symbol.for(yb),bb;bb=vb;var xb="AI_InvalidResponseDataError",wb=`vercel.ai.error.${xb}`,_b=Symbol.for(wb),Eb;Eb=_b;var bu="AI_JSONParseError",xu=`vercel.ai.error.${bu}`,Sb=Symbol.for(xu),wu,In=class extends fe{constructor({text:e,cause:t}){super({name:bu,message:`JSON parsing failed: Text: ${e}.
Error message: ${mu(t)}`,cause:t}),this[wu]=!0,this.text=e}static isInstance(e){return fe.hasMarker(e,xu)}};wu=Sb;var _u="AI_LoadAPIKeyError",Eu=`vercel.ai.error.${_u}`,Ab=Symbol.for(Eu),Su,Cn=class extends fe{constructor({message:e}){super({name:_u,message:e}),this[Su]=!0}static isInstance(e){return fe.hasMarker(e,Eu)}};Su=Ab;var kb="AI_LoadSettingError",Tb=`vercel.ai.error.${kb}`,Ib=Symbol.for(Tb),Cb;Cb=Ib;var Rb="AI_NoContentGeneratedError",Ob=`vercel.ai.error.${Rb}`,Pb=Symbol.for(Ob),Nb;Nb=Pb;var Mb="AI_NoSuchModelError",Db=`vercel.ai.error.${Mb}`,Bb=Symbol.for(Db),$b;$b=Bb;var Au="AI_TooManyEmbeddingValuesForCallError",ku=`vercel.ai.error.${Au}`,Ub=Symbol.for(ku),Tu,Iu=class extends fe{constructor(e){super({name:Au,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Tu]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return fe.hasMarker(e,ku)}};Tu=Ub;var Cu="AI_TypeValidationError",Ru=`vercel.ai.error.${Cu}`,Lb=Symbol.for(Ru),Ou,Fb=class Ba extends fe{constructor({value:t,cause:r}){super({name:Cu,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${mu(r)}`,cause:r}),this[Ou]=!0,this.value=t}static isInstance(t){return fe.hasMarker(t,Ru)}static wrap({value:t,cause:r}){return Ba.isInstance(r)&&r.value===t?r:new Ba({value:t,cause:r})}};Ou=Lb;var Rr=Fb,Pu="AI_UnsupportedFunctionalityError",Nu=`vercel.ai.error.${Pu}`,Hb=Symbol.for(Nu),Mu,mt=class extends fe{constructor({functionality:e}){super({name:Pu,message:`'${e}' functionality not supported.`}),this[Mu]=!0,this.functionality=e}static isInstance(e){return fe.hasMarker(e,Nu)}};Mu=Hb;var La=ct(Ht(),1);function Rn(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function Fo(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r}),t}var jb=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{let o=hr(r,t);if(e==null)return o;if(r.includes(n))throw new vu({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return s=>`${e}${n}${o(s)}`},kT=jb();function $a(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function Du({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new Cn({message:`${n} API key must be a string.`});if(typeof process>"u")throw new Cn({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new Cn({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Cn({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var Ua=Symbol.for("vercel.ai.validator");function Kb(e){return{[Ua]:!0,validate:e}}function Gb(e){return typeof e=="object"&&e!==null&&Ua in e&&e[Ua]===!0&&"validate"in e}function Vb(e){return Gb(e)?e:qb(e)}function qb(e){return Kb(t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Jb({value:e,schema:t}){let r=Bu({value:e,schema:t});if(!r.success)throw Rr.wrap({value:e,cause:r.error});return r.value}function Bu({value:e,schema:t}){let r=Vb(t);try{if(r.validate==null)return{success:!0,value:e};let n=r.validate(e);return n.success?n:{success:!1,error:Rr.wrap({value:e,cause:n.error})}}catch(n){return{success:!1,error:Rr.wrap({value:e,cause:n})}}}function zb({text:e,schema:t}){try{let r=La.default.parse(e);return t==null?r:Jb({value:r,schema:t})}catch(r){throw In.isInstance(r)||Rr.isInstance(r)?r:new In({text:e,cause:r})}}function $u({text:e,schema:t}){try{let r=La.default.parse(e);return t==null?{success:!0,value:r}:Bu({value:r,schema:t})}catch(r){return{success:!1,error:In.isInstance(r)?r:new In({text:e,cause:r})}}}function Wb(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var Yb=()=>globalThis.fetch,On=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i})=>Qb({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i}),Qb=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:o,abortSignal:s,fetch:i=Yb()})=>{try{let a=await i(e,{method:"POST",headers:Wb(t),body:r.content,signal:s}),c=Fo(a);if(!a.ok){let l;try{l=await o({response:a,url:e,requestBodyValues:r.values})}catch(f){throw $a(f)||He.isInstance(f)?f:new He({message:"Failed to process error response",cause:f,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw l.value}try{return await n({response:a,url:e,requestBodyValues:r.values})}catch(l){throw l instanceof Error&&($a(l)||He.isInstance(l))?l:new He({message:"Failed to process successful response",cause:l,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(a){if($a(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){let c=a.cause;if(c!=null)throw new He({message:`Cannot connect to API: ${c.message}`,cause:c,url:e,requestBodyValues:r.values,isRetryable:!0})}throw a}},Uu=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:o,requestBodyValues:s})=>{let i=await n.text(),a=Fo(n);if(i.trim()==="")return{responseHeaders:a,value:new He({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})};try{let c=zb({text:i,schema:e});return{responseHeaders:a,value:new He({message:t(c),url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,data:c,isRetryable:r?.(n,c)})}}catch{return{responseHeaders:a,value:new He({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})}}},Lu=e=>async({response:t})=>{let r=Fo(t);if(t.body==null)throw new fu({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new yr).pipeThrough(new TransformStream({transform({data:n},o){n!=="[DONE]"&&o.enqueue($u({text:n,schema:e}))}}))}};var Ho=e=>async({response:t,url:r,requestBodyValues:n})=>{let o=await t.text(),s=$u({text:o,schema:e}),i=Fo(t);if(!s.success)throw new He({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:o,url:r,requestBodyValues:n});return{responseHeaders:i,value:s.value}},{btoa:NT,atob:MT}=globalThis;function Fu(e){return e?.replace(/\/$/,"")}var Xb=u.object({message:u.string()}),Fa=Uu({errorSchema:Xb,errorToMessage:e=>e.message});function Zb(e){let t=[];for(let{role:r,content:n}of e)switch(r){case"system":{t.push({role:"system",content:n});break}case"user":{t.push({role:"user",content:n.map(o=>{switch(o.type){case"text":return o.text;case"image":throw new mt({functionality:"image-part"})}}).join("")});break}case"assistant":{let o="",s=[];for(let i of n)switch(i.type){case"text":{o+=i.text;break}case"tool-call":{s.push({id:i.toolCallId,type:"function",function:{name:i.toolName,arguments:JSON.stringify(i.args)}});break}default:{let a=i;throw new Error(`Unsupported part: ${a}`)}}t.push({role:"assistant",content:o!==""?o:"call tool",tool_calls:s.length>0?s:void 0,tool_plan:void 0});break}case"tool":{t.push(...n.map(o=>({role:"tool",content:JSON.stringify(o.result),tool_call_id:o.toolCallId})));break}default:{let o=r;throw new Error(`Unsupported role: ${o}`)}}return t}function Hu(e){switch(e){case"COMPLETE":case"STOP_SEQUENCE":return"stop";case"MAX_TOKENS":return"length";case"ERROR":case"ERROR_LIMIT":return"error";case"ERROR_TOXIC":return"content-filter";case"USER_CANCEL":return"other";default:return"unknown"}}function ex(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0,n=[];if(r==null)return{tools:void 0,tool_choice:void 0,toolWarnings:n};let o=[];for(let a of r)a.type==="provider-defined"?n.push({type:"unsupported-tool",tool:a}):o.push({type:"function",function:{name:a.name,description:a.description,parameters:a.parameters}});let s=e.toolChoice;if(s==null)return{tools:o,tool_choice:void 0,toolWarnings:n};let i=s.type;switch(i){case"auto":return{tools:o,tool_choice:i,toolWarnings:n};case"none":return{tools:void 0,tool_choice:"any",toolWarnings:n};case"required":case"tool":throw new mt({functionality:`Unsupported tool choice type: ${i}`});default:{let a=i;throw new mt({functionality:`Unsupported tool choice type: ${a}`})}}}var tx=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f}){let p=e.type,d=Zb(t),m={model:this.modelId,frequency_penalty:i,presence_penalty:a,max_tokens:r,temperature:n,p:o,k:s,seed:f,stop_sequences:c,response_format:l?.type==="json"?{type:"json_object",schema:l.schema}:void 0,messages:d};switch(p){case"regular":{let{tools:h,tool_choice:y,toolWarnings:g}=ex(e);return{...m,tools:h,warnings:g}}case"object-json":throw new mt({functionality:"object-json mode"});case"object-tool":throw new mt({functionality:"object-tool mode"});default:{let h=p;throw new mt({functionality:`Unsupported mode: ${h}`})}}}concatenateMessageText(e){return e.filter(t=>"content"in t).map(t=>t.content).join("")}removeJsonSchemaExtras(e){return e.map(t=>{if(t.type==="function"&&t.function.parameters&&typeof t.function.parameters=="object"){let{additionalProperties:r,$schema:n,...o}=t.function.parameters;return{...t,function:{...t.function,parameters:o}}}return t})}async doGenerate(e){var t,r,n,o,s;let{warnings:i,...a}=this.getArgs(e);a.tools=a.tools&&this.removeJsonSchemaExtras(a.tools);let{responseHeaders:c,value:l}=await On({url:`${this.config.baseURL}/chat`,headers:Rn(this.config.headers(),e.headers),body:a,failedResponseHandler:Fa,successfulResponseHandler:Ho(rx),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:f,...p}=a,d=(n=(r=(t=l.message.content)==null?void 0:t[0])==null?void 0:r.text)!=null?n:"";return d||(d=(o=l.message.tool_plan)!=null?o:""),{text:d,toolCalls:l.message.tool_calls?l.message.tool_calls.map(m=>({toolCallId:m.id,toolName:m.function.name,args:m.function.arguments,toolCallType:"function"})):[],finishReason:Hu(l.finish_reason),usage:{promptTokens:l.usage.tokens.input_tokens,completionTokens:l.usage.tokens.output_tokens},rawCall:{rawPrompt:{messages:f},rawSettings:p},response:{id:(s=l.generation_id)!=null?s:void 0},rawResponse:{headers:c},warnings:i,request:{body:JSON.stringify(a)}}}async doStream(e){let{warnings:t,...r}=this.getArgs(e);r.tools=r.tools&&this.removeJsonSchemaExtras(r.tools);let n={...r,stream:!0},{responseHeaders:o,value:s}=await On({url:`${this.config.baseURL}/chat`,headers:Rn(this.config.headers(),e.headers),body:n,failedResponseHandler:Fa,successfulResponseHandler:Lu(nx),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:i,...a}=r,c="unknown",l={promptTokens:Number.NaN,completionTokens:Number.NaN},f={toolCallId:"",toolName:"",argsTextDelta:""};return{stream:s.pipeThrough(new TransformStream({transform(p,d){var m;if(!p.success){c="error",d.enqueue({type:"error",error:p.error});return}let h=p.value;switch(h.type){case"content-delta":{d.enqueue({type:"text-delta",textDelta:h.delta.message.content.text});return}case"tool-plan-delta":{d.enqueue({type:"text-delta",textDelta:h.delta.message.tool_plan});return}case"tool-call-start":{f={toolCallId:h.delta.message.tool_calls.id,toolName:h.delta.message.tool_calls.function.name,argsTextDelta:h.delta.message.tool_calls.function.arguments},d.enqueue({type:"tool-call-delta",toolCallId:f.toolCallId,toolName:f.toolName,toolCallType:"function",argsTextDelta:f.argsTextDelta});return}case"tool-call-delta":{f.argsTextDelta+=h.delta.message.tool_calls.function.arguments,d.enqueue({type:"tool-call-delta",toolCallId:f.toolCallId,toolName:f.toolName,toolCallType:"function",argsTextDelta:h.delta.message.tool_calls.function.arguments});return}case"tool-call-end":{d.enqueue({type:"tool-call",toolCallId:f.toolCallId,toolName:f.toolName,toolCallType:"function",args:JSON.stringify(JSON.parse(f.argsTextDelta))}),f={toolCallId:"",toolName:"",argsTextDelta:""};return}case"message-start":{d.enqueue({type:"response-metadata",id:(m=h.id)!=null?m:void 0});return}case"message-end":{c=Hu(h.delta.finish_reason);let g=h.delta.usage.tokens;l={promptTokens:g.input_tokens,completionTokens:g.output_tokens}}default:return}},flush(p){p.enqueue({type:"finish",finishReason:c,usage:l})}})),rawCall:{rawPrompt:{messages:i},rawSettings:a},rawResponse:{headers:o},warnings:t,request:{body:JSON.stringify(n)}}}},rx=u.object({generation_id:u.string().nullish(),message:u.object({role:u.string(),content:u.array(u.object({type:u.string(),text:u.string()})).nullish(),tool_plan:u.string().nullish(),tool_calls:u.array(u.object({id:u.string(),type:u.literal("function"),function:u.object({name:u.string(),arguments:u.string()})})).nullish()}),finish_reason:u.string(),usage:u.object({billed_units:u.object({input_tokens:u.number(),output_tokens:u.number()}),tokens:u.object({input_tokens:u.number(),output_tokens:u.number()})})}),nx=u.discriminatedUnion("type",[u.object({type:u.literal("citation-start")}),u.object({type:u.literal("citation-end")}),u.object({type:u.literal("content-start")}),u.object({type:u.literal("content-delta"),delta:u.object({message:u.object({content:u.object({text:u.string()})})})}),u.object({type:u.literal("content-end")}),u.object({type:u.literal("message-start"),id:u.string().nullish()}),u.object({type:u.literal("message-end"),delta:u.object({finish_reason:u.string(),usage:u.object({tokens:u.object({input_tokens:u.number(),output_tokens:u.number()})})})}),u.object({type:u.literal("tool-plan-delta"),delta:u.object({message:u.object({tool_plan:u.string()})})}),u.object({type:u.literal("tool-call-start"),delta:u.object({message:u.object({tool_calls:u.object({id:u.string(),type:u.literal("function"),function:u.object({name:u.string(),arguments:u.string()})})})})}),u.object({type:u.literal("tool-call-delta"),delta:u.object({message:u.object({tool_calls:u.object({function:u.object({arguments:u.string()})})})})}),u.object({type:u.literal("tool-call-end")})]),ox=class{constructor(e,t,r){this.specificationVersion="v1",this.maxEmbeddingsPerCall=96,this.supportsParallelCalls=!0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r}){var n;if(e.length>this.maxEmbeddingsPerCall)throw new Iu({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:o,value:s}=await On({url:`${this.config.baseURL}/embed`,headers:Rn(this.config.headers(),t),body:{model:this.modelId,embedding_types:["float"],texts:e,input_type:(n=this.settings.inputType)!=null?n:"search_query",truncate:this.settings.truncate},failedResponseHandler:Fa,successfulResponseHandler:Ho(sx),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.embeddings.float,usage:{tokens:s.meta.billed_units.input_tokens},rawResponse:{headers:o}}}},sx=u.object({embeddings:u.object({float:u.array(u.array(u.number()))}),meta:u.object({billed_units:u.object({input_tokens:u.number()})})});function Ha(e={}){var t;let r=(t=Fu(e.baseURL))!=null?t:"https://api.cohere.com/v2",n=()=>({Authorization:`Bearer ${Du({apiKey:e.apiKey,environmentVariableName:"COHERE_API_KEY",description:"Cohere"})}`,...e.headers}),o=(a,c={})=>new tx(a,c,{provider:"cohere.chat",baseURL:r,headers:n,fetch:e.fetch}),s=(a,c={})=>new ox(a,c,{provider:"cohere.textEmbedding",baseURL:r,headers:n,fetch:e.fetch}),i=function(a,c){if(new.target)throw new Error("The Cohere model function cannot be called with the new keyword.");return o(a,c)};return i.languageModel=o,i.embedding=s,i.textEmbeddingModel=s,i}var JT=Ha();var Pn=class extends M{name="Cohere";getApiKeyLink="https://dashboard.cohere.com/api-keys";config={apiTokenKey:"COHERE_API_KEY"};staticModels=[{name:"command-r-plus-08-2024",label:"Command R plus Latest",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-r-08-2024",label:"Command R Latest",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-r-plus",label:"Command R plus",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-r",label:"Command R",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command",label:"Command",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-nightly",label:"Command Nightly",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-light",label:"Command Light",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"command-light-nightly",label:"Command Light Nightly",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"c4ai-aya-expanse-8b",label:"c4AI Aya Expanse 8b",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3},{name:"c4ai-aya-expanse-32b",label:"c4AI Aya Expanse 32b",provider:"Cohere",maxTokenAllowed:4096,maxCompletionTokens:4e3}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"COHERE_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return Ha({apiKey:i})(r)}};function Nn(e){var t,r;return(r=(t=e?.providerMetadata)==null?void 0:t.openaiCompatible)!=null?r:{}}function ax(e){let t=[];for(let{role:r,content:n,...o}of e){let s=Nn({...o});switch(r){case"system":{t.push({role:"system",content:n,...s});break}case"user":{if(n.length===1&&n[0].type==="text"){t.push({role:"user",content:n[0].text,...Nn(n[0])});break}t.push({role:"user",content:n.map(i=>{var a;let c=Nn(i);switch(i.type){case"text":return{type:"text",text:i.text,...c};case"image":return{type:"image_url",image_url:{url:i.image instanceof URL?i.image.toString():`data:${(a=i.mimeType)!=null?a:"image/jpeg"};base64,${Oo(i.image)}`},...c};case"file":throw new Y({functionality:"File content parts in user messages"})}}),...s});break}case"assistant":{let i="",a=[];for(let c of n){let l=Nn(c);switch(c.type){case"text":{i+=c.text;break}case"tool-call":{a.push({id:c.toolCallId,type:"function",function:{name:c.toolName,arguments:JSON.stringify(c.args)},...l});break}default:{let f=c;throw new Error(`Unsupported part: ${f}`)}}}t.push({role:"assistant",content:i,tool_calls:a.length>0?a:void 0,...s});break}case"tool":{for(let i of n){let a=Nn(i);t.push({role:"tool",tool_call_id:i.toolCallId,content:JSON.stringify(i.result),...a})}break}default:{let i=r;throw new Error(`Unsupported role: ${i}`)}}}return t}function ju({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function Ku(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var ix=u.object({error:u.object({message:u.string(),type:u.string().nullish(),param:u.any().nullish(),code:u.union([u.string(),u.number()]).nullish()})}),cx={errorSchema:ix,errorToMessage:e=>e.error.message};function lx({mode:e,structuredOutputs:t}){var r;let n=(r=e.tools)!=null&&r.length?e.tools:void 0,o=[];if(n==null)return{tools:void 0,tool_choice:void 0,toolWarnings:o};let s=e.toolChoice,i=[];for(let c of n)c.type==="provider-defined"?o.push({type:"unsupported-tool",tool:c}):i.push({type:"function",function:{name:c.name,description:c.description,parameters:c.parameters}});if(s==null)return{tools:i,tool_choice:void 0,toolWarnings:o};let a=s.type;switch(a){case"auto":case"none":case"required":return{tools:i,tool_choice:a,toolWarnings:o};case"tool":return{tools:i,tool_choice:{type:"function",function:{name:s.toolName}},toolWarnings:o};default:{let c=a;throw new Y({functionality:`Unsupported tool choice type: ${c}`})}}}var Gu=class{constructor(e,t,r){this.specificationVersion="v1";var n,o;this.modelId=e,this.settings=t,this.config=r;let s=(n=r.errorStructure)!=null?n:cx;this.chunkSchema=dx(s.errorSchema),this.failedResponseHandler=Ro(s),this.supportsStructuredOutputs=(o=r.supportsStructuredOutputs)!=null?o:!1}get defaultObjectGenerationMode(){return this.config.defaultObjectGenerationMode}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f}){var p,d;let m=e.type,h=[];s!=null&&h.push({type:"unsupported-setting",setting:"topK"}),l?.type==="json"&&l.schema!=null&&!this.supportsStructuredOutputs&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let y={model:this.modelId,user:this.settings.user,max_tokens:r,temperature:n,top_p:o,frequency_penalty:i,presence_penalty:a,response_format:l?.type==="json"?this.supportsStructuredOutputs===!0&&l.schema!=null?{type:"json_schema",json_schema:{schema:l.schema,name:(p=l.name)!=null?p:"response",description:l.description}}:{type:"json_object"}:void 0,stop:c,seed:f,messages:ax(t)};switch(m){case"regular":{let{tools:g,tool_choice:v,toolWarnings:b}=lx({mode:e,structuredOutputs:this.supportsStructuredOutputs});return{args:{...y,tools:g,tool_choice:v},warnings:[...h,...b]}}case"object-json":return{args:{...y,response_format:this.supportsStructuredOutputs===!0&&e.schema!=null?{type:"json_schema",json_schema:{schema:e.schema,name:(d=e.name)!=null?d:"response",description:e.description}}:{type:"json_object"}},warnings:h};case"object-tool":return{args:{...y,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]},warnings:h};default:{let g=m;throw new Error(`Unsupported type: ${g}`)}}}async doGenerate(e){var t,r,n,o,s,i,a,c,l;let{args:f,warnings:p}=this.getArgs({...e}),d=JSON.stringify(f),{responseHeaders:m,value:h,rawValue:y}=await Ae({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Se(this.config.headers(),e.headers),body:f,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:Qe(ux),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:g,...v}=f,b=h.choices[0],w=(r=(t=this.config.metadataExtractor)==null?void 0:t.extractMetadata)==null?void 0:r.call(t,{parsedBody:y});return{text:(n=b.message.content)!=null?n:void 0,reasoning:(o=b.message.reasoning_content)!=null?o:void 0,toolCalls:(s=b.message.tool_calls)==null?void 0:s.map(S=>{var T;return{toolCallType:"function",toolCallId:(T=S.id)!=null?T:Ye(),toolName:S.function.name,args:S.function.arguments}}),finishReason:Ku(b.finish_reason),usage:{promptTokens:(a=(i=h.usage)==null?void 0:i.prompt_tokens)!=null?a:NaN,completionTokens:(l=(c=h.usage)==null?void 0:c.completion_tokens)!=null?l:NaN},...w&&{providerMetadata:w},rawCall:{rawPrompt:g,rawSettings:v},rawResponse:{headers:m},response:ju(h),warnings:p,request:{body:d}}}async doStream(e){var t;if(this.settings.simulateStreaming){let h=await this.doGenerate(e);return{stream:new ReadableStream({start(g){if(g.enqueue({type:"response-metadata",...h.response}),h.reasoning&&g.enqueue({type:"reasoning",textDelta:h.reasoning}),h.text&&g.enqueue({type:"text-delta",textDelta:h.text}),h.toolCalls)for(let v of h.toolCalls)g.enqueue({type:"tool-call",...v});g.enqueue({type:"finish",finishReason:h.finishReason,usage:h.usage,logprobs:h.logprobs,providerMetadata:h.providerMetadata}),g.close()}}),rawCall:h.rawCall,rawResponse:h.rawResponse,warnings:h.warnings}}let{args:r,warnings:n}=this.getArgs({...e}),o=JSON.stringify({...r,stream:!0}),s=(t=this.config.metadataExtractor)==null?void 0:t.createStreamExtractor(),{responseHeaders:i,value:a}=await Ae({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Se(this.config.headers(),e.headers),body:{...r,stream:!0},failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:br(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:c,...l}=r,f=[],p="unknown",d={promptTokens:void 0,completionTokens:void 0},m=!0;return{stream:a.pipeThrough(new TransformStream({transform(h,y){var g,v,b,w,S,T,U,I,G,F,q,J,ee,te;if(!h.success){p="error",y.enqueue({type:"error",error:h.error});return}let re=h.value;if(s?.processChunk(h.rawValue),"error"in re){p="error",y.enqueue({type:"error",error:re.error.message});return}m&&(m=!1,y.enqueue({type:"response-metadata",...ju(re)})),re.usage!=null&&(d={promptTokens:(g=re.usage.prompt_tokens)!=null?g:void 0,completionTokens:(v=re.usage.completion_tokens)!=null?v:void 0});let j=re.choices[0];if(j?.finish_reason!=null&&(p=Ku(j.finish_reason)),j?.delta==null)return;let W=j.delta;if(W.reasoning_content!=null&&y.enqueue({type:"reasoning",textDelta:W.reasoning_content}),W.content!=null&&y.enqueue({type:"text-delta",textDelta:W.content}),W.tool_calls!=null)for(let ie of W.tool_calls){let Ft=ie.index;if(f[Ft]==null){if(ie.type!=="function")throw new Et({data:ie,message:"Expected 'function' type."});if(ie.id==null)throw new Et({data:ie,message:"Expected 'id' to be a string."});if(((b=ie.function)==null?void 0:b.name)==null)throw new Et({data:ie,message:"Expected 'function.name' to be a string."});f[Ft]={id:ie.id,type:"function",function:{name:ie.function.name,arguments:(w=ie.function.arguments)!=null?w:""},hasFinished:!1};let ne=f[Ft];((S=ne.function)==null?void 0:S.name)!=null&&((T=ne.function)==null?void 0:T.arguments)!=null&&(ne.function.arguments.length>0&&y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:ne.id,toolName:ne.function.name,argsTextDelta:ne.function.arguments}),vr(ne.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(U=ne.id)!=null?U:Ye(),toolName:ne.function.name,args:ne.function.arguments}),ne.hasFinished=!0));continue}let H=f[Ft];H.hasFinished||(((I=ie.function)==null?void 0:I.arguments)!=null&&(H.function.arguments+=(F=(G=ie.function)==null?void 0:G.arguments)!=null?F:""),y.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:H.id,toolName:H.function.name,argsTextDelta:(q=ie.function.arguments)!=null?q:""}),((J=H.function)==null?void 0:J.name)!=null&&((ee=H.function)==null?void 0:ee.arguments)!=null&&vr(H.function.arguments)&&(y.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(te=H.id)!=null?te:Ye(),toolName:H.function.name,args:H.function.arguments}),H.hasFinished=!0))}},flush(h){var y,g;let v=s?.buildMetadata();h.enqueue({type:"finish",finishReason:p,usage:{promptTokens:(y=d.promptTokens)!=null?y:NaN,completionTokens:(g=d.completionTokens)!=null?g:NaN},...v&&{providerMetadata:v}})}})),rawCall:{rawPrompt:c,rawSettings:l},rawResponse:{headers:i},warnings:n,request:{body:o}}}},ux=u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({message:u.object({role:u.literal("assistant").nullish(),content:u.string().nullish(),reasoning_content:u.string().nullish(),tool_calls:u.array(u.object({id:u.string().nullish(),type:u.literal("function"),function:u.object({name:u.string(),arguments:u.string()})})).nullish()}),finish_reason:u.string().nullish()})),usage:u.object({prompt_tokens:u.number().nullish(),completion_tokens:u.number().nullish()}).nullish()}),dx=e=>u.union([u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({delta:u.object({role:u.enum(["assistant"]).nullish(),content:u.string().nullish(),reasoning_content:u.string().nullish(),tool_calls:u.array(u.object({index:u.number(),id:u.string().nullish(),type:u.literal("function").optional(),function:u.object({name:u.string().nullish(),arguments:u.string().nullish()})})).nullish()}).nullish(),finish_reason:u.string().nullish()})),usage:u.object({prompt_tokens:u.number().nullish(),completion_tokens:u.number().nullish()}).nullish()}),e]);var cI=u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({text:u.string(),finish_reason:u.string()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()}).nullish()});var uI=u.object({data:u.array(u.object({embedding:u.array(u.number())})),usage:u.object({prompt_tokens:u.number()}).nullish()});var Vu=e=>{var t,r;return e==null?void 0:{deepseek:{promptCacheHitTokens:(t=e.prompt_cache_hit_tokens)!=null?t:NaN,promptCacheMissTokens:(r=e.prompt_cache_miss_tokens)!=null?r:NaN}}},px={extractMetadata:({parsedBody:e})=>{let t=wn({value:e,schema:fx});return!t.success||t.value.usage==null?void 0:Vu(t.value.usage)},createStreamExtractor:()=>{let e;return{processChunk:t=>{var r,n;let o=wn({value:t,schema:mx});o.success&&((n=(r=o.value.choices)==null?void 0:r[0])==null?void 0:n.finish_reason)==="stop"&&o.value.usage&&(e=o.value.usage)},buildMetadata:()=>Vu(e)}}},qu=u.object({prompt_cache_hit_tokens:u.number().nullish(),prompt_cache_miss_tokens:u.number().nullish()}),fx=u.object({usage:qu.nullish()}),mx=u.object({choices:u.array(u.object({finish_reason:u.string().nullish()})).nullish(),usage:qu.nullish()});function ja(e={}){var t;let r=Po((t=e.baseURL)!=null?t:"https://api.deepseek.com/v1"),n=()=>({Authorization:`Bearer ${Io({apiKey:e.apiKey,environmentVariableName:"DEEPSEEK_API_KEY",description:"DeepSeek API key"})}`,...e.headers}),o=(i,a={})=>new Gu(i,a,{provider:"deepseek.chat",url:({path:c})=>`${r}${c}`,headers:n,fetch:e.fetch,defaultObjectGenerationMode:"json",metadataExtractor:px}),s=(i,a)=>o(i,a);return s.languageModel=o,s.chat=o,s.textEmbeddingModel=i=>{throw new Yc({modelId:i,modelType:"textEmbeddingModel"})},s}var vI=ja();var Mn=class extends M{name="Deepseek";getApiKeyLink="https://platform.deepseek.com/apiKeys";config={apiTokenKey:"DEEPSEEK_API_KEY"};staticModels=[{name:"deepseek-coder",label:"Deepseek-Coder",provider:"Deepseek",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"deepseek-chat",label:"Deepseek-Chat",provider:"Deepseek",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"deepseek-reasoner",label:"Deepseek-Reasoner",provider:"Deepseek",maxTokenAllowed:8e3,maxCompletionTokens:8192}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"DEEPSEEK_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return ja({apiKey:i})(r,{})}};var Ju="vercel.ai.error",hx=Symbol.for(Ju),zu,gx=class Wu extends Error{constructor({name:t,message:r,cause:n}){super(r),this[zu]=!0,this.name=t,this.cause=n}static isInstance(t){return Wu.hasMarker(t,Ju)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}toJSON(){return{name:this.name,message:this.message}}};zu=hx;var xe=gx,Ka="AI_APICallError",Yu=`vercel.ai.error.${Ka}`,yx=Symbol.for(Yu),Qu,je=class extends xe{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:o,responseBody:s,cause:i,isRetryable:a=n!=null&&(n===408||n===409||n===429||n>=500),data:c}){super({name:Ka,message:e,cause:i}),this[Qu]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=o,this.responseBody=s,this.isRetryable=a,this.data=c}static isInstance(e){return xe.hasMarker(e,Yu)}static isAPICallError(e){return e instanceof Error&&e.name===Ka&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};Qu=yx;var Ga="AI_EmptyResponseBodyError",Xu=`vercel.ai.error.${Ga}`,vx=Symbol.for(Xu),Zu,jo=class extends xe{constructor({message:e="Empty response body"}={}){super({name:Ga,message:e}),this[Zu]=!0}static isInstance(e){return xe.hasMarker(e,Xu)}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name===Ga}};Zu=vx;function ed(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var bx="AI_InvalidPromptError",xx=`vercel.ai.error.${bx}`,wx=Symbol.for(xx),_x;_x=wx;var Ex="AI_InvalidResponseDataError",Sx=`vercel.ai.error.${Ex}`,Ax=Symbol.for(Sx),kx;kx=Ax;var Va="AI_JSONParseError",td=`vercel.ai.error.${Va}`,Tx=Symbol.for(td),rd,Dn=class extends xe{constructor({text:e,cause:t}){super({name:Va,message:`JSON parsing failed: Text: ${e}.
Error message: ${ed(t)}`,cause:t}),this[rd]=!0,this.text=e}static isInstance(e){return xe.hasMarker(e,td)}static isJSONParseError(e){return e instanceof Error&&e.name===Va&&"text"in e&&typeof e.text=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}};rd=Tx;var qa="AI_LoadAPIKeyError",nd=`vercel.ai.error.${qa}`,Ix=Symbol.for(nd),od,Bn=class extends xe{constructor({message:e}){super({name:qa,message:e}),this[od]=!0}static isInstance(e){return xe.hasMarker(e,nd)}static isLoadAPIKeyError(e){return e instanceof Error&&e.name===qa}};od=Ix;var Cx="AI_LoadSettingError",Rx=`vercel.ai.error.${Cx}`,Ox=Symbol.for(Rx),Px;Px=Ox;var Nx="AI_NoContentGeneratedError",Mx=`vercel.ai.error.${Nx}`,Dx=Symbol.for(Mx),Bx;Bx=Dx;var $x="AI_NoSuchModelError",Ux=`vercel.ai.error.${$x}`,Lx=Symbol.for(Ux),Fx;Fx=Lx;var Ja="AI_TooManyEmbeddingValuesForCallError",sd=`vercel.ai.error.${Ja}`,Hx=Symbol.for(sd),ad,Or=class extends xe{constructor(e){super({name:Ja,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[ad]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return xe.hasMarker(e,sd)}static isTooManyEmbeddingValuesForCallError(e){return e instanceof Error&&e.name===Ja&&"provider"in e&&typeof e.provider=="string"&&"modelId"in e&&typeof e.modelId=="string"&&"maxEmbeddingsPerCall"in e&&typeof e.maxEmbeddingsPerCall=="number"&&"values"in e&&Array.isArray(e.values)}toJSON(){return{name:this.name,message:this.message,stack:this.stack,provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:this.values}}};ad=Hx;var za="AI_TypeValidationError",id=`vercel.ai.error.${za}`,jx=Symbol.for(id),cd,Kx=class Wa extends xe{constructor({value:t,cause:r}){super({name:za,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${ed(r)}`,cause:r}),this[cd]=!0,this.value=t}static isInstance(t){return xe.hasMarker(t,id)}static wrap({value:t,cause:r}){return Wa.isInstance(r)&&r.value===t?r:new Wa({value:t,cause:r})}static isTypeValidationError(t){return t instanceof Error&&t.name===za}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}};cd=jx;var Pr=Kx,Ya="AI_UnsupportedFunctionalityError",ld=`vercel.ai.error.${Ya}`,Gx=Symbol.for(ld),ud,Ct=class extends xe{constructor({functionality:e}){super({name:Ya,message:`'${e}' functionality not supported.`}),this[ud]=!0,this.functionality=e}static isInstance(e){return xe.hasMarker(e,ld)}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name===Ya&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};ud=Gx;var Za=ct(Ht(),1);function Ie(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function Nr(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r}),t}var Vx=({prefix:e="",size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}={})=>{let n=Cr(r,t);return o=>`${e}${n(o)}`},Mr=Vx();function Qa(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function Ko({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new Bn({message:`${n} API key must be a string.`});if(typeof process>"u")throw new Bn({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new Bn({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Bn({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}var Xa=Symbol.for("vercel.ai.validator");function qx(e){return{[Xa]:!0,validate:e}}function Jx(e){return typeof e=="object"&&e!==null&&Xa in e&&e[Xa]===!0&&"validate"in e}function zx(e){return Jx(e)?e:Wx(e)}function Wx(e){return qx(t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function Yx({value:e,schema:t}){let r=dd({value:e,schema:t});if(!r.success)throw Pr.wrap({value:e,cause:r.error});return r.value}function dd({value:e,schema:t}){let r=zx(t);try{if(r.validate==null)return{success:!0,value:e};let n=r.validate(e);return n.success?n:{success:!1,error:Pr.wrap({value:e,cause:n.error})}}catch(n){return{success:!1,error:Pr.wrap({value:e,cause:n})}}}function Qx({text:e,schema:t}){try{let r=Za.default.parse(e);return t==null?r:Yx({value:r,schema:t})}catch(r){throw Dn.isJSONParseError(r)||Pr.isTypeValidationError(r)?r:new Dn({text:e,cause:r})}}function Go({text:e,schema:t}){try{let r=Za.default.parse(e);return t==null?{success:!0,value:r}:dd({value:r,schema:t})}catch(r){return{success:!1,error:Dn.isJSONParseError(r)?r:new Dn({text:e,cause:r})}}}function Xx(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var Zx=()=>globalThis.fetch,me=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i})=>ew({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i}),ew=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:o,abortSignal:s,fetch:i=Zx()})=>{try{let a=await i(e,{method:"POST",headers:Xx(t),body:r.content,signal:s}),c=Nr(a);if(!a.ok){let l;try{l=await o({response:a,url:e,requestBodyValues:r.values})}catch(f){throw Qa(f)||je.isAPICallError(f)?f:new je({message:"Failed to process error response",cause:f,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw l.value}try{return await n({response:a,url:e,requestBodyValues:r.values})}catch(l){throw l instanceof Error&&(Qa(l)||je.isAPICallError(l))?l:new je({message:"Failed to process successful response",cause:l,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(a){if(Qa(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){let c=a.cause;if(c!=null)throw new je({message:`Cannot connect to API: ${c.message}`,cause:c,url:e,requestBodyValues:r.values,isRetryable:!0})}throw a}},Dr=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:o,requestBodyValues:s})=>{let i=await n.text(),a=Nr(n);if(i.trim()==="")return{responseHeaders:a,value:new je({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})};try{let c=Qx({text:i,schema:e});return{responseHeaders:a,value:new je({message:t(c),url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,data:c,isRetryable:r?.(n,c)})}}catch{return{responseHeaders:a,value:new je({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})}}},Vo=e=>async({response:t})=>{let r=Nr(t);if(t.body==null)throw new jo({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new It).pipeThrough(new TransformStream({transform({data:n},o){n!=="[DONE]"&&o.enqueue(Go({text:n,schema:e}))}}))}};var Me=e=>async({response:t,url:r,requestBodyValues:n})=>{let o=await t.text(),s=Go({text:o,schema:e}),i=Nr(t);if(!s.success)throw new je({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:o,url:r,requestBodyValues:n});return{responseHeaders:i,value:s.value}},{btoa:tw,atob:$I}=globalThis;function Br(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return tw(t)}function $r(e){return e?.replace(/\/$/,"")}function nt(e){if(typeof e=="boolean")return{type:"boolean",properties:{}};let{type:t,description:r,required:n,properties:o,items:s,allOf:i,anyOf:a,oneOf:c,format:l,const:f,minLength:p}=e,d={};return r&&(d.description=r),n&&(d.required=n),l&&(d.format=l),f!==void 0&&(d.enum=[f]),t&&(Array.isArray(t)?t.includes("null")?(d.type=t.filter(m=>m!=="null")[0],d.nullable=!0):d.type=t:t==="null"?d.type="null":d.type=t),o&&(d.properties=Object.entries(o).reduce((m,[h,y])=>(m[h]=nt(y),m),{})),s&&(d.items=Array.isArray(s)?s.map(nt):nt(s)),i&&(d.allOf=i.map(nt)),a&&(d.anyOf=a.map(nt)),c&&(d.oneOf=c.map(nt)),p!==void 0&&(d.minLength=p),d}function rw(e){var t;let r=[],n=[],o=!0;for(let{role:s,content:i}of e)switch(s){case"system":{if(!o)throw new Ct({functionality:"system messages are only supported at the beginning of the conversation"});r.push({text:i});break}case"user":{o=!1;let a=[];for(let c of i)switch(c.type){case"text":{a.push({text:c.text});break}case"image":{if(c.image instanceof URL)throw new Ct({functionality:"Image URLs in user messages"});a.push({inlineData:{mimeType:(t=c.mimeType)!=null?t:"image/jpeg",data:Br(c.image)}});break}case"file":{if(c.data instanceof URL)throw new Ct({functionality:"File URLs in user messages"});a.push({inlineData:{mimeType:c.mimeType,data:c.data}});break}}n.push({role:"user",parts:a});break}case"assistant":{o=!1,n.push({role:"model",parts:i.map(a=>{switch(a.type){case"text":return a.text.length===0?void 0:{text:a.text};case"tool-call":return{functionCall:{name:a.toolName,args:a.args}}}}).filter(a=>a!==void 0)});break}case"tool":{o=!1,n.push({role:"user",parts:i.map(a=>({functionResponse:{name:a.toolName,response:a.result}}))});break}default:{let a=s;throw new Error(`Unsupported role: ${a}`)}}return{systemInstruction:r.length>0?{parts:r}:void 0,contents:n}}function pd(e){return e.includes("/")?e:`models/${e}`}var nw=u.object({error:u.object({code:u.number().nullable(),message:u.string(),status:u.string()})}),ei=Dr({errorSchema:nw,errorToMessage:e=>e.error.message});function fd({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"RECITATION":case"SAFETY":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";default:return"unknown"}}var ow=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get supportsObjectGeneration(){return this.settings.structuredOutputs!==!1}get provider(){return this.config.provider}async getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f}){var p;let d=e.type,m=[];f!=null&&m.push({type:"unsupported-setting",setting:"seed"});let h={maxOutputTokens:r,temperature:n,topK:s??this.settings.topK,topP:o,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseMimeType:l?.type==="json"?"application/json":void 0,responseSchema:l?.type==="json"&&l.schema!=null&&this.supportsObjectGeneration?nt(l.schema):void 0},{contents:y,systemInstruction:g}=rw(t);switch(d){case"regular":return{args:{generationConfig:h,contents:y,systemInstruction:g,safetySettings:this.settings.safetySettings,...iw(e),cachedContent:this.settings.cachedContent},warnings:m};case"object-json":return{args:{generationConfig:{...h,responseMimeType:"application/json",responseSchema:e.schema!=null&&this.supportsObjectGeneration?nt(e.schema):void 0},contents:y,systemInstruction:g,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:m};case"object-tool":return{args:{generationConfig:h,contents:y,tools:{functionDeclarations:[{name:e.tool.name,description:(p=e.tool.description)!=null?p:"",parameters:nt(e.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:m};default:{let v=d;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(e){var t,r;let{args:n,warnings:o}=await this.getArgs(e),{responseHeaders:s,value:i}=await me({url:`${this.config.baseURL}/${pd(this.modelId)}:generateContent`,headers:Ie(this.config.headers(),e.headers),body:n,failedResponseHandler:ei,successfulResponseHandler:Me(sw),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:a,...c}=n,l=i.candidates[0],f=md({parts:l.content.parts,generateId:this.config.generateId}),p=i.usageMetadata;return{text:hd(l.content.parts),toolCalls:f,finishReason:fd({finishReason:l.finishReason,hasToolCalls:f!=null&&f.length>0}),usage:{promptTokens:(t=p?.promptTokenCount)!=null?t:NaN,completionTokens:(r=p?.candidatesTokenCount)!=null?r:NaN},rawCall:{rawPrompt:a,rawSettings:c},rawResponse:{headers:s},warnings:o}}async doStream(e){let{args:t,warnings:r}=await this.getArgs(e),{responseHeaders:n,value:o}=await me({url:`${this.config.baseURL}/${pd(this.modelId)}:streamGenerateContent?alt=sse`,headers:Ie(this.config.headers(),e.headers),body:t,failedResponseHandler:ei,successfulResponseHandler:Vo(aw),abortSignal:e.abortSignal,fetch:this.config.fetch}),{contents:s,...i}=t,a="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},l=this.config.generateId,f=!1;return{stream:o.pipeThrough(new TransformStream({transform(p,d){var m,h;if(!p.success){d.enqueue({type:"error",error:p.error});return}let y=p.value,g=y.candidates[0];g?.finishReason!=null&&(a=fd({finishReason:g.finishReason,hasToolCalls:f}));let v=y.usageMetadata;v!=null&&(c={promptTokens:(m=v.promptTokenCount)!=null?m:NaN,completionTokens:(h=v.candidatesTokenCount)!=null?h:NaN});let b=g.content;if(b==null)return;let w=hd(b.parts);w!=null&&d.enqueue({type:"text-delta",textDelta:w});let S=md({parts:b.parts,generateId:l});if(S!=null)for(let T of S)d.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:T.toolCallId,toolName:T.toolName,argsTextDelta:T.args}),d.enqueue({type:"tool-call",toolCallType:"function",toolCallId:T.toolCallId,toolName:T.toolName,args:T.args}),f=!0},flush(p){p.enqueue({type:"finish",finishReason:a,usage:c})}})),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:n},warnings:r}}};function md({parts:e,generateId:t}){let r=e.filter(n=>"functionCall"in n);return r.length===0?void 0:r.map(n=>({toolCallType:"function",toolCallId:t(),toolName:n.functionCall.name,args:JSON.stringify(n.functionCall.args)}))}function hd(e){let t=e.filter(r=>"text"in r);return t.length===0?void 0:t.map(r=>r.text).join("")}var gd=u.object({role:u.string(),parts:u.array(u.union([u.object({text:u.string()}),u.object({functionCall:u.object({name:u.string(),args:u.unknown()})})]))}),sw=u.object({candidates:u.array(u.object({content:gd,finishReason:u.string().optional()})),usageMetadata:u.object({promptTokenCount:u.number(),candidatesTokenCount:u.number().nullish(),totalTokenCount:u.number()}).optional()}),aw=u.object({candidates:u.array(u.object({content:gd.optional(),finishReason:u.string().optional()})),usageMetadata:u.object({promptTokenCount:u.number(),candidatesTokenCount:u.number().nullish(),totalTokenCount:u.number()}).optional()});function iw(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0;if(r==null)return{tools:void 0,toolConfig:void 0};let n={functionDeclarations:r.map(i=>{var a;return{name:i.name,description:(a=i.description)!=null?a:"",parameters:nt(i.parameters)}})},o=e.toolChoice;if(o==null)return{tools:n,toolConfig:void 0};let s=o.type;switch(s){case"auto":return{tools:n,toolConfig:{functionCallingConfig:{mode:"AUTO"}}};case"none":return{tools:n,toolConfig:{functionCallingConfig:{mode:"NONE"}}};case"required":return{tools:n,toolConfig:{functionCallingConfig:{mode:"ANY"}}};case"tool":return{tools:n,toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[o.toolName]}}};default:{let i=s;throw new Error(`Unsupported tool choice type: ${i}`)}}}var cw=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Or({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:n,value:o}=await me({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:Ie(this.config.headers(),t),body:{requests:e.map(s=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:s}]},outputDimensionality:this.settings.outputDimensionality}))},failedResponseHandler:ei,successfulResponseHandler:Me(lw),abortSignal:r,fetch:this.config.fetch});return{embeddings:o.embeddings.map(s=>s.values),usage:void 0,rawResponse:{headers:n}}}},lw=u.object({embeddings:u.array(u.object({values:u.array(u.number())}))});function ti(e={}){var t,r;let n=(r=$r((t=e.baseURL)!=null?t:e.baseUrl))!=null?r:"https://generativelanguage.googleapis.com/v1beta",o=()=>({"x-goog-api-key":Ko({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers}),s=(c,l={})=>{var f;return new ow(c,l,{provider:"google.generative-ai",baseURL:n,headers:o,generateId:(f=e.generateId)!=null?f:Mr,fetch:e.fetch})},i=(c,l={})=>new cw(c,l,{provider:"google.generative-ai",baseURL:n,headers:o,fetch:e.fetch}),a=function(c,l){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return s(c,l)};return a.languageModel=s,a.chat=s,a.generativeAI=s,a.embedding=i,a.textEmbedding=i,a.textEmbeddingModel=i,a}var WI=ti();var $n=class extends M{name="Google";getApiKeyLink="https://aistudio.google.com/app/apikey";config={apiTokenKey:"GOOGLE_GENERATIVE_AI_API_KEY"};staticModels=[{name:"gemini-1.5-pro",label:"Gemini 1.5 Pro",provider:"Google",maxTokenAllowed:2e6,maxCompletionTokens:8192},{name:"gemini-1.5-flash",label:"Gemini 1.5 Flash",provider:"Google",maxTokenAllowed:1e6,maxCompletionTokens:8192}];async getDynamicModels(t,r,n){let{apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"GOOGLE_GENERATIVE_AI_API_KEY"});if(!o)throw`Missing Api Key configuration for ${this.name} provider`;let s=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${o}`,{headers:{["Content-Type"]:"application/json"}});if(!s.ok)throw new Error(`Failed to fetch models from Google API: ${s.status} ${s.statusText}`);let i=await s.json();if(!i.models||!Array.isArray(i.models))throw new Error("Invalid response format from Google API");return i.models.filter(c=>{let l=(c.outputTokenLimit||0)>8e3,f=!c.name.includes("exp")||c.name.includes("flash-exp");return l&&f}).map(c=>{let l=c.name.replace("models/",""),f=32e3;c.inputTokenLimit&&c.outputTokenLimit?f=c.inputTokenLimit:l.includes("gemini-1.5-pro")?f=2e6:l.includes("gemini-1.5-flash")||l.includes("gemini-2.0-flash")?f=1e6:(l.includes("gemini-pro")||l.includes("gemini-flash"))&&(f=32e3);let d=Math.min(f,2e6),m=8192;return c.outputTokenLimit&&c.outputTokenLimit>0&&(m=Math.min(c.outputTokenLimit,128e3)),{name:l,label:`${c.displayName} (${d>=1e6?Math.floor(d/1e6)+"M":Math.floor(d/1e3)+"k"} context)`,provider:this.name,maxTokenAllowed:d,maxCompletionTokens:m}})}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"GOOGLE_GENERATIVE_AI_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return ti({apiKey:i})(r)}};var Un=class extends M{name="Groq";getApiKeyLink="https://console.groq.com/keys";config={apiTokenKey:"GROQ_API_KEY"};staticModels=[{name:"llama-3.1-8b-instant",label:"Llama 3.1 8B",provider:"Groq",maxTokenAllowed:128e3,maxCompletionTokens:8192},{name:"llama-3.3-70b-versatile",label:"Llama 3.3 70B",provider:"Groq",maxTokenAllowed:128e3,maxCompletionTokens:8192}];async getDynamicModels(t,r,n){let{apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"GROQ_API_KEY"});if(!o)throw`Missing Api Key configuration for ${this.name} provider`;return(await(await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${o}`}})).json()).data.filter(c=>c.object==="model"&&c.active&&c.context_window>8e3).map(c=>({name:c.id,label:`${c.id} - context ${c.context_window?Math.floor(c.context_window/1e3)+"k":"N/A"} [ by ${c.owned_by}]`,provider:this.name,maxTokenAllowed:Math.min(c.context_window||8192,16384),maxCompletionTokens:8192}))}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"GROQ_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return X({baseURL:"https://api.groq.com/openai/v1",apiKey:i})(r)}};var Ln=class extends M{name="HuggingFace";getApiKeyLink="https://huggingface.co/settings/tokens";config={apiTokenKey:"HuggingFace_API_KEY"};staticModels=[{name:"Qwen/Qwen2.5-Coder-32B-Instruct",label:"Qwen2.5-Coder-32B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"01-ai/Yi-1.5-34B-Chat",label:"Yi-1.5-34B-Chat (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"codellama/CodeLlama-34b-Instruct-hf",label:"CodeLlama-34b-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"NousResearch/Hermes-3-Llama-3.1-8B",label:"Hermes-3-Llama-3.1-8B (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"Qwen/Qwen2.5-Coder-32B-Instruct",label:"Qwen2.5-Coder-32B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"Qwen/Qwen2.5-72B-Instruct",label:"Qwen2.5-72B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"meta-llama/Llama-3.1-70B-Instruct",label:"Llama-3.1-70B-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"meta-llama/Llama-3.1-405B",label:"Llama-3.1-405B (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"01-ai/Yi-1.5-34B-Chat",label:"Yi-1.5-34B-Chat (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"codellama/CodeLlama-34b-Instruct-hf",label:"CodeLlama-34b-Instruct (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3},{name:"NousResearch/Hermes-3-Llama-3.1-8B",label:"Hermes-3-Llama-3.1-8B (HuggingFace)",provider:"HuggingFace",maxTokenAllowed:8e3}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"HuggingFace_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return X({baseURL:"https://api-inference.huggingface.co/v1/",apiKey:i})(r)}};var Fn=class extends M{name="LMStudio";getApiKeyLink="https://lmstudio.ai/";labelForGetApiKey="Get LMStudio";icon="i-ph:cloud-arrow-down";config={baseUrlKey:"LMSTUDIO_API_BASE_URL",baseUrl:"http://localhost:1234/"};staticModels=[];async getDynamicModels(t,r,n={}){let{baseUrl:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"LMSTUDIO_API_BASE_URL",defaultApiTokenKey:""});if(!o)throw new Error("No baseUrl found for LMStudio provider");if(typeof window>"u"){let a=process?.env?.RUNNING_IN_DOCKER==="true"||n?.RUNNING_IN_DOCKER==="true";o=a?o.replace("localhost","host.docker.internal"):o,o=a?o.replace("127.0.0.1","host.docker.internal"):o}return(await(await fetch(`${o}/v1/models`)).json()).data.map(a=>({name:a.id,label:a.id,provider:this.name,maxTokenAllowed:8e3}))}getModelInstance=t=>{let{apiKeys:r,providerSettings:n,serverEnv:o,model:s}=t,{baseUrl:i}=this.getProviderBaseUrlAndKey({apiKeys:r,providerSettings:n?.[this.name],serverEnv:o,defaultBaseUrlKey:"LMSTUDIO_API_BASE_URL",defaultApiTokenKey:""});if(!i)throw new Error("No baseUrl found for LMStudio provider");let a=process?.env?.RUNNING_IN_DOCKER==="true"||o?.RUNNING_IN_DOCKER==="true";return typeof window>"u"&&(i=a?i.replace("localhost","host.docker.internal"):i,i=a?i.replace("127.0.0.1","host.docker.internal"):i),Ao.debug("LMStudio Base Url used: ",i),X({baseURL:`${i}/v1`,apiKey:""})(s)}};function uw(e){let t=[];for(let r=0;r<e.length;r++){let{role:n,content:o}=e[r],s=r===e.length-1;switch(n){case"system":{t.push({role:"system",content:o});break}case"user":{t.push({role:"user",content:o.map(i=>{var a;switch(i.type){case"text":return{type:"text",text:i.text};case"image":return{type:"image_url",image_url:i.image instanceof URL?i.image.toString():`data:${(a=i.mimeType)!=null?a:"image/jpeg"};base64,${Br(i.image)}`};case"file":throw new Ct({functionality:"File content parts in user messages"})}})});break}case"assistant":{let i="",a=[];for(let c of o)switch(c.type){case"text":{i+=c.text;break}case"tool-call":{a.push({id:c.toolCallId,type:"function",function:{name:c.toolName,arguments:JSON.stringify(c.args)}});break}default:{let l=c;throw new Error(`Unsupported part: ${l}`)}}t.push({role:"assistant",content:i,prefix:s?!0:void 0,tool_calls:a.length>0?a:void 0});break}case"tool":{for(let i of o)t.push({role:"tool",name:i.toolName,content:JSON.stringify(i.result),tool_call_id:i.toolCallId});break}default:{let i=n;throw new Error(`Unsupported role: ${i}`)}}}return t}function yd(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}var dw=u.object({object:u.literal("error"),message:u.string(),type:u.string(),param:u.string().nullable(),code:u.string().nullable()}),ri=Dr({errorSchema:dw,errorToMessage:e=>e.message});function vd({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}var pw=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f}){let p=e.type,d=[];s!=null&&d.push({type:"unsupported-setting",setting:"topK"}),i!=null&&d.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&d.push({type:"unsupported-setting",setting:"presencePenalty"}),c!=null&&d.push({type:"unsupported-setting",setting:"stopSequences"}),l!=null&&l.type==="json"&&l.schema!=null&&d.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is not supported"});let m={model:this.modelId,safe_prompt:this.settings.safePrompt,max_tokens:r,temperature:n,top_p:o,random_seed:f,response_format:l?.type==="json"?{type:"json_object"}:void 0,messages:uw(t)};switch(p){case"regular":return{args:{...m,...hw(e)},warnings:d};case"object-json":return{args:{...m,response_format:{type:"json_object"}},warnings:d};case"object-tool":return{args:{...m,tool_choice:"any",tools:[{type:"function",function:e.tool}]},warnings:d};default:{let h=p;throw new Error(`Unsupported type: ${h}`)}}}async doGenerate(e){var t,r;let{args:n,warnings:o}=this.getArgs(e),{responseHeaders:s,value:i}=await me({url:`${this.config.baseURL}/chat/completions`,headers:Ie(this.config.headers(),e.headers),body:n,failedResponseHandler:ri,successfulResponseHandler:Me(fw),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:a,...c}=n,l=i.choices[0],f=(t=l.message.content)!=null?t:void 0,p=a[a.length-1];return p.role==="assistant"&&f?.startsWith(p.content)&&(f=f.slice(p.content.length)),{text:f,toolCalls:(r=l.message.tool_calls)==null?void 0:r.map(d=>({toolCallType:"function",toolCallId:d.id,toolName:d.function.name,args:d.function.arguments})),finishReason:yd(l.finish_reason),usage:{promptTokens:i.usage.prompt_tokens,completionTokens:i.usage.completion_tokens},rawCall:{rawPrompt:a,rawSettings:c},rawResponse:{headers:s},response:vd(i),warnings:o}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:n,value:o}=await me({url:`${this.config.baseURL}/chat/completions`,headers:Ie(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:ri,successfulResponseHandler:Vo(mw),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:s,...i}=t,a="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},l=0,f=!1;return{stream:o.pipeThrough(new TransformStream({transform(p,d){if(!p.success){d.enqueue({type:"error",error:p.error});return}l++;let m=p.value;l===1&&d.enqueue({type:"response-metadata",...vd(m)}),m.usage!=null&&(c={promptTokens:m.usage.prompt_tokens,completionTokens:m.usage.completion_tokens});let h=m.choices[0];if(h?.finish_reason!=null&&(a=yd(h.finish_reason)),h?.delta==null)return;let y=h.delta;if(l<=2){let g=s[s.length-1];if(g.role==="assistant"&&y.content===g.content.trimEnd()){y.content.length<g.content.length&&(f=!0);return}}if(y.content!=null&&(d.enqueue({type:"text-delta",textDelta:f?y.content.trimStart():y.content}),f=!1),y.tool_calls!=null)for(let g of y.tool_calls)d.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:g.id,toolName:g.function.name,argsTextDelta:g.function.arguments}),d.enqueue({type:"tool-call",toolCallType:"function",toolCallId:g.id,toolName:g.function.name,args:g.function.arguments})},flush(p){p.enqueue({type:"finish",finishReason:a,usage:c})}})),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:n},warnings:r}}},fw=u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({message:u.object({role:u.literal("assistant"),content:u.string().nullable(),tool_calls:u.array(u.object({id:u.string(),function:u.object({name:u.string(),arguments:u.string()})})).nullish()}),index:u.number(),finish_reason:u.string().nullish()})),object:u.literal("chat.completion"),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()})}),mw=u.object({id:u.string().nullish(),created:u.number().nullish(),model:u.string().nullish(),choices:u.array(u.object({delta:u.object({role:u.enum(["assistant"]).optional(),content:u.string().nullish(),tool_calls:u.array(u.object({id:u.string(),function:u.object({name:u.string(),arguments:u.string()})})).nullish()}),finish_reason:u.string().nullish(),index:u.number()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()}).nullish()});function hw(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0;if(r==null)return{tools:void 0,tool_choice:void 0};let n=r.map(i=>({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}})),o=e.toolChoice;if(o==null)return{tools:n,tool_choice:void 0};let s=o.type;switch(s){case"auto":case"none":return{tools:n,tool_choice:s};case"required":return{tools:n,tool_choice:"any"};case"tool":return{tools:n.filter(i=>i.function.name===o.toolName),tool_choice:"any"};default:{let i=s;throw new Error(`Unsupported tool choice type: ${i}`)}}}var gw=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:32}get supportsParallelCalls(){var e;return(e=this.settings.supportsParallelCalls)!=null?e:!1}async doEmbed({values:e,abortSignal:t,headers:r}){if(e.length>this.maxEmbeddingsPerCall)throw new Or({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:n,value:o}=await me({url:`${this.config.baseURL}/embeddings`,headers:Ie(this.config.headers(),r),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:ri,successfulResponseHandler:Me(yw),abortSignal:t,fetch:this.config.fetch});return{embeddings:o.data.map(s=>s.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,rawResponse:{headers:n}}}},yw=u.object({data:u.array(u.object({embedding:u.array(u.number())})),usage:u.object({prompt_tokens:u.number()}).nullish()});function ni(e={}){var t,r;let n=(r=$r((t=e.baseURL)!=null?t:e.baseUrl))!=null?r:"https://api.mistral.ai/v1",o=()=>({Authorization:`Bearer ${Ko({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers}),s=(c,l={})=>new pw(c,l,{provider:"mistral.chat",baseURL:n,headers:o,fetch:e.fetch}),i=(c,l={})=>new gw(c,l,{provider:"mistral.embedding",baseURL:n,headers:o,fetch:e.fetch}),a=function(c,l){if(new.target)throw new Error("The Mistral model function cannot be called with the new keyword.");return s(c,l)};return a.languageModel=s,a.chat=s,a.embedding=i,a.textEmbedding=i,a.textEmbeddingModel=i,a}var _C=ni();var Hn=class extends M{name="Mistral";getApiKeyLink="https://console.mistral.ai/api-keys/";config={apiTokenKey:"MISTRAL_API_KEY"};staticModels=[{name:"open-mistral-7b",label:"Mistral 7B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-mixtral-8x7b",label:"Mistral 8x7B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-mixtral-8x22b",label:"Mistral 8x22B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-codestral-mamba",label:"Codestral Mamba",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"open-mistral-nemo",label:"Mistral Nemo",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"ministral-8b-latest",label:"Mistral 8B",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"mistral-small-latest",label:"Mistral Small",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"codestral-latest",label:"Codestral",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192},{name:"mistral-large-latest",label:"Mistral Large Latest",provider:"Mistral",maxTokenAllowed:8e3,maxCompletionTokens:8192}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"MISTRAL_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return ni({apiKey:i})(r)}};var wd=ct(xd(),1);function si(e){let t=[];for(let{content:r,role:n}of e)switch(n){case"system":{t.push({content:r,role:"system"});break}case"user":{t.push({...r.reduce((o,s)=>{if(s.type==="text")o.content+=s.text;else{if(s.type==="image"&&s.image instanceof URL)throw new Ct({functionality:"Image URLs in user messages"});s.type==="image"&&s.image instanceof Uint8Array&&(o.images=o.images||[],o.images.push(Br(s.image)))}return o},{content:""}),role:"user"});break}case"assistant":{let o=[],s=[];for(let i of r)switch(i.type){case"text":{o.push(i.text);break}case"tool-call":{s.push({function:{arguments:i.args,name:i.toolName},id:i.toolCallId,type:"function"});break}default:{let a=i;throw new Error(`Unsupported part: ${a}`)}}t.push({content:o.join(","),role:"assistant",tool_calls:s.length>0?s:void 0});break}case"tool":{t.push(...r.map(o=>({content:typeof o.result=="object"?JSON.stringify(o.result):`${o.result}`,role:"tool",tool_call_id:o.toolCallId})));break}default:{let o=n;throw new Error(`Unsupported role: ${o}`)}}return t}var _w=class{constructor({tools:e,type:t}){this._firstMessage=!0,this._tools=e,this._toolPartial="",this._toolCalls=[],this._type=t,this._detectedToolCall=!1}get toolCalls(){return this._toolCalls}get detectedToolCall(){return this._detectedToolCall}parse({controller:e,delta:t}){var r;if(this.detectToolCall(t),!this._detectedToolCall)return!1;this._toolPartial+=t;let n=(0,wd.parse)(this._toolPartial);Array.isArray(n)||(n=[n]);for(let[o,s]of n.entries()){let i=(r=JSON.stringify(s?.parameters))!=null?r:"";if(i==="")continue;this._toolCalls[o]||(this._toolCalls[o]={function:{arguments:"",name:s.name},id:Mr(),type:"function"});let a=this._toolCalls[o];a.function.arguments=i,e.enqueue({argsTextDelta:t,toolCallId:a.id,toolCallType:"function",toolName:a.function.name,type:"tool-call-delta"})}return!0}finish({controller:e}){for(let t of this.toolCalls)e.enqueue({args:t.function.arguments,toolCallId:t.id,toolCallType:"function",toolName:t.function.name,type:"tool-call"});return this.finishReason()}detectToolCall(e){!this._tools||this._tools.length===0||this._firstMessage&&(this._type==="object-tool"?this._detectedToolCall=!0:this._type==="regular"&&(e.trim().startsWith("{")||e.trim().startsWith("["))&&(this._detectedToolCall=!0),this._firstMessage=!1)}finishReason(){return this.detectedToolCall?this._type==="object-tool"?"stop":"tool-calls":"stop"}};function Ew({finishReason:e,hasToolCalls:t}){switch(e){case"stop":return t?"tool-calls":"stop";default:return"other"}}var Sw=u.object({error:u.object({code:u.string().nullable(),message:u.string(),param:u.any().nullable(),type:u.string()})}),ai=Dr({errorSchema:Sw,errorToMessage:e=>e.error.message});function Aw(e){return Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}var kw=class extends TransformStream{constructor(){super({flush:e=>{this.buffer.length!==0&&e.enqueue(this.buffer)},transform:(e,t)=>{for(e=this.buffer+e;;){let r=e.indexOf(`
`);if(r===-1)break;t.enqueue(e.slice(0,r)),e=e.slice(r+1)}this.buffer=e}}),this.buffer=""}},Tw=e=>async({response:t})=>{let r=Nr(t);if(t.body===null)throw new jo({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new kw).pipeThrough(new TransformStream({transform(n,o){o.enqueue(Go({schema:e,text:n}))}}))}},Iw=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1}get provider(){return this.config.provider}getArguments({frequencyPenalty:e,maxTokens:t,mode:r,presencePenalty:n,prompt:o,responseFormat:s,seed:i,stopSequences:a,temperature:c,topK:l,topP:f}){var p,d,m;let h=r.type,y=[];s!==void 0&&s.type==="json"&&s.schema!==void 0&&y.push({details:"JSON response format schema is not supported",setting:"responseFormat",type:"unsupported-setting"});let g={format:s?.type,model:this.modelId,options:Aw({f16_kv:this.settings.f16Kv,frequency_penalty:e,low_vram:this.settings.lowVram,main_gpu:this.settings.mainGpu,min_p:this.settings.minP,mirostat:this.settings.mirostat,mirostat_eta:this.settings.mirostatEta,mirostat_tau:this.settings.mirostatTau,num_batch:this.settings.numBatch,num_ctx:this.settings.numCtx,num_gpu:this.settings.numGpu,num_keep:this.settings.numKeep,num_predict:t,num_thread:this.settings.numThread,numa:this.settings.numa,penalize_newline:this.settings.penalizeNewline,presence_penalty:n,repeat_last_n:this.settings.repeatLastN,repeat_penalty:this.settings.repeatPenalty,seed:i,stop:(p=this.settings.stop)!=null?p:a,temperature:c,tfs_z:this.settings.tfsZ,top_k:(d=this.settings.topK)!=null?d:l,top_p:f,typical_p:this.settings.typicalP,use_mlock:this.settings.useMlock,use_mmap:this.settings.useMmap,vocab_only:this.settings.vocabOnly})};switch(h){case"regular":{let v=(m=r.tools)!=null&&m.length?r.tools:void 0;return{args:{...g,messages:si(o),tools:v?.map(b=>({function:{description:b.description,name:b.name,parameters:b.parameters},type:"function"}))},type:h,warnings:y}}case"object-json":return{args:{...g,format:"json",messages:si(o)},type:h,warnings:y};case"object-tool":return{args:{...g,messages:si(o),tool_choice:{function:{name:r.tool.name},type:"function"},tools:[{function:{description:r.tool.description,name:r.tool.name,parameters:r.tool.parameters},type:"function"}]},type:h,warnings:y};default:{let v=h;throw new Error(`Unsupported type: ${v}`)}}}async doGenerate(e){var t,r;let{args:n,warnings:o}=this.getArguments(e),{responseHeaders:s,value:i}=await me({abortSignal:e.abortSignal,body:{...n,stream:!1},failedResponseHandler:ai,fetch:this.config.fetch,headers:Ie(this.config.headers(),e.headers),successfulResponseHandler:Me(Cw),url:`${this.config.baseURL}/chat`}),{messages:a,...c}=n,l=(t=i.message.tool_calls)==null?void 0:t.map(f=>{var p;return{args:JSON.stringify(f.function.arguments),toolCallId:(p=f.id)!=null?p:Mr(),toolCallType:"function",toolName:f.function.name}});return{finishReason:Ew({finishReason:i.done_reason,hasToolCalls:l!==void 0&&l.length>0}),rawCall:{rawPrompt:a,rawSettings:c},rawResponse:{headers:s},text:(r=i.message.content)!=null?r:void 0,toolCalls:l,usage:{completionTokens:i.eval_count||0,promptTokens:i.prompt_eval_count||0},warnings:o}}async doStream(e){let{args:t,type:r,warnings:n}=this.getArguments(e),{responseHeaders:o,value:s}=await me({abortSignal:e.abortSignal,body:t,failedResponseHandler:ai,fetch:this.config.fetch,headers:Ie(this.config.headers(),e.headers),successfulResponseHandler:Tw(Rw),url:`${this.config.baseURL}/chat`}),{messages:i,...a}=t,c=e.mode.type==="regular"?e.mode.tools:e.mode.type==="object-tool"?[e.mode.tool]:void 0,l=new _w({tools:c,type:r}),f="other",p={completionTokens:Number.NaN,promptTokens:Number.NaN},{experimentalStreamTools:d=!0}=this.settings;return{rawCall:{rawPrompt:i,rawSettings:a},rawResponse:{headers:o},stream:s.pipeThrough(new TransformStream({async flush(m){m.enqueue({finishReason:f,type:"finish",usage:p})},async transform(m,h){if(!m.success){h.enqueue({error:m.error,type:"error"});return}let y=m.value;if(y.done){f=l.finish({controller:h}),p={completionTokens:y.eval_count,promptTokens:y.prompt_eval_count||0};return}d&&l.parse({controller:h,delta:y.message.content})||y.message.content!==null&&h.enqueue({textDelta:y.message.content,type:"text-delta"})}})),warnings:n}}},Cw=u.object({created_at:u.string(),done:u.literal(!0),done_reason:u.string().optional().nullable(),eval_count:u.number(),eval_duration:u.number(),load_duration:u.number().optional(),message:u.object({content:u.string(),role:u.string(),tool_calls:u.array(u.object({function:u.object({arguments:u.record(u.any()),name:u.string()}),id:u.string().optional()})).optional().nullable()}),model:u.string(),prompt_eval_count:u.number().optional(),prompt_eval_duration:u.number().optional(),total_duration:u.number()}),Rw=u.discriminatedUnion("done",[u.object({created_at:u.string(),done:u.literal(!1),message:u.object({content:u.string(),role:u.string()}),model:u.string()}),u.object({created_at:u.string(),done:u.literal(!0),eval_count:u.number(),eval_duration:u.number(),load_duration:u.number().optional(),model:u.string(),prompt_eval_count:u.number().optional(),prompt_eval_duration:u.number().optional(),total_duration:u.number()})]);var Ow=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return(e=this.settings.maxEmbeddingsPerCall)!=null?e:2048}get supportsParallelCalls(){return!1}async doEmbed({abortSignal:e,values:t}){if(t.length>this.maxEmbeddingsPerCall)throw new Or({maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,modelId:this.modelId,provider:this.provider,values:t});let{responseHeaders:r,value:n}=await me({abortSignal:e,body:{input:t,model:this.modelId},failedResponseHandler:ai,fetch:this.config.fetch,headers:this.config.headers(),successfulResponseHandler:Me(Pw),url:`${this.config.baseURL}/embed`});return{embeddings:n.embeddings,rawResponse:{headers:r},usage:n.prompt_eval_count?{tokens:n.prompt_eval_count}:void 0}}},Pw=u.object({embeddings:u.array(u.array(u.number())),prompt_eval_count:u.number().nullable()});function Nw(e={}){var t;let r=(t=$r(e.baseURL))!=null?t:"http://127.0.0.1:11434/api",n=()=>({...e.headers}),o=(a,c={})=>new Iw(a,c,{baseURL:r,fetch:e.fetch,headers:n,provider:"ollama.chat"}),s=(a,c={})=>new Ow(a,c,{baseURL:r,fetch:e.fetch,headers:n,provider:"ollama.embedding"}),i=function(a,c){if(new.target)throw new Error("The Ollama model function cannot be called with the new keyword.");return o(a,c)};return i.chat=o,i.embedding=s,i.languageModel=o,i.textEmbedding=s,i.textEmbeddingModel=s,i}var _d=Nw();var jn=class extends M{name="Ollama";getApiKeyLink="https://ollama.com/download";labelForGetApiKey="Download Ollama";icon="i-ph:cloud-arrow-down";config={baseUrlKey:"OLLAMA_API_BASE_URL"};staticModels=[];_convertEnvToRecord(t){return t?Object.entries(t).reduce((r,[n,o])=>(r[n]=String(o),r),{}):{}}getDefaultNumCtx(t){let r=this._convertEnvToRecord(t);return r.DEFAULT_NUM_CTX?parseInt(r.DEFAULT_NUM_CTX,10):32768}async getDynamicModels(t,r,n={}){let{baseUrl:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"OLLAMA_API_BASE_URL",defaultApiTokenKey:""});if(!o)throw new Error("No baseUrl found for OLLAMA provider");if(typeof window>"u"){let a=process?.env?.RUNNING_IN_DOCKER==="true"||n?.RUNNING_IN_DOCKER==="true";o=a?o.replace("localhost","host.docker.internal"):o,o=a?o.replace("127.0.0.1","host.docker.internal"):o}return(await(await fetch(`${o}/api/tags`)).json()).models.map(a=>({name:a.name,label:`${a.name} (${a.details.parameter_size})`,provider:this.name,maxTokenAllowed:8e3}))}getModelInstance=t=>{let{apiKeys:r,providerSettings:n,serverEnv:o,model:s}=t,i=this._convertEnvToRecord(o),{baseUrl:a}=this.getProviderBaseUrlAndKey({apiKeys:r,providerSettings:n?.[this.name],serverEnv:i,defaultBaseUrlKey:"OLLAMA_API_BASE_URL",defaultApiTokenKey:""});if(!a)throw new Error("No baseUrl found for OLLAMA provider");let c=process?.env?.RUNNING_IN_DOCKER==="true"||i.RUNNING_IN_DOCKER==="true";a=c?a.replace("localhost","host.docker.internal"):a,a=c?a.replace("127.0.0.1","host.docker.internal"):a,Ao.debug("Ollama Base Url used: ",a);let l=_d(s,{numCtx:this.getDefaultNumCtx(o)});return l.config.baseURL=`${a}/api`,l}};var Ke=class extends Error{constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:o,responseBody:s,cause:i,isRetryable:a=n!=null&&(n===408||n===409||n===429||n>=500),data:c}){super(e),this.name="AI_APICallError",this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=o,this.responseBody=s,this.cause=i,this.isRetryable=a,this.data=c}static isAPICallError(e){return e instanceof Error&&e.name==="AI_APICallError"&&typeof e.url=="string"&&typeof e.requestBodyValues=="object"&&(e.statusCode==null||typeof e.statusCode=="number")&&(e.responseHeaders==null||typeof e.responseHeaders=="object")&&(e.responseBody==null||typeof e.responseBody=="string")&&(e.cause==null||typeof e.cause=="object")&&typeof e.isRetryable=="boolean"&&(e.data==null||typeof e.data=="object")}toJSON(){return{name:this.name,message:this.message,url:this.url,requestBodyValues:this.requestBodyValues,statusCode:this.statusCode,responseHeaders:this.responseHeaders,responseBody:this.responseBody,cause:this.cause,isRetryable:this.isRetryable,data:this.data}}};var Ed=class extends Error{constructor({message:e="Empty response body"}={}){super(e),this.name="AI_EmptyResponseBodyError"}static isEmptyResponseBodyError(e){return e instanceof Error&&e.name==="AI_EmptyResponseBodyError"}toJSON(){return{name:this.name,message:this.message,stack:this.stack}}};var Sd=class extends Error{constructor({prompt:e,message:t}){super(`Invalid prompt: ${t}`),this.name="AI_InvalidPromptError",this.prompt=e}static isInvalidPromptError(e){return e instanceof Error&&e.name==="AI_InvalidPromptError"&&prompt!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,prompt:this.prompt}}},zo=class extends Error{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super(t),this.name="AI_InvalidResponseDataError",this.data=e}static isInvalidResponseDataError(e){return e instanceof Error&&e.name==="AI_InvalidResponseDataError"&&e.data!=null}toJSON(){return{name:this.name,message:this.message,stack:this.stack,data:this.data}}};function Ad(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var Kn=class extends Error{constructor({text:e,cause:t}){super(`JSON parsing failed: Text: ${e}.
Error message: ${Ad(t)}`),this.name="AI_JSONParseError",this.cause=t,this.text=e}static isJSONParseError(e){return e instanceof Error&&e.name==="AI_JSONParseError"&&typeof e.text=="string"&&typeof e.cause=="string"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,valueText:this.text}}},Gn=class extends Error{constructor({message:e}){super(e),this.name="AI_LoadAPIKeyError"}static isLoadAPIKeyError(e){return e instanceof Error&&e.name==="AI_LoadAPIKeyError"}toJSON(){return{name:this.name,message:this.message}}};var or=class extends Error{constructor({value:e,cause:t}){super(`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Ad(t)}`),this.name="AI_TypeValidationError",this.cause=t,this.value=e}static isTypeValidationError(e){return e instanceof Error&&e.name==="AI_TypeValidationError"}toJSON(){return{name:this.name,message:this.message,cause:this.cause,stack:this.stack,value:this.value}}},De=class extends Error{constructor({functionality:e}){super(`'${e}' functionality not supported.`),this.name="AI_UnsupportedFunctionalityError",this.functionality=e}static isUnsupportedFunctionalityError(e){return e instanceof Error&&e.name==="AI_UnsupportedFunctionalityError"&&typeof e.functionality=="string"}toJSON(){return{name:this.name,message:this.message,stack:this.stack,functionality:this.functionality}}};var Qo=ct(Ht(),1);function Ur(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function Wo(e){let t={};return e.headers.forEach((r,n)=>{t[n]=r}),t}var Yo=Cr("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function ii(e){return e instanceof Error&&(e.name==="AbortError"||e.name==="TimeoutError")}function kd({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new Gn({message:`${n} API key must be a string.`});if(typeof process>"u")throw new Gn({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new Gn({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Gn({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function Mw({value:e,schema:t}){try{return t.parse(e)}catch(r){throw new or({value:e,cause:r})}}function Dw({value:e,schema:t}){try{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:new or({value:e,cause:r.error})}}catch(r){return{success:!1,error:or.isTypeValidationError(r)?r:new or({value:e,cause:r})}}}function Bw({text:e,schema:t}){try{let r=Qo.default.parse(e);return t==null?r:Mw({value:r,schema:t})}catch(r){throw Kn.isJSONParseError(r)||or.isTypeValidationError(r)?r:new Kn({text:e,cause:r})}}function Td({text:e,schema:t}){try{let r=Qo.default.parse(e);return t==null?{success:!0,value:r}:Dw({value:r,schema:t})}catch(r){return{success:!1,error:Kn.isJSONParseError(r)?r:new Kn({text:e,cause:r})}}}function ci(e){try{return Qo.default.parse(e),!0}catch{return!1}}function $w(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}var Uw=()=>fetch,Lr=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i})=>Lw({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:o,abortSignal:s,fetch:i}),Lw=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:o,abortSignal:s,fetch:i=Uw()})=>{try{let a=await i(e,{method:"POST",headers:$w(t),body:r.content,signal:s}),c=Wo(a);if(!a.ok){let l;try{l=await o({response:a,url:e,requestBodyValues:r.values})}catch(f){throw ii(f)||Ke.isAPICallError(f)?f:new Ke({message:"Failed to process error response",cause:f,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}throw l.value}try{return await n({response:a,url:e,requestBodyValues:r.values})}catch(l){throw l instanceof Error&&(ii(l)||Ke.isAPICallError(l))?l:new Ke({message:"Failed to process successful response",cause:l,statusCode:a.status,url:e,responseHeaders:c,requestBodyValues:r.values})}}catch(a){if(ii(a))throw a;if(a instanceof TypeError&&a.message==="fetch failed"){let c=a.cause;if(c!=null)throw new Ke({message:`Cannot connect to API: ${c.message}`,cause:c,url:e,requestBodyValues:r.values,isRetryable:!0})}throw a}},Id=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:o,requestBodyValues:s})=>{let i=await n.text(),a=Wo(n);if(i.trim()==="")return{responseHeaders:a,value:new Ke({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})};try{let c=Bw({text:i,schema:e});return{responseHeaders:a,value:new Ke({message:t(c),url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,data:c,isRetryable:r?.(n,c)})}}catch{return{responseHeaders:a,value:new Ke({message:n.statusText,url:o,requestBodyValues:s,statusCode:n.status,responseHeaders:a,responseBody:i,isRetryable:r?.(n)})}}},Xo=e=>async({response:t})=>{let r=Wo(t);if(t.body==null)throw new Ed({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new It).pipeThrough(new TransformStream({transform({data:n},o){n!=="[DONE]"&&o.enqueue(Td({text:n,schema:e}))}}))}};var Zo=e=>async({response:t,url:r,requestBodyValues:n})=>{let o=await t.text(),s=Td({text:o,schema:e}),i=Wo(t);if(!s.success)throw new Ke({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:i,responseBody:o,url:r,requestBodyValues:n});return{responseHeaders:i,value:s.value}};function Cd(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return globalThis.btoa(t)}function Rd(e){return e?.replace(/\/$/,"")}var Fw=Object.defineProperty,Hw=Object.defineProperties,jw=Object.getOwnPropertyDescriptors,ts=Object.getOwnPropertySymbols,Md=Object.prototype.hasOwnProperty,Dd=Object.prototype.propertyIsEnumerable,Od=(e,t,r)=>t in e?Fw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ht=(e,t)=>{for(var r in t||(t={}))Md.call(t,r)&&Od(e,r,t[r]);if(ts)for(var r of ts(t))Dd.call(t,r)&&Od(e,r,t[r]);return e},es=(e,t)=>Hw(e,jw(t)),rs=(e,t)=>{var r={};for(var n in e)Md.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&ts)for(var n of ts(e))t.indexOf(n)<0&&Dd.call(e,n)&&(r[n]=e[n]);return r};function Kw(e){var t;let r=[];for(let{role:n,content:o}of e)switch(n){case"system":{r.push({role:"system",content:o});break}case"user":{if(o.length===1&&((t=o[0])==null?void 0:t.type)==="text"){r.push({role:"user",content:o[0].text});break}r.push({role:"user",content:o.map(s=>{var i;switch(s.type){case"text":return{type:"text",text:s.text};case"image":return{type:"image_url",image_url:{url:s.image instanceof URL?s.image.toString():`data:${(i=s.mimeType)!=null?i:"image/jpeg"};base64,${Cd(s.image)}`}}}})});break}case"assistant":{let s="",i=[];for(let a of o)switch(a.type){case"text":{s+=a.text;break}case"tool-call":{i.push({id:a.toolCallId,type:"function",function:{name:a.toolName,arguments:JSON.stringify(a.args)}});break}default:{let c=a;throw new Error(`Unsupported part: ${c}`)}}r.push({role:"assistant",content:s,tool_calls:i.length>0?i:void 0});break}case"tool":{for(let s of o)r.push({role:"tool",tool_call_id:s.toolCallId,content:JSON.stringify(s.result)});break}default:{let s=n;throw new Error(`Unsupported role: ${s}`)}}return r}function Pd(e){var t,r;return(r=(t=e?.content)==null?void 0:t.map(({token:n,logprob:o,top_logprobs:s})=>({token:n,logprob:o,topLogprobs:s?s.map(({token:i,logprob:a})=>({token:i,logprob:a})):[]})))!=null?r:void 0}function ns(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var li=u.object({error:u.object({message:u.string(),type:u.string(),param:u.any().nullable(),code:u.string().nullable()})}),os=Id({errorSchema:li,errorToMessage:e=>e.error.message}),Gw=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode="tool",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,frequencyPenalty:s,presencePenalty:i,seed:a}){let c=e.type,l=ht({model:this.modelId,logit_bias:this.settings.logitBias,logprobs:this.settings.logprobs===!0||typeof this.settings.logprobs=="number"?!0:void 0,top_logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:n,top_p:o,frequency_penalty:s,presence_penalty:i,seed:a,messages:Kw(t)},this.config.extraBody);switch(c){case"regular":return ht(ht({},l),Jw(e));case"object-json":return es(ht({},l),{response_format:{type:"json_object"}});case"object-tool":return es(ht({},l),{tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}}]});case"object-grammar":throw new De({functionality:"object-grammar mode"});default:{let f=c;throw new Error(`Unsupported type: ${f}`)}}}async doGenerate(e){var t,r;let n=this.getArgs(e),{responseHeaders:o,value:s}=await Lr({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ur(this.config.headers(),e.headers),body:n,failedResponseHandler:os,successfulResponseHandler:Zo(Vw),abortSignal:e.abortSignal,fetch:this.config.fetch}),i=n,{messages:a}=i,c=rs(i,["messages"]),l=s.choices[0];if(l==null)throw new Error("No choice in response");return{text:(t=l.message.content)!=null?t:void 0,toolCalls:(r=l.message.tool_calls)==null?void 0:r.map(f=>{var p;return{toolCallType:"function",toolCallId:(p=f.id)!=null?p:Yo(),toolName:f.function.name,args:f.function.arguments}}),finishReason:ns(l.finish_reason),usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},rawCall:{rawPrompt:a,rawSettings:c},rawResponse:{headers:o},warnings:[],logprobs:Pd(l.logprobs)}}async doStream(e){let t=this.getArgs(e),{responseHeaders:r,value:n}=await Lr({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:Ur(this.config.headers(),e.headers),body:es(ht({},t),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:os,successfulResponseHandler:Xo(qw),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=t,{messages:s}=o,i=rs(o,["messages"]),a=[],c="other",l={promptTokens:Number.NaN,completionTokens:Number.NaN},f;return{stream:n.pipeThrough(new TransformStream({transform(p,d){var m,h,y,g,v,b,w,S,T,U,I,G;if(!p.success){c="error",d.enqueue({type:"error",error:p.error});return}let F=p.value;if("error"in F){c="error",d.enqueue({type:"error",error:F.error});return}F.usage!=null&&(l={promptTokens:F.usage.prompt_tokens,completionTokens:F.usage.completion_tokens});let q=F.choices[0];if(q?.finish_reason!=null&&(c=ns(q.finish_reason)),q?.delta==null)return;let J=q.delta;J.content!=null&&d.enqueue({type:"text-delta",textDelta:J.content});let ee=Pd(q?.logprobs);if(ee?.length&&(f===void 0&&(f=[]),f.push(...ee)),J.tool_calls!=null)for(let te of J.tool_calls){let re=te.index;if(a[re]==null){if(te.type!=="function")throw new zo({data:te,message:"Expected 'function' type."});if(te.id==null)throw new zo({data:te,message:"Expected 'id' to be a string."});if(((m=te.function)==null?void 0:m.name)==null)throw new zo({data:te,message:"Expected 'function.name' to be a string."});a[re]={id:te.id,type:"function",function:{name:te.function.name,arguments:(h=te.function.arguments)!=null?h:""}};let W=a[re];if(W==null)throw new Error("Tool call is missing");((y=W.function)==null?void 0:y.name)!=null&&((g=W.function)==null?void 0:g.arguments)!=null&&ci(W.function.arguments)&&(d.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:W.id,toolName:W.function.name,argsTextDelta:W.function.arguments}),d.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(v=W.id)!=null?v:Yo(),toolName:W.function.name,args:W.function.arguments}));continue}let j=a[re];if(j==null)throw new Error("Tool call is missing");((b=te.function)==null?void 0:b.arguments)!=null&&(j.function.arguments+=(S=(w=te.function)==null?void 0:w.arguments)!=null?S:""),d.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:j.id,toolName:j.function.name,argsTextDelta:(T=te.function.arguments)!=null?T:""}),((U=j.function)==null?void 0:U.name)!=null&&((I=j.function)==null?void 0:I.arguments)!=null&&ci(j.function.arguments)&&d.enqueue({type:"tool-call",toolCallType:"function",toolCallId:(G=j.id)!=null?G:Yo(),toolName:j.function.name,args:j.function.arguments})}},flush(p){p.enqueue({type:"finish",finishReason:c,logprobs:f,usage:l})}})),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:r},warnings:[]}}},Vw=u.object({choices:u.array(u.object({message:u.object({role:u.literal("assistant"),content:u.string().nullable().optional(),tool_calls:u.array(u.object({id:u.string().optional().nullable(),type:u.literal("function"),function:u.object({name:u.string(),arguments:u.string()})})).optional()}),index:u.number(),logprobs:u.object({content:u.array(u.object({token:u.string(),logprob:u.number(),top_logprobs:u.array(u.object({token:u.string(),logprob:u.number()}))})).nullable()}).nullable().optional(),finish_reason:u.string().optional().nullable()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()})}),qw=u.union([u.object({choices:u.array(u.object({delta:u.object({role:u.enum(["assistant"]).optional(),content:u.string().nullish(),tool_calls:u.array(u.object({index:u.number(),id:u.string().nullish(),type:u.literal("function").optional(),function:u.object({name:u.string().nullish(),arguments:u.string().nullish()})})).nullish()}).nullish(),logprobs:u.object({content:u.array(u.object({token:u.string(),logprob:u.number(),top_logprobs:u.array(u.object({token:u.string(),logprob:u.number()}))})).nullable()}).nullish(),finish_reason:u.string().nullable().optional(),index:u.number()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()}).nullish()}),li]);function Jw(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0;if(r==null)return{tools:void 0,tool_choice:void 0};let n=r.map(i=>({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}})),o=e.toolChoice;if(o==null)return{tools:n,tool_choice:void 0};let s=o.type;switch(s){case"auto":case"none":case"required":return{tools:n,tool_choice:s};case"tool":return{tools:n,tool_choice:{type:"function",function:{name:o.toolName}}};default:{let i=s;throw new Error(`Unsupported tool choice type: ${i}`)}}}function zw({prompt:e,inputFormat:t,user:r="user",assistant:n="assistant"}){if(t==="prompt"&&e.length===1&&e[0]&&e[0].role==="user"&&e[0].content.length===1&&e[0].content[0]&&e[0].content[0].type==="text")return{prompt:e[0].content[0].text};let o="";e[0]&&e[0].role==="system"&&(o+=`${e[0].content}

`,e=e.slice(1));for(let{role:s,content:i}of e)switch(s){case"system":throw new Sd({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let a=i.map(c=>{switch(c.type){case"text":return c.text;case"image":throw new De({functionality:"images"})}}).join("");o+=`${r}:
${a}

`;break}case"assistant":{let a=i.map(c=>{switch(c.type){case"text":return c.text;case"tool-call":throw new De({functionality:"tool-call messages"})}}).join("");o+=`${n}:
${a}

`;break}case"tool":throw new De({functionality:"tool messages"});default:{let a=s;throw new Error(`Unsupported role: ${a}`)}}return o+=`${n}:
`,{prompt:o,stopSequences:[`
${r}:`]}}function Nd(e){return e?.tokens.map((t,r)=>{var n,o;return{token:t,logprob:(n=e.token_logprobs[r])!=null?n:0,topLogprobs:e.top_logprobs?Object.entries((o=e.top_logprobs[r])!=null?o:{}).map(([s,i])=>({token:s,logprob:i})):[]}})}var Ww=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:n,temperature:o,topP:s,frequencyPenalty:i,presencePenalty:a,seed:c}){var l;let f=e.type,{prompt:p,stopSequences:d}=zw({prompt:r,inputFormat:t}),m=ht({model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:typeof this.settings.logprobs=="number"?this.settings.logprobs:typeof this.settings.logprobs=="boolean"&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:n,temperature:o,top_p:s,frequency_penalty:i,presence_penalty:a,seed:c,prompt:p,stop:d},this.config.extraBody);switch(f){case"regular":{if((l=e.tools)!=null&&l.length)throw new De({functionality:"tools"});if(e.toolChoice)throw new De({functionality:"toolChoice"});return m}case"object-json":throw new De({functionality:"object-json mode"});case"object-tool":throw new De({functionality:"object-tool mode"});case"object-grammar":throw new De({functionality:"object-grammar mode"});default:{let h=f;throw new Error(`Unsupported type: ${h}`)}}}async doGenerate(e){let t=this.getArgs(e),{responseHeaders:r,value:n}=await Lr({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ur(this.config.headers(),e.headers),body:t,failedResponseHandler:os,successfulResponseHandler:Zo(Yw),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=t,{prompt:s}=o,i=rs(o,["prompt"]),a=n.choices[0];if(!a)throw new Error("No choice in OpenRouter completion response");return{text:a.text,usage:{promptTokens:n.usage.prompt_tokens,completionTokens:n.usage.completion_tokens},finishReason:ns(a.finish_reason),logprobs:Nd(a.logprobs),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:r},warnings:[]}}async doStream(e){let t=this.getArgs(e),{responseHeaders:r,value:n}=await Lr({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:Ur(this.config.headers(),e.headers),body:es(ht({},this.getArgs(e)),{stream:!0,stream_options:this.config.compatibility==="strict"?{include_usage:!0}:void 0}),failedResponseHandler:os,successfulResponseHandler:Xo(Qw),abortSignal:e.abortSignal,fetch:this.config.fetch}),o=t,{prompt:s}=o,i=rs(o,["prompt"]),a="other",c={promptTokens:Number.NaN,completionTokens:Number.NaN},l;return{stream:n.pipeThrough(new TransformStream({transform(f,p){if(!f.success){a="error",p.enqueue({type:"error",error:f.error});return}let d=f.value;if("error"in d){a="error",p.enqueue({type:"error",error:d.error});return}d.usage!=null&&(c={promptTokens:d.usage.prompt_tokens,completionTokens:d.usage.completion_tokens});let m=d.choices[0];m?.finish_reason!=null&&(a=ns(m.finish_reason)),m?.text!=null&&p.enqueue({type:"text-delta",textDelta:m.text});let h=Nd(m?.logprobs);h?.length&&(l===void 0&&(l=[]),l.push(...h))},flush(f){f.enqueue({type:"finish",finishReason:a,logprobs:l,usage:c})}})),rawCall:{rawPrompt:s,rawSettings:i},rawResponse:{headers:r},warnings:[]}}},Yw=u.object({choices:u.array(u.object({text:u.string(),finish_reason:u.string(),logprobs:u.object({tokens:u.array(u.string()),token_logprobs:u.array(u.number()),top_logprobs:u.array(u.record(u.string(),u.number())).nullable()}).nullable().optional()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()})}),Qw=u.union([u.object({choices:u.array(u.object({text:u.string(),finish_reason:u.string().nullish(),index:u.number(),logprobs:u.object({tokens:u.array(u.string()),token_logprobs:u.array(u.number()),top_logprobs:u.array(u.record(u.string(),u.number())).nullable()}).nullable().optional()})),usage:u.object({prompt_tokens:u.number(),completion_tokens:u.number()}).optional().nullable()}),li]);function ui(e={}){var t,r,n;let o=(r=Rd((t=e.baseURL)!=null?t:e.baseUrl))!=null?r:"https://openrouter.ai/api/v1",s=(n=e.compatibility)!=null?n:"compatible",i=()=>ht({Authorization:`Bearer ${kd({apiKey:e.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},e.headers),a=(p,d={})=>new Gw(p,d,{provider:"openrouter.chat",url:({path:m})=>`${o}${m}`,headers:i,compatibility:s,fetch:e.fetch,extraBody:e.extraBody}),c=(p,d={})=>new Ww(p,d,{provider:"openrouter.completion",url:({path:m})=>`${o}${m}`,headers:i,compatibility:s,fetch:e.fetch,extraBody:e.extraBody}),l=(p,d)=>{if(new.target)throw new Error("The OpenRouter model function cannot be called with the new keyword.");return p==="openai/gpt-3.5-turbo-instruct"?c(p,d):a(p,d)},f=function(p,d){return l(p,d)};return f.languageModel=l,f.chat=a,f.completion=c,f}var TR=ui({compatibility:"strict"});var Vn=class extends M{name="OpenRouter";getApiKeyLink="https://openrouter.ai/settings/keys";config={apiTokenKey:"OPEN_ROUTER_API_KEY"};staticModels=[{name:"anthropic/claude-3.5-sonnet",label:"Claude 3.5 Sonnet",provider:"OpenRouter",maxTokenAllowed:2e5},{name:"openai/gpt-4o",label:"GPT-4o",provider:"OpenRouter",maxTokenAllowed:128e3}];async getDynamicModels(t,r,n={}){try{return(await(await fetch("https://openrouter.ai/api/v1/models",{headers:{"Content-Type":"application/json"}})).json()).data.sort((i,a)=>i.name.localeCompare(a.name)).map(i=>{let a=i.context_length||32e3,l=Math.min(a,1e6);return{name:i.id,label:`${i.name} - in:$${(i.pricing.prompt*1e6).toFixed(2)} out:$${(i.pricing.completion*1e6).toFixed(2)} - context ${l>=1e6?Math.floor(l/1e6)+"M":Math.floor(l/1e3)+"k"}`,provider:this.name,maxTokenAllowed:l}})}catch(o){return console.error("Error getting OpenRouter models:",o),[]}}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"OPEN_ROUTER_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return ui({apiKey:i}).chat(r)}};var qn=class extends M{name="OpenAILike";getApiKeyLink=void 0;config={baseUrlKey:"OPENAI_LIKE_API_BASE_URL",apiTokenKey:"OPENAI_LIKE_API_KEY",modelsKey:"OPENAI_LIKE_API_MODELS"};staticModels=[];async getDynamicModels(t,r,n={}){let{baseUrl:o,apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"OPENAI_LIKE_API_BASE_URL",defaultApiTokenKey:"OPENAI_LIKE_API_KEY"});if(!o||!s)return[];try{let i=await fetch(`${o}/models`,{headers:{Authorization:`Bearer ${s}`}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return(await i.json()).data.map(c=>({name:c.id,label:c.id,provider:this.name,maxTokenAllowed:8e3}))}catch(i){console.log(`${this.name}: Not allowed to GET /models endpoint for provider`,i);let a=n.OPENAI_LIKE_API_MODELS||r?.OPENAI_LIKE_API_MODELS;return a?(console.log(`${this.name}: OPENAI_LIKE_API_MODELS=${a}`),this._parseModelsFromEnv(a)):[]}}_parseModelsFromEnv(t){if(!t)return[];try{let r=[],n=t.split(";");for(let o of n){let s=o.trim();if(!s)continue;let[i,a]=s.split(":");if(!i)continue;let c=a?parseInt(a.trim(),10):8e3,l=i.trim(),f=this._generateModelLabel(l);r.push({name:l,label:f,provider:this.name,maxTokenAllowed:c})}return console.log(`${this.name}: Parsed Models:`,r),r}catch(r){return console.error(`${this.name}: Error parsing OPENAI_LIKE_API_MODELS:`,r),[]}}_generateModelLabel(t){let r=t.split("/"),o=r[r.length-1].replace(/^accounts\//,"").replace(/^fireworks\/models\//,"").replace(/^models\//,"").replace(/\b\w/g,s=>s.toUpperCase()).replace(/\s+/g,"-");return!o.includes("Fireworks")&&!o.includes("OpenAI")&&(o+=" (OpenAI Compatible)"),o}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{baseUrl:i,apiKey:a}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"OPENAI_LIKE_API_BASE_URL",defaultApiTokenKey:"OPENAI_LIKE_API_KEY"});if(!i||!a)throw new Error(`Missing configuration for ${this.name} provider`);return Uo(i,a,r)}};var Jn=class extends M{name="OpenAI";getApiKeyLink="https://platform.openai.com/api-keys";config={apiTokenKey:"OPENAI_API_KEY"};staticModels=[{name:"gpt-4o",label:"GPT-4o",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:4096},{name:"gpt-4o-mini",label:"GPT-4o Mini",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:4096},{name:"gpt-3.5-turbo",label:"GPT-3.5 Turbo",provider:"OpenAI",maxTokenAllowed:16e3,maxCompletionTokens:4096},{name:"o1-preview",label:"o1-preview",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:32e3},{name:"o1-mini",label:"o1-mini",provider:"OpenAI",maxTokenAllowed:128e3,maxCompletionTokens:65e3}];async getDynamicModels(t,r,n){let{apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"OPENAI_API_KEY"});if(!o)throw`Missing Api Key configuration for ${this.name} provider`;let i=await(await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${o}`}})).json(),a=this.staticModels.map(l=>l.name);return i.data.filter(l=>l.object==="model"&&(l.id.startsWith("gpt-")||l.id.startsWith("o")||l.id.startsWith("chatgpt-"))&&!a.includes(l.id)).map(l=>{let f=32e3;l.context_length?f=l.context_length:l.id?.includes("gpt-4o")||l.id?.includes("gpt-4-turbo")||l.id?.includes("gpt-4-1106")?f=128e3:l.id?.includes("gpt-4")?f=8192:l.id?.includes("gpt-3.5-turbo")&&(f=16385);let p=4096;return l.id?.startsWith("o1-preview")?p=32e3:l.id?.startsWith("o1-mini")?p=65e3:l.id?.startsWith("o1")?p=32e3:l.id?.includes("o3")||l.id?.includes("o4")?p=1e5:l.id?.includes("gpt-4o")?p=4096:l.id?.includes("gpt-4")?p=8192:l.id?.includes("gpt-3.5-turbo")&&(p=4096),{name:l.id,label:`${l.id} (${Math.floor(f/1e3)}k context)`,provider:this.name,maxTokenAllowed:Math.min(f,128e3),maxCompletionTokens:p}})}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"OPENAI_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return X({apiKey:i})(r)}};var zn=class extends M{name="Perplexity";getApiKeyLink="https://www.perplexity.ai/settings/api";config={apiTokenKey:"PERPLEXITY_API_KEY"};staticModels=[{name:"sonar",label:"Sonar",provider:"Perplexity",maxTokenAllowed:8192},{name:"sonar-pro",label:"Sonar Pro",provider:"Perplexity",maxTokenAllowed:8192},{name:"sonar-reasoning-pro",label:"Sonar Reasoning Pro",provider:"Perplexity",maxTokenAllowed:8192}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"PERPLEXITY_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return X({baseURL:"https://api.perplexity.ai/",apiKey:i})(r)}};var Wn=class extends M{name="Together";getApiKeyLink="https://api.together.xyz/settings/api-keys";config={baseUrlKey:"TOGETHER_API_BASE_URL",apiTokenKey:"TOGETHER_API_KEY"};staticModels=[{name:"meta-llama/Llama-3.2-90B-Vision-Instruct-Turbo",label:"Llama 3.2 90B Vision",provider:"Together",maxTokenAllowed:128e3,maxCompletionTokens:8192},{name:"mistralai/Mixtral-8x7B-Instruct-v0.1",label:"Mixtral 8x7B Instruct",provider:"Together",maxTokenAllowed:32e3,maxCompletionTokens:8192}];async getDynamicModels(t,r,n={}){let{baseUrl:o,apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"TOGETHER_API_BASE_URL",defaultApiTokenKey:"TOGETHER_API_KEY"}),i=o||"https://api.together.xyz/v1";return!i||!s?[]:(await(await fetch(`${i}/models`,{headers:{Authorization:`Bearer ${s}`}})).json()||[]).filter(f=>f.type==="chat").map(f=>({name:f.id,label:`${f.display_name} - in:$${f.pricing.input.toFixed(2)} out:$${f.pricing.output.toFixed(2)} - context ${Math.floor(f.context_length/1e3)}k`,provider:this.name,maxTokenAllowed:8e3,maxCompletionTokens:8192}))}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{baseUrl:i,apiKey:a}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"TOGETHER_API_BASE_URL",defaultApiTokenKey:"TOGETHER_API_KEY"});if(!i||!a)throw new Error(`Missing configuration for ${this.name} provider`);return Uo(i,a,r)}};var Yn=class extends M{name="xAI";getApiKeyLink="https://docs.x.ai/docs/quickstart#creating-an-api-key";config={apiTokenKey:"XAI_API_KEY"};staticModels=[{name:"grok-4",label:"xAI Grok 4",provider:"xAI",maxTokenAllowed:256e3},{name:"grok-4-07-09",label:"xAI Grok 4 (07-09)",provider:"xAI",maxTokenAllowed:256e3},{name:"grok-3-mini",label:"xAI Grok 3 Mini",provider:"xAI",maxTokenAllowed:131e3},{name:"grok-3-mini-fast",label:"xAI Grok 3 Mini Fast",provider:"xAI",maxTokenAllowed:131e3},{name:"grok-code-fast-1",label:"xAI Grok Code Fast 1",provider:"xAI",maxTokenAllowed:131e3}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"XAI_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return X({baseURL:"https://api.x.ai/v1",apiKey:i})(r)}};var Qn=class extends M{name="Hyperbolic";getApiKeyLink="https://app.hyperbolic.xyz/settings";config={apiTokenKey:"HYPERBOLIC_API_KEY"};staticModels=[{name:"Qwen/Qwen2.5-Coder-32B-Instruct",label:"Qwen 2.5 Coder 32B Instruct",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"Qwen/Qwen2.5-72B-Instruct",label:"Qwen2.5-72B-Instruct",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"deepseek-ai/DeepSeek-V2.5",label:"DeepSeek-V2.5",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"Qwen/QwQ-32B-Preview",label:"QwQ-32B-Preview",provider:"Hyperbolic",maxTokenAllowed:8192},{name:"Qwen/Qwen2-VL-72B-Instruct",label:"Qwen2-VL-72B-Instruct",provider:"Hyperbolic",maxTokenAllowed:8192}];async getDynamicModels(t,r,n={}){let{baseUrl:o,apiKey:s}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"HYPERBOLIC_API_KEY"}),i=o||"https://api.hyperbolic.xyz/v1";if(!s)throw`Missing Api Key configuration for ${this.name} provider`;return(await(await fetch(`${i}/models`,{headers:{Authorization:`Bearer ${s}`}})).json()).data.filter(f=>f.object==="model"&&f.supports_chat).map(f=>({name:f.id,label:`${f.id} - context ${f.context_length?Math.floor(f.context_length/1e3)+"k":"N/A"}`,provider:this.name,maxTokenAllowed:f.context_length||8e3}))}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"HYPERBOLIC_API_KEY"});if(!i)throw`Missing Api Key configuration for ${this.name} provider`;return X({baseURL:"https://api.hyperbolic.xyz/v1/",apiKey:i})(r)}};var Bd="vercel.ai.error",Xw=Symbol.for(Bd),$d,Zw=class Ud extends Error{constructor({name:t,message:r,cause:n}){super(r),this[$d]=!0,this.name=t,this.cause=n}static isInstance(t){return Ud.hasMarker(t,Bd)}static hasMarker(t,r){let n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};$d=Xw;var Fr=Zw,e_="AI_APICallError",t_=`vercel.ai.error.${e_}`,r_=Symbol.for(t_),n_;n_=r_;var o_="AI_EmptyResponseBodyError",s_=`vercel.ai.error.${o_}`,a_=Symbol.for(s_),i_;i_=a_;var Ld="AI_InvalidArgumentError",Fd=`vercel.ai.error.${Ld}`,c_=Symbol.for(Fd),Hd,jd=class extends Fr{constructor({message:e,cause:t,argument:r}){super({name:Ld,message:e,cause:t}),this[Hd]=!0,this.argument=r}static isInstance(e){return Fr.hasMarker(e,Fd)}};Hd=c_;var l_="AI_InvalidPromptError",u_=`vercel.ai.error.${l_}`,d_=Symbol.for(u_),p_;p_=d_;var f_="AI_InvalidResponseDataError",m_=`vercel.ai.error.${f_}`,h_=Symbol.for(m_),g_;g_=h_;var y_="AI_JSONParseError",v_=`vercel.ai.error.${y_}`,b_=Symbol.for(v_),x_;x_=b_;var w_="AI_LoadAPIKeyError",__=`vercel.ai.error.${w_}`,E_=Symbol.for(__),S_;S_=E_;var Kd="AI_LoadSettingError",Gd=`vercel.ai.error.${Kd}`,A_=Symbol.for(Gd),Vd,Xn=class extends Fr{constructor({message:e}){super({name:Kd,message:e}),this[Vd]=!0}static isInstance(e){return Fr.hasMarker(e,Gd)}};Vd=A_;var k_="AI_NoContentGeneratedError",T_=`vercel.ai.error.${k_}`,I_=Symbol.for(T_),C_;C_=I_;var R_="AI_NoSuchModelError",O_=`vercel.ai.error.${R_}`,P_=Symbol.for(O_),N_;N_=P_;var M_="AI_TooManyEmbeddingValuesForCallError",D_=`vercel.ai.error.${M_}`,B_=Symbol.for(D_),$_;$_=B_;var U_="AI_TypeValidationError",L_=`vercel.ai.error.${U_}`,F_=Symbol.for(L_),H_;H_=F_;var qd="AI_UnsupportedFunctionalityError",Jd=`vercel.ai.error.${qd}`,j_=Symbol.for(Jd),zd,Rt=class extends Fr{constructor({functionality:e}){super({name:qd,message:`'${e}' functionality not supported.`}),this[zd]=!0,this.functionality=e}static isInstance(e){return Fr.hasMarker(e,Jd)}};zd=j_;var K_=ct(Ht(),1);var di=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{let o=hr(r,t);if(e==null)return o;if(r.includes(n))throw new jd({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return s=>`${e}${n}${o(s)}`},Wd=di();function Yd({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=process.env[t],!(e==null||typeof e!="string")))return e}function ss({settingValue:e,environmentVariableName:t,settingName:r,description:n}){if(typeof e=="string")return e;if(e!=null)throw new Xn({message:`${n} setting must be a string.`});if(typeof process>"u")throw new Xn({message:`${n} setting is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=process.env[t],e==null)throw new Xn({message:`${n} setting is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new Xn({message:`${n} setting must be a string. The value of the ${t} environment variable is not a string.`});return e}var nO=Symbol.for("vercel.ai.validator");var{btoa:oO,atob:sO}=globalThis;function Qd(e){let t=e.signer,r=e.signer,n=Object.assign(e,{eventSigner:t,messageSigner:r}),o=n.eventStreamPayloadHandlerProvider(n);return Object.assign(n,{eventStreamPayloadHandler:o})}var Xd=e=>({setHttpHandler(t){e.httpHandler=t},httpHandler(){return e.httpHandler},updateHttpClientConfig(t,r){e.httpHandler?.updateHttpClientConfig(t,r)},httpHandlerConfigs(){return e.httpHandler.httpHandlerConfigs()}}),Zd=e=>({httpHandler:e.httpHandler()});var ep;(function(e){e.HEADER="header",e.QUERY="query"})(ep||(ep={}));var tp;(function(e){e.HEADER="header",e.QUERY="query"})(tp||(tp={}));var Hr;(function(e){e.HTTP="http",e.HTTPS="https"})(Hr||(Hr={}));var jr;(function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"})(jr||(jr={}));var pi;(function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"})(pi||(pi={}));var Zn="__smithy_context";var rp;(function(e){e.PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services"})(rp||(rp={}));var np;(function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"})(np||(np={}));var L=class{constructor(t){this.method=t.method||"GET",this.hostname=t.hostname||"localhost",this.port=t.port,this.query=t.query||{},this.headers=t.headers||{},this.body=t.body,this.protocol=t.protocol?t.protocol.slice(-1)!==":"?`${t.protocol}:`:t.protocol:"https:",this.path=t.path?t.path.charAt(0)!=="/"?`/${t.path}`:t.path:"/",this.username=t.username,this.password=t.password,this.fragment=t.fragment}static clone(t){let r=new L({...t,headers:{...t.headers}});return r.query&&(r.query=G_(r.query)),r}static isInstance(t){if(!t)return!1;let r=t;return"method"in r&&"protocol"in r&&"hostname"in r&&"path"in r&&typeof r.query=="object"&&typeof r.headers=="object"}clone(){return L.clone(this)}};function G_(e){return Object.keys(e).reduce((t,r)=>{let n=e[r];return{...t,[r]:Array.isArray(n)?[...n]:n}},{})}var we=class{constructor(t){this.statusCode=t.statusCode,this.reason=t.reason,this.headers=t.headers||{},this.body=t.body}static isInstance(t){if(!t)return!1;let r=t;return typeof r.statusCode=="number"&&typeof r.headers=="object"}};var V_=e=>t=>async r=>{if(!L.isInstance(r.request))return t(r);let{request:n}=r,{handlerProtocol:o=""}=e.requestHandler.metadata||{};if(o.indexOf("h2")>=0&&!n.headers[":authority"])delete n.headers.host,n.headers[":authority"]=n.hostname+(n.port?":"+n.port:"");else if(!n.headers.host){let s=n.hostname;n.port!=null&&(s+=`:${n.port}`),n.headers.host=s}return t(r)},q_={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},op=e=>({applyToStack:t=>{t.add(V_(e),q_)}});var J_=()=>(e,t)=>async r=>{try{let n=await e(r),{clientName:o,commandName:s,logger:i,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:l}=a,f=c??t.inputFilterSensitiveLog,p=l??t.outputFilterSensitiveLog,{$metadata:d,...m}=n.output;return i?.info?.({clientName:o,commandName:s,input:f(r.input),output:p(m),metadata:d}),n}catch(n){let{clientName:o,commandName:s,logger:i,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:c}=a,l=c??t.inputFilterSensitiveLog;throw i?.error?.({clientName:o,commandName:s,input:l(r.input),error:n,metadata:n.$metadata}),n}},z_={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},sp=e=>({applyToStack:t=>{t.add(J_(),z_)}});var fi="X-Amzn-Trace-Id",W_="AWS_LAMBDA_FUNCTION_NAME",Y_="_X_AMZN_TRACE_ID",Q_=e=>t=>async r=>{let{request:n}=r;if(!L.isInstance(n)||e.runtime!=="node")return t(r);let o=Object.keys(n.headers??{}).find(c=>c.toLowerCase()===fi.toLowerCase())??fi;if(n.headers.hasOwnProperty(o))return t(r);let s=process.env[W_],i=process.env[Y_],a=c=>typeof c=="string"&&c.length>0;return a(s)&&a(i)&&(n.headers[fi]=i),t({...r,request:n})},X_={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},ap=e=>({applyToStack:t=>{t.add(Q_(e),X_)}});var Ot=e=>e[Zn]||(e[Zn]={});var ge=e=>{if(typeof e=="function")return e;let t=Promise.resolve(e);return()=>t};var ip=(e,t)=>{if(!t||t.length===0)return e;let r=[];for(let n of t)for(let o of e)o.schemeId.split("#")[1]===n&&r.push(o);for(let n of e)r.find(({schemeId:o})=>o===n.schemeId)||r.push(n);return r};function Z_(e){let t=new Map;for(let r of e)t.set(r.schemeId,r);return t}var cp=(e,t)=>(r,n)=>async o=>{let s=e.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(e,n,o.input)),i=e.authSchemePreference?await e.authSchemePreference():[],a=ip(s,i),c=Z_(e.httpAuthSchemes),l=Ot(n),f=[];for(let p of a){let d=c.get(p.schemeId);if(!d){f.push(`HttpAuthScheme \`${p.schemeId}\` was not enabled for this service.`);continue}let m=d.identityProvider(await t.identityProviderConfigProvider(e));if(!m){f.push(`HttpAuthScheme \`${p.schemeId}\` did not have an IdentityProvider configured.`);continue}let{identityProperties:h={},signingProperties:y={}}=p.propertiesExtractor?.(e,n)||{};p.identityProperties=Object.assign(p.identityProperties||{},h),p.signingProperties=Object.assign(p.signingProperties||{},y),l.selectedHttpAuthScheme={httpAuthOption:p,identity:await m(p.identityProperties),signer:d.signer};break}if(!l.selectedHttpAuthScheme)throw new Error(f.join(`
`));return r(o)};var eE={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},lp=(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:r})=>({applyToStack:n=>{n.addRelativeTo(cp(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:r}),eE)}});var up=(e,t)=>(r,n)=>async o=>{let{response:s}=await r(o);try{let i=await t(s,e);return{response:s,output:i}}catch(i){if(Object.defineProperty(i,"$response",{value:s}),!("$metadata"in i)){let a="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{i.message+=`
  `+a}catch{!n.logger||n.logger?.constructor?.name==="NoOpLogger"?console.warn(a):n.logger?.warn?.(a)}typeof i.$responseBodyText<"u"&&i.$response&&(i.$response.body=i.$responseBodyText);try{if(we.isInstance(s)){let{headers:c={}}=s,l=Object.entries(c);i.$metadata={httpStatusCode:s.statusCode,requestId:mi(/^x-[\w-]+-request-?id$/,l),extendedRequestId:mi(/^x-[\w-]+-id-2$/,l),cfId:mi(/^x-[\w-]+-cf-id$/,l)}}}catch{}}throw i}},mi=(e,t)=>(t.find(([r])=>r.match(e))||[void 0,void 0])[1];var dp=(e,t)=>(r,n)=>async o=>{let s=e,i=n.endpointV2?.url&&s.urlParser?async()=>s.urlParser(n.endpointV2.url):s.endpoint;if(!i)throw new Error("No valid endpoint provider available.");let a=await t(o.input,{...e,endpoint:i});return r({...o,request:a})};var tE={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},hi={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function Kr(e,t,r){return{applyToStack:n=>{n.add(up(e,r),tE),n.add(dp(e,t),hi)}}}var rE=e=>t=>{throw t},nE=(e,t)=>{},pp=e=>(t,r)=>async n=>{if(!L.isInstance(n.request))return t(n);let s=Ot(r).selectedHttpAuthScheme;if(!s)throw new Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties:i={}},identity:a,signer:c}=s,l=await t({...n,request:await c.sign(n.request,a,i)}).catch((c.errorHandler||rE)(i));return(c.successHandler||nE)(l.response,i),l};var oE={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},fp=e=>({applyToStack:t=>{t.addRelativeTo(pp(e),oE)}});var sr=e=>{if(typeof e=="function")return e;let t=Promise.resolve(e);return()=>t};var gt={},ar=new Array(64);for(let e=0,t="A".charCodeAt(0),r="Z".charCodeAt(0);e+t<=r;e++){let n=String.fromCharCode(e+t);gt[n]=e,ar[e]=n}for(let e=0,t="a".charCodeAt(0),r="z".charCodeAt(0);e+t<=r;e++){let n=String.fromCharCode(e+t),o=e+26;gt[n]=o,ar[o]=n}for(let e=0;e<10;e++){gt[e.toString(10)]=e+52;let t=e.toString(10),r=e+52;gt[t]=r,ar[r]=t}gt["+"]=62;ar[62]="+";gt["/"]=63;ar[63]="/";var Pt=6,ir=8,mp=63;var Gr=e=>{let t=e.length/4*3;e.slice(-2)==="=="?t-=2:e.slice(-1)==="="&&t--;let r=new ArrayBuffer(t),n=new DataView(r);for(let o=0;o<e.length;o+=4){let s=0,i=0;for(let l=o,f=o+3;l<=f;l++)if(e[l]!=="="){if(!(e[l]in gt))throw new TypeError(`Invalid character ${e[l]} in base64 string.`);s|=gt[e[l]]<<(f-l)*Pt,i+=Pt}else s>>=Pt;let a=o/4*3;s>>=i%ir;let c=Math.floor(i/ir);for(let l=0;l<c;l++){let f=(c-l-1)*ir;n.setUint8(a+l,(s&255<<f)>>f)}}return new Uint8Array(r)};var Ge=e=>new TextEncoder().encode(e);var yt=e=>typeof e=="string"?Ge(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e);var eo=e=>{if(typeof e=="string")return e;if(typeof e!="object"||typeof e.byteOffset!="number"||typeof e.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};function Vr(e){let t;typeof e=="string"?t=Ge(e):t=e;let r=typeof t=="object"&&typeof t.length=="number",n=typeof t=="object"&&typeof t.byteOffset=="number"&&typeof t.byteLength=="number";if(!r&&!n)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let o="";for(let s=0;s<t.length;s+=3){let i=0,a=0;for(let l=s,f=Math.min(s+3,t.length);l<f;l++)i|=t[l]<<(f-l-1)*ir,a+=ir;let c=Math.ceil(a/Pt);i<<=c*Pt-a;for(let l=1;l<=c;l++){let f=(c-l)*Pt;o+=ar[(i&mp<<f)>>f]}o+="==".slice(0,4-c)}return o}function hp(e,t="utf-8"){return t==="base64"?Vr(e):eo(e)}function gp(e,t){return t==="base64"?Ve.mutate(Gr(e)):Ve.mutate(Ge(e))}var Ve=class extends Uint8Array{static fromString(t,r="utf-8"){switch(typeof t){case"string":return gp(t,r);default:throw new Error(`Unsupported conversion from ${typeof t} to Uint8ArrayBlobAdapter.`)}}static mutate(t){return Object.setPrototypeOf(t,Ve.prototype),t}transformToString(t="utf-8"){return hp(this,t)}};var qe=e=>encodeURIComponent(e).replace(/[!'()*]/g,aE),aE=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`;function as(e){let t=[];for(let r of Object.keys(e).sort()){let n=e[r];if(r=qe(r),Array.isArray(n))for(let o=0,s=n.length;o<s;o++)t.push(`${r}=${qe(n[o])}`);else{let o=r;(n||typeof n=="string")&&(o+=`=${qe(n)}`),t.push(o)}}return t.join("&")}function gi(e,t){return new Request(e,t)}function yp(e=0){return new Promise((t,r)=>{e&&setTimeout(()=>{let n=new Error(`Request did not complete within ${e} ms`);n.name="TimeoutError",r(n)},e)})}var yi={supported:void 0},vt=class{static create(t){return typeof t?.handle=="function"?t:new vt(t)}constructor(t){typeof t=="function"?this.configProvider=t().then(r=>r||{}):(this.config=t??{},this.configProvider=Promise.resolve(this.config)),yi.supported===void 0&&(yi.supported=Boolean(typeof Request<"u"&&"keepalive"in gi("https://[::1]")))}destroy(){}async handle(t,{abortSignal:r,requestTimeout:n}={}){this.config||(this.config=await this.configProvider);let o=n??this.config.requestTimeout,s=this.config.keepAlive===!0,i=this.config.credentials;if(r?.aborted){let b=new Error("Request aborted");return b.name="AbortError",Promise.reject(b)}let a=t.path,c=as(t.query||{});c&&(a+=`?${c}`),t.fragment&&(a+=`#${t.fragment}`);let l="";if(t.username!=null||t.password!=null){let b=t.username??"",w=t.password??"";l=`${b}:${w}@`}let{port:f,method:p}=t,d=`${t.protocol}//${l}${t.hostname}${f?`:${f}`:""}${a}`,m=p==="GET"||p==="HEAD"?void 0:t.body,h={body:m,headers:new Headers(t.headers),method:p,credentials:i};this.config?.cache&&(h.cache=this.config.cache),m&&(h.duplex="half"),typeof AbortController<"u"&&(h.signal=r),yi.supported&&(h.keepalive=s),typeof this.config.requestInit=="function"&&Object.assign(h,this.config.requestInit(t));let y=()=>{},g=gi(d,h),v=[fetch(g).then(b=>{let w=b.headers,S={};for(let U of w.entries())S[U[0]]=U[1];return b.body!=null?{response:new we({headers:S,reason:b.statusText,statusCode:b.status,body:b.body})}:b.blob().then(U=>({response:new we({headers:S,reason:b.statusText,statusCode:b.status,body:U})}))}),yp(o)];return r&&v.push(new Promise((b,w)=>{let S=()=>{let T=new Error("Request aborted");T.name="AbortError",w(T)};if(typeof r.addEventListener=="function"){let T=r;T.addEventListener("abort",S,{once:!0}),y=()=>T.removeEventListener("abort",S)}else r.onabort=S})),Promise.race(v).finally(y)}updateHttpClientConfig(t,r){this.config=void 0,this.configProvider=this.configProvider.then(n=>(n[t]=r,n))}httpHandlerConfigs(){return this.config??{}}};var vi=async e=>typeof Blob=="function"&&e instanceof Blob||e.constructor?.name==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await e.arrayBuffer()):iE(e):cE(e);async function iE(e){let t=await lE(e),r=Gr(t);return new Uint8Array(r)}async function cE(e){let t=[],r=e.getReader(),n=!1,o=0;for(;!n;){let{done:a,value:c}=await r.read();c&&(t.push(c),o+=c.length),n=a}let s=new Uint8Array(o),i=0;for(let a of t)s.set(a,i),i+=a.length;return s}function lE(e){return new Promise((t,r)=>{let n=new FileReader;n.onloadend=()=>{if(n.readyState!==2)return r(new Error("Reader aborted too early"));let o=n.result??"",s=o.indexOf(","),i=s>-1?s+1:o.length;t(o.substring(i))},n.onabort=()=>r(new Error("Read aborted")),n.onerror=()=>r(n.error),n.readAsDataURL(e)})}var vp={},bi={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),vp[e]=t,bi[t]=e}function qr(e){if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2){let n=e.slice(r,r+2).toLowerCase();if(n in bi)t[r/2]=bi[n];else throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`)}return t}function Z(e){let t="";for(let r=0;r<e.byteLength;r++)t+=vp[e[r]];return t}var to=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return Ve.mutate(e);if(!e)return Ve.mutate(new Uint8Array);let r=t.streamCollector(e);return Ve.mutate(await r)};function xi(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}var bp=e=>{if(e!=null){if(typeof e=="number"){if((e===0||e===1)&&cs.warn(is(`Expected boolean, got ${typeof e}: ${e}`)),e===0)return!1;if(e===1)return!0}if(typeof e=="string"){let t=e.toLowerCase();if((t==="false"||t==="true")&&cs.warn(is(`Expected boolean, got ${typeof e}: ${e}`)),t==="false")return!1;if(t==="true")return!0}if(typeof e=="boolean")return e;throw new TypeError(`Expected boolean, got ${typeof e}: ${e}`)}},uE=e=>{if(e!=null){if(typeof e=="string"){let t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&cs.warn(is(`Expected number but observed string: ${e}`)),t}if(typeof e=="number")return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}},v1=Math.ceil(34028234663852886e22);var dE=e=>{if(e!=null){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}};var ls=e=>pE(e,32);var pE=(e,t)=>{let r=dE(e);if(r!==void 0&&fE(r,t)!==r)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return r},fE=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},xp=(e,t)=>{if(e==null)throw t?new TypeError(`Expected a non-null value for ${t}`):new TypeError("Expected a non-null value");return e},wi=e=>{if(e==null)return;if(typeof e=="object"&&!Array.isArray(e))return e;let t=Array.isArray(e)?"array":typeof e;throw new TypeError(`Expected object, got ${t}: ${e}`)},P=e=>{if(e!=null){if(typeof e=="string")return e;if(["boolean","number","bigint"].includes(typeof e))return cs.warn(is(`Expected string, got ${typeof e}: ${e}`)),String(e);throw new TypeError(`Expected string, got ${typeof e}: ${e}`)}},wp=e=>{if(e==null)return;let t=wi(e),r=Object.entries(t).filter(([,n])=>n!=null).map(([n])=>n);if(r.length===0)throw new TypeError("Unions must have exactly one non-null member. None were found.");if(r.length>1)throw new TypeError(`Unions must have exactly one non-null member. Keys ${r} were not null.`);return t};var _i=e=>typeof e=="string"?mE(e):uE(e);var mE=e=>{switch(e){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${e}`)}};var is=e=>String(new TypeError(e).stack||e).split(`
`).slice(0,5).filter(t=>!t.includes("stackTraceWarning")).join(`
`),cs={warn:console.warn};var _p=(e,t,r,n,o,s)=>{if(t!=null&&t[r]!==void 0){let i=n();if(i.length<=0)throw new Error("Empty value provided for input HTTP label: "+r+".");e=e.replace(o,s?i.split("/").map(a=>xi(a)).join("/"):xi(i))}else throw new Error("No value provided for input HTTP label: "+r+".");return e};function ro(e,t){return new Ei(e,t)}var Ei=class{constructor(t,r){this.input=t,this.context=r,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){let{hostname:t,protocol:r="https",port:n,path:o}=await this.context.endpoint();this.path=o;for(let s of this.resolvePathStack)s(this.path);return new L({protocol:r,hostname:this.hostname||t,port:n,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(t){return this.hostname=t,this}bp(t){return this.resolvePathStack.push(r=>{this.path=`${r?.endsWith("/")?r.slice(0,-1):r||""}`+t}),this}p(t,r,n,o){return this.resolvePathStack.push(s=>{this.path=_p(s,this.input,t,r,n,o)}),this}h(t){return this.headers=t,this}q(t){return this.query=t,this}b(t){return this.body=t,this}m(t){return this.method=t,this}};function Ep(e,t,r){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=r}var us=class{constructor(t){this.authSchemes=new Map;for(let[r,n]of Object.entries(t))n!==void 0&&this.authSchemes.set(r,n)}getIdentityProvider(t){return this.authSchemes.get(t)}};var ds=class{async sign(t,r,n){let o=L.clone(t);if(!r.token)throw new Error("request could not be signed with `token` since the `token` is not defined");return o.headers.Authorization=`Bearer ${r.token}`,o}};var hE=e=>t=>no(t)&&t.expiration.getTime()-Date.now()<e;var ps=hE(3e5),no=e=>e.expiration!==void 0,fs=(e,t,r)=>{if(e===void 0)return;let n=typeof e!="function"?async()=>Promise.resolve(e):e,o,s,i,a=!1,c=async l=>{s||(s=n(l));try{o=await s,i=!0,a=!1}finally{s=void 0}return o};return t===void 0?async l=>((!i||l?.forceRefresh)&&(o=await c(l)),o):async l=>((!i||l?.forceRefresh)&&(o=await c(l)),a?o:r(o)?(t(o)&&await c(l),o):(a=!0,o))};var gE=void 0;function yE(e){return e===void 0?!0:typeof e=="string"&&e.length<=50}function Sp(e){let t=sr(e.userAgentAppId??gE),{customUserAgent:r}=e;return Object.assign(e,{customUserAgent:typeof r=="string"?[[r]]:r,userAgentAppId:async()=>{let n=await t();if(!yE(n)){let o=e.logger?.constructor?.name==="NoOpLogger"||!e.logger?console:e.logger;typeof n!="string"?o?.warn("userAgentAppId must be a string or undefined."):n.length>50&&o?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return n}})}var ms=class{constructor({size:t,params:r}){this.data=new Map,this.parameters=[],this.capacity=t??50,r&&(this.parameters=r)}get(t,r){let n=this.hash(t);if(n===!1)return r();if(!this.data.has(n)){if(this.data.size>this.capacity+10){let o=this.data.keys(),s=0;for(;;){let{value:i,done:a}=o.next();if(this.data.delete(i),a||++s>10)break}}this.data.set(n,r())}return this.data.get(n)}size(){return this.data.size}hash(t){let r="",{parameters:n}=this;if(n.length===0)return!1;for(let o of n){let s=String(t[o]??"");if(s.includes("|;"))return!1;r+=s+"|;"}return r}};var vE=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),oo=e=>vE.test(e)||e.startsWith("[")&&e.endsWith("]");var bE=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),so=(e,t=!1)=>{if(!t)return bE.test(e);let r=e.split(".");for(let n of r)if(!so(n))return!1;return!0};var cr={};var bt="endpoints";function Be(e){return typeof e!="object"||e==null?e:"ref"in e?`$${Be(e.ref)}`:"fn"in e?`${e.fn}(${(e.argv||[]).map(Be).join(", ")})`:JSON.stringify(e,null,2)}var K=class extends Error{constructor(t){super(t),this.name="EndpointError"}};var Ap=(e,t)=>e===t;var kp=e=>{let t=e.split("."),r=[];for(let n of t){let o=n.indexOf("[");if(o!==-1){if(n.indexOf("]")!==n.length-1)throw new K(`Path: '${e}' does not end with ']'`);let s=n.slice(o+1,-1);if(Number.isNaN(parseInt(s)))throw new K(`Invalid array index: '${s}' in path: '${e}'`);o!==0&&r.push(n.slice(0,o)),r.push(s)}else r.push(n)}return r};var hs=(e,t)=>kp(t).reduce((r,n)=>{if(typeof r!="object")throw new K(`Index '${n}' in '${t}' not found in '${JSON.stringify(e)}'`);return Array.isArray(r)?r[parseInt(n)]:r[n]},e);var Tp=e=>e!=null;var Ip=e=>!e;var Si={[Hr.HTTP]:80,[Hr.HTTPS]:443},Cp=e=>{let t=(()=>{try{if(e instanceof URL)return e;if(typeof e=="object"&&"hostname"in e){let{hostname:d,port:m,protocol:h="",path:y="",query:g={}}=e,v=new URL(`${h}//${d}${m?`:${m}`:""}${y}`);return v.search=Object.entries(g).map(([b,w])=>`${b}=${w}`).join("&"),v}return new URL(e)}catch{return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(e)} as a whatwg URL.`),null;let r=t.href,{host:n,hostname:o,pathname:s,protocol:i,search:a}=t;if(a)return null;let c=i.slice(0,-1);if(!Object.values(Hr).includes(c))return null;let l=oo(o),f=r.includes(`${n}:${Si[c]}`)||typeof e=="string"&&e.includes(`${n}:${Si[c]}`),p=`${n}${f?`:${Si[c]}`:""}`;return{scheme:c,authority:p,path:s,normalizedPath:s.endsWith("/")?s:`${s}/`,isIp:l}};var Rp=(e,t)=>e===t;var Op=(e,t,r,n)=>t>=r||e.length<r?null:n?e.substring(e.length-r,e.length-t):e.substring(t,r);var Pp=e=>encodeURIComponent(e).replace(/[!*'()]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`);var Np={booleanEquals:Ap,getAttr:hs,isSet:Tp,isValidHostLabel:so,not:Ip,parseURL:Cp,stringEquals:Rp,substring:Op,uriEncode:Pp};var gs=(e,t)=>{let r=[],n={...t.endpointParams,...t.referenceRecord},o=0;for(;o<e.length;){let s=e.indexOf("{",o);if(s===-1){r.push(e.slice(o));break}r.push(e.slice(o,s));let i=e.indexOf("}",s);if(i===-1){r.push(e.slice(s));break}e[s+1]==="{"&&e[i+1]==="}"&&(r.push(e.slice(s+1,i)),o=i+2);let a=e.substring(s+1,i);if(a.includes("#")){let[c,l]=a.split("#");r.push(hs(n[c],l))}else r.push(n[a]);o=i+1}return r.join("")};var Mp=({ref:e},t)=>({...t.endpointParams,...t.referenceRecord})[e];var Nt=(e,t,r)=>{if(typeof e=="string")return gs(e,r);if(e.fn)return ys(e,r);if(e.ref)return Mp(e,r);throw new K(`'${t}': ${String(e)} is not a string, function or reference.`)};var ys=({fn:e,argv:t},r)=>{let n=t.map(s=>["boolean","number"].includes(typeof s)?s:Nt(s,"arg",r)),o=e.split(".");return o[0]in cr&&o[1]!=null?cr[o[0]][o[1]](...n):Np[e](...n)};var Dp=({assign:e,...t},r)=>{if(e&&e in r.referenceRecord)throw new K(`'${e}' is already defined in Reference Record.`);let n=ys(t,r);return r.logger?.debug?.(`${bt} evaluateCondition: ${Be(t)} = ${Be(n)}`),{result:n===""?!0:!!n,...e!=null&&{toAssign:{name:e,value:n}}}};var Jr=(e=[],t)=>{let r={};for(let n of e){let{result:o,toAssign:s}=Dp(n,{...t,referenceRecord:{...t.referenceRecord,...r}});if(!o)return{result:o};s&&(r[s.name]=s.value,t.logger?.debug?.(`${bt} assign: ${s.name} := ${Be(s.value)}`))}return{result:!0,referenceRecord:r}};var Bp=(e,t)=>Object.entries(e).reduce((r,[n,o])=>({...r,[n]:o.map(s=>{let i=Nt(s,"Header value entry",t);if(typeof i!="string")throw new K(`Header '${n}' value '${i}' is not a string`);return i})}),{});var Ai=(e,t)=>{if(Array.isArray(e))return e.map(r=>Ai(r,t));switch(typeof e){case"string":return gs(e,t);case"object":if(e===null)throw new K(`Unexpected endpoint property: ${e}`);return vs(e,t);case"boolean":return e;default:throw new K(`Unexpected endpoint property type: ${typeof e}`)}};var vs=(e,t)=>Object.entries(e).reduce((r,[n,o])=>({...r,[n]:Ai(o,t)}),{});var $p=(e,t)=>{let r=Nt(e,"Endpoint URL",t);if(typeof r=="string")try{return new URL(r)}catch(n){throw console.error(`Failed to construct URL with ${r}`,n),n}throw new K(`Endpoint URL must be a string, got ${typeof r}`)};var Up=(e,t)=>{let{conditions:r,endpoint:n}=e,{result:o,referenceRecord:s}=Jr(r,t);if(!o)return;let i={...t,referenceRecord:{...t.referenceRecord,...s}},{url:a,properties:c,headers:l}=n;return t.logger?.debug?.(`${bt} Resolving endpoint from template: ${Be(n)}`),{...l!=null&&{headers:Bp(l,i)},...c!=null&&{properties:vs(c,i)},url:$p(a,i)}};var Lp=(e,t)=>{let{conditions:r,error:n}=e,{result:o,referenceRecord:s}=Jr(r,t);if(o)throw new K(Nt(n,"Error",{...t,referenceRecord:{...t.referenceRecord,...s}}))};var Fp=(e,t)=>{let{conditions:r,rules:n}=e,{result:o,referenceRecord:s}=Jr(r,t);if(o)return bs(n,{...t,referenceRecord:{...t.referenceRecord,...s}})};var bs=(e,t)=>{for(let r of e)if(r.type==="endpoint"){let n=Up(r,t);if(n)return n}else if(r.type==="error")Lp(r,t);else if(r.type==="tree"){let n=Fp(r,t);if(n)return n}else throw new K(`Unknown endpoint rule: ${r}`);throw new K("Rules evaluation failed")};var ki=(e,t)=>{let{endpointParams:r,logger:n}=t,{parameters:o,rules:s}=e;t.logger?.debug?.(`${bt} Initial EndpointParams: ${Be(r)}`);let i=Object.entries(o).filter(([,l])=>l.default!=null).map(([l,f])=>[l,f.default]);if(i.length>0)for(let[l,f]of i)r[l]=r[l]??f;let a=Object.entries(o).filter(([,l])=>l.required).map(([l])=>l);for(let l of a)if(r[l]==null)throw new K(`Missing required parameter: '${l}'`);let c=bs(s,{endpointParams:r,logger:n,referenceRecord:{}});return t.logger?.debug?.(`${bt} Resolved endpoint: ${Be(c)}`),c};var Ti=(e,t=!1)=>{if(t){for(let r of e.split("."))if(!Ti(r))return!1;return!0}return!(!so(e)||e.length<3||e.length>63||e!==e.toLowerCase()||oo(e))};var Hp=":",xE="/",jp=e=>{let t=e.split(Hp);if(t.length<6)return null;let[r,n,o,s,i,...a]=t;if(r!=="arn"||n===""||o===""||a.join(Hp)==="")return null;let c=a.map(l=>l.split(xE)).flat();return{partition:n,service:o,region:s,accountId:i,resourceId:c}};var Kp={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"AWS ISOE (Europe) global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"AWS ISOF global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"amazonaws.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}}],version:"1.1"};var _E=Kp,EE="",Gp=e=>{let{partitions:t}=_E;for(let n of t){let{regions:o,outputs:s}=n;for(let[i,a]of Object.entries(o))if(i===e)return{...s,...a}}for(let n of t){let{regionRegex:o,outputs:s}=n;if(new RegExp(o).test(e))return{...s}}let r=t.find(n=>n.id==="aws");if(!r)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...r.outputs}};var Vp=()=>EE;var Ii={isVirtualHostableS3Bucket:Ti,parseArn:jp,partition:Gp};cr.aws=Ii;function qp(e){let t={};if(e=e.replace(/^\?/,""),e)for(let r of e.split("&")){let[n,o=null]=r.split("=");n=decodeURIComponent(n),o&&(o=decodeURIComponent(o)),n in t?Array.isArray(t[n])?t[n].push(o):t[n]=[t[n],o]:t[n]=o}return t}var lr=e=>{if(typeof e=="string")return lr(new URL(e));let{hostname:t,pathname:r,port:n,protocol:o,search:s}=e,i;return s&&(i=qp(s)),{hostname:t,port:n?parseInt(n):void 0,protocol:o,path:r,query:i}};function Jp(e,t,r){return e.$source||(e.$source={}),e.$source[t]=r,e}function Je(e,t,r){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=r}var Ci=e=>we.isInstance(e)?e.headers?.date??e.headers?.Date:void 0;var xs=e=>new Date(Date.now()+e);var zp=(e,t)=>Math.abs(xs(t).getTime()-e)>=3e5;var Ri=(e,t)=>{let r=Date.parse(e);return zp(r,t)?r-Date.now():t};var ao=(e,t)=>{if(!t)throw new Error(`Property \`${e}\` is not resolved for AWS SDK SigV4Auth`);return t},Wp=async e=>{let t=ao("context",e.context),r=ao("config",e.config),n=t.endpointV2?.properties?.authSchemes?.[0],s=await ao("signer",r.signer)(n),i=e?.signingRegion,a=e?.signingRegionSet,c=e?.signingName;return{config:r,signer:s,signingRegion:i,signingRegionSet:a,signingName:c}},io=class{async sign(t,r,n){if(!L.isInstance(t))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");let o=await Wp(n),{config:s,signer:i}=o,{signingRegion:a,signingName:c}=o,l=n.context;if(l?.authSchemes?.length??0>1){let[p,d]=l.authSchemes;p?.name==="sigv4a"&&d?.name==="sigv4"&&(a=d?.signingRegion??a,c=d?.signingName??c)}return await i.sign(t,{signingDate:xs(s.systemClockOffset),signingRegion:a,signingService:c})}errorHandler(t){return r=>{let n=r.ServerTime??Ci(r.$response);if(n){let o=ao("config",t.config),s=o.systemClockOffset;o.systemClockOffset=Ri(n,o.systemClockOffset),o.systemClockOffset!==s&&r.$metadata&&(r.$metadata.clockSkewCorrected=!0)}throw r}}successHandler(t,r){let n=Ci(t);if(n){let o=ao("config",r.config);o.systemClockOffset=Ri(n,o.systemClockOffset)}}};var Qp=(e,t,r)=>{let n,o,s,i=!1,a=async()=>{o||(o=e());try{n=await o,s=!0,i=!1}finally{o=void 0}return n};return t===void 0?async c=>((!s||c?.forceRefresh)&&(n=await a()),n):async c=>((!s||c?.forceRefresh)&&(n=await a()),i?n:r&&!r(n)?(i=!0,n):(t(n)&&await a(),n))};var Xp="X-Amz-Algorithm",Zp="X-Amz-Credential",Oi="X-Amz-Date",ef="X-Amz-SignedHeaders",tf="X-Amz-Expires",Pi="X-Amz-Signature",Ni="X-Amz-Security-Token";var Mi="authorization",Di=Oi.toLowerCase(),SE="date",rf=[Mi,Di,SE],nf=Pi.toLowerCase(),co="x-amz-content-sha256",of=Ni.toLowerCase();var sf={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},af=/^proxy-/,cf=/^sec-/;var ws="AWS4-HMAC-SHA256";var lf="AWS4-HMAC-SHA256-PAYLOAD",uf="UNSIGNED-PAYLOAD",df=50,Bi="aws4_request",pf=60*60*24*7;var _s={},$i=[],Es=(e,t,r)=>`${e}/${t}/${r}/${Bi}`,mf=async(e,t,r,n,o)=>{let s=await ff(e,t.secretAccessKey,t.accessKeyId),i=`${r}:${n}:${o}:${Z(s)}:${t.sessionToken}`;if(i in _s)return _s[i];for($i.push(i);$i.length>df;)delete _s[$i.shift()];let a=`AWS4${t.secretAccessKey}`;for(let c of[r,n,o,Bi])a=await ff(e,a,c);return _s[i]=a};var ff=(e,t,r)=>{let n=new e(t);return n.update(yt(r)),n.digest()};var Ss=({headers:e},t,r)=>{let n={};for(let o of Object.keys(e).sort()){if(e[o]==null)continue;let s=o.toLowerCase();(s in sf||t?.has(s)||af.test(s)||cf.test(s))&&(!r||r&&!r.has(s))||(n[s]=e[o].trim().replace(/\s+/g," "))}return n};var hf=e=>typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||Object.prototype.toString.call(e)==="[object ArrayBuffer]";var lo=async({headers:e,body:t},r)=>{for(let n of Object.keys(e))if(n.toLowerCase()===co)return e[n];if(t==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof t=="string"||ArrayBuffer.isView(t)||hf(t)){let n=new r;return n.update(yt(t)),Z(await n.digest())}return uf};var As=class{format(t){let r=[];for(let s of Object.keys(t)){let i=Ge(s);r.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(t[s]))}let n=new Uint8Array(r.reduce((s,i)=>s+i.byteLength,0)),o=0;for(let s of r)n.set(s,o),o+=s.byteLength;return n}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":let r=new DataView(new ArrayBuffer(3));return r.setUint8(0,3),r.setInt16(1,t.value,!1),new Uint8Array(r.buffer);case"integer":let n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,t.value,!1),new Uint8Array(n.buffer);case"long":let o=new Uint8Array(9);return o[0]=5,o.set(t.value.bytes,1),o;case"binary":let s=new DataView(new ArrayBuffer(3+t.value.byteLength));s.setUint8(0,6),s.setUint16(1,t.value.byteLength,!1);let i=new Uint8Array(s.buffer);return i.set(t.value,3),i;case"string":let a=Ge(t.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);let l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":let f=new Uint8Array(9);return f[0]=8,f.set(uo.fromNumber(t.value.valueOf()).bytes,1),f;case"uuid":if(!AE.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);let p=new Uint8Array(17);return p[0]=9,p.set(qr(t.value.replace(/\-/g,"")),1),p}}},gf;(function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"})(gf||(gf={}));var AE=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,uo=class{constructor(t){if(this.bytes=t,t.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>9223372036854776e3||t<-9223372036854776e3)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);let r=new Uint8Array(8);for(let n=7,o=Math.abs(Math.round(t));n>-1&&o>0;n--,o/=256)r[n]=o;return t<0&&yf(r),new uo(r)}valueOf(){let t=this.bytes.slice(0),r=t[0]&128;return r&&yf(t),parseInt(Z(t),16)*(r?-1:1)}toString(){return String(this.valueOf())}};function yf(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,e[t]===0);t--);}var Ui=(e,t)=>{e=e.toLowerCase();for(let r of Object.keys(t))if(e===r.toLowerCase())return!0;return!1};var Li=(e,t={})=>{let{headers:r,query:n={}}=L.clone(e);for(let o of Object.keys(r)){let s=o.toLowerCase();(s.slice(0,6)==="x-amz-"&&!t.unhoistableHeaders?.has(s)||t.hoistableHeaders?.has(s))&&(n[o]=r[o],delete r[o])}return{...e,headers:r,query:n}};var ks=e=>{e=L.clone(e);for(let t of Object.keys(e.headers))rf.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e};var Fi=({query:e={}})=>{let t=[],r={};for(let n of Object.keys(e)){if(n.toLowerCase()===nf)continue;let o=qe(n);t.push(o);let s=e[n];typeof s=="string"?r[o]=`${o}=${qe(s)}`:Array.isArray(s)&&(r[o]=s.slice(0).reduce((i,a)=>i.concat([`${o}=${qe(a)}`]),[]).sort().join("&"))}return t.sort().map(n=>r[n]).filter(n=>n).join("&")};var vf=e=>kE(e).toISOString().replace(/\.\d{3}Z$/,"Z"),kE=e=>typeof e=="number"?new Date(e*1e3):typeof e=="string"?Number(e)?new Date(Number(e)*1e3):new Date(e):e;var po=class{constructor({applyChecksum:t,credentials:r,region:n,service:o,sha256:s,uriEscapePath:i=!0}){this.service=o,this.sha256=s,this.uriEscapePath=i,this.applyChecksum=typeof t=="boolean"?t:!0,this.regionProvider=ge(n),this.credentialProvider=ge(r)}createCanonicalRequest(t,r,n){let o=Object.keys(r).sort();return`${t.method}
${this.getCanonicalPath(t)}
${Fi(t)}
${o.map(s=>`${s}:${r[s]}`).join(`
`)}

${o.join(";")}
${n}`}async createStringToSign(t,r,n,o){let s=new this.sha256;s.update(yt(n));let i=await s.digest();return`${o}
${t}
${r}
${Z(i)}`}getCanonicalPath({path:t}){if(this.uriEscapePath){let r=[];for(let s of t.split("/"))s?.length!==0&&s!=="."&&(s===".."?r.pop():r.push(s));let n=`${t?.startsWith("/")?"/":""}${r.join("/")}${r.length>0&&t?.endsWith("/")?"/":""}`;return qe(n).replace(/%2F/g,"/")}return t}validateResolvedCredentials(t){if(typeof t!="object"||typeof t.accessKeyId!="string"||typeof t.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(t){let r=vf(t).replace(/[\-:]/g,"");return{longDate:r,shortDate:r.slice(0,8)}}getCanonicalHeaderList(t){return Object.keys(t).sort().join(";")}};var fo=class extends po{constructor({applyChecksum:t,credentials:r,region:n,service:o,sha256:s,uriEscapePath:i=!0}){super({applyChecksum:t,credentials:r,region:n,service:o,sha256:s,uriEscapePath:i}),this.headerFormatter=new As}async presign(t,r={}){let{signingDate:n=new Date,expiresIn:o=3600,unsignableHeaders:s,unhoistableHeaders:i,signableHeaders:a,hoistableHeaders:c,signingRegion:l,signingService:f}=r,p=await this.credentialProvider();this.validateResolvedCredentials(p);let d=l??await this.regionProvider(),{longDate:m,shortDate:h}=this.formatDate(n);if(o>pf)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");let y=Es(h,d,f??this.service),g=Li(ks(t),{unhoistableHeaders:i,hoistableHeaders:c});p.sessionToken&&(g.query[Ni]=p.sessionToken),g.query[Xp]=ws,g.query[Zp]=`${p.accessKeyId}/${y}`,g.query[Oi]=m,g.query[tf]=o.toString(10);let v=Ss(g,s,a);return g.query[ef]=this.getCanonicalHeaderList(v),g.query[Pi]=await this.getSignature(m,y,this.getSigningKey(p,d,h,f),this.createCanonicalRequest(g,v,await lo(t,this.sha256))),g}async sign(t,r){return typeof t=="string"?this.signString(t,r):t.headers&&t.payload?this.signEvent(t,r):t.message?this.signMessage(t,r):this.signRequest(t,r)}async signEvent({headers:t,payload:r},{signingDate:n=new Date,priorSignature:o,signingRegion:s,signingService:i}){let a=s??await this.regionProvider(),{shortDate:c,longDate:l}=this.formatDate(n),f=Es(c,a,i??this.service),p=await lo({headers:{},body:r},this.sha256),d=new this.sha256;d.update(t);let m=Z(await d.digest()),h=[lf,l,f,o,m,p].join(`
`);return this.signString(h,{signingDate:n,signingRegion:a,signingService:i})}async signMessage(t,{signingDate:r=new Date,signingRegion:n,signingService:o}){return this.signEvent({headers:this.headerFormatter.format(t.message.headers),payload:t.message.body},{signingDate:r,signingRegion:n,signingService:o,priorSignature:t.priorSignature}).then(i=>({message:t.message,signature:i}))}async signString(t,{signingDate:r=new Date,signingRegion:n,signingService:o}={}){let s=await this.credentialProvider();this.validateResolvedCredentials(s);let i=n??await this.regionProvider(),{shortDate:a}=this.formatDate(r),c=new this.sha256(await this.getSigningKey(s,i,a,o));return c.update(yt(t)),Z(await c.digest())}async signRequest(t,{signingDate:r=new Date,signableHeaders:n,unsignableHeaders:o,signingRegion:s,signingService:i}={}){let a=await this.credentialProvider();this.validateResolvedCredentials(a);let c=s??await this.regionProvider(),l=ks(t),{longDate:f,shortDate:p}=this.formatDate(r),d=Es(p,c,i??this.service);l.headers[Di]=f,a.sessionToken&&(l.headers[of]=a.sessionToken);let m=await lo(l,this.sha256);!Ui(co,l.headers)&&this.applyChecksum&&(l.headers[co]=m);let h=Ss(l,o,n),y=await this.getSignature(f,d,this.getSigningKey(a,c,p,i),this.createCanonicalRequest(l,h,m));return l.headers[Mi]=`${ws} Credential=${a.accessKeyId}/${d}, SignedHeaders=${this.getCanonicalHeaderList(h)}, Signature=${y}`,l}async getSignature(t,r,n,o){let s=await this.createStringToSign(t,r,o,ws),i=new this.sha256(await n);return i.update(yt(s)),Z(await i.digest())}getSigningKey(t,r,n,o){return mf(this.sha256,t,n,r,o||this.service)}};var bf=e=>{let t=e.credentials,r=!!e.credentials,n;Object.defineProperty(e,"credentials",{set(l){l&&l!==t&&l!==n&&(r=!0),t=l;let f=TE(e,{credentials:t,credentialDefaultProvider:e.credentialDefaultProvider}),p=IE(e,f);r&&!p.attributed?(n=async d=>p(d).then(m=>Jp(m,"CREDENTIALS_CODE","e")),n.memoized=p.memoized,n.configBound=p.configBound,n.attributed=!0):n=p},get(){return n},enumerable:!0,configurable:!0}),e.credentials=t;let{signingEscapePath:o=!0,systemClockOffset:s=e.systemClockOffset||0,sha256:i}=e,a;return e.signer?a=sr(e.signer):e.regionInfoProvider?a=()=>sr(e.region)().then(async l=>[await e.regionInfoProvider(l,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},l]).then(([l,f])=>{let{signingRegion:p,signingService:d}=l;e.signingRegion=e.signingRegion||p||f,e.signingName=e.signingName||d||e.serviceId;let m={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:i,uriEscapePath:o},h=e.signerConstructor||fo;return new h(m)}):a=async l=>{l=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await sr(e.region)(),properties:{}},l);let f=l.signingRegion,p=l.signingName;e.signingRegion=e.signingRegion||f,e.signingName=e.signingName||p||e.serviceId;let d={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:i,uriEscapePath:o},m=e.signerConstructor||fo;return new m(d)},Object.assign(e,{systemClockOffset:s,signingEscapePath:o,signer:a})};function TE(e,{credentials:t,credentialDefaultProvider:r}){let n;return t?t?.memoized?n=t:n=fs(t,ps,no):r?n=sr(r(Object.assign({},e,{parentClientConfig:e}))):n=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},n.memoized=!0,n}function IE(e,t){if(t.configBound)return t;let r=async n=>t({...n,callerClientConfig:e});return r.memoized=t.memoized,r.configBound=!0,r}var xf=typeof TextEncoder=="function"?new TextEncoder:null,wf=e=>{if(typeof e=="string"){if(xf)return xf.encode(e).byteLength;let t=e.length;for(let r=t-1;r>=0;r--){let n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t}else{if(typeof e.byteLength=="number")return e.byteLength;if(typeof e.size=="number")return e.size}throw new Error(`Body Length computation failed for ${e}`)};var ur=(e,t)=>{let r=[];if(e&&r.push(e),t)for(let n of t)r.push(n);return r},Mt=(e,t)=>`${e||"anonymous"}${t&&t.length>0?` (a.k.a. ${t.join(",")})`:""}`,zr=()=>{let e=[],t=[],r=!1,n=new Set,o=p=>p.sort((d,m)=>_f[m.step]-_f[d.step]||Ef[m.priority||"normal"]-Ef[d.priority||"normal"]),s=p=>{let d=!1,m=h=>{let y=ur(h.name,h.aliases);if(y.includes(p)){d=!0;for(let g of y)n.delete(g);return!1}return!0};return e=e.filter(m),t=t.filter(m),d},i=p=>{let d=!1,m=h=>{if(h.middleware===p){d=!0;for(let y of ur(h.name,h.aliases))n.delete(y);return!1}return!0};return e=e.filter(m),t=t.filter(m),d},a=p=>(e.forEach(d=>{p.add(d.middleware,{...d})}),t.forEach(d=>{p.addRelativeTo(d.middleware,{...d})}),p.identifyOnResolve?.(f.identifyOnResolve()),p),c=p=>{let d=[];return p.before.forEach(m=>{m.before.length===0&&m.after.length===0?d.push(m):d.push(...c(m))}),d.push(p),p.after.reverse().forEach(m=>{m.before.length===0&&m.after.length===0?d.push(m):d.push(...c(m))}),d},l=(p=!1)=>{let d=[],m=[],h={};return e.forEach(g=>{let v={...g,before:[],after:[]};for(let b of ur(v.name,v.aliases))h[b]=v;d.push(v)}),t.forEach(g=>{let v={...g,before:[],after:[]};for(let b of ur(v.name,v.aliases))h[b]=v;m.push(v)}),m.forEach(g=>{if(g.toMiddleware){let v=h[g.toMiddleware];if(v===void 0){if(p)return;throw new Error(`${g.toMiddleware} is not found when adding ${Mt(g.name,g.aliases)} middleware ${g.relation} ${g.toMiddleware}`)}g.relation==="after"&&v.after.push(g),g.relation==="before"&&v.before.push(g)}}),o(d).map(c).reduce((g,v)=>(g.push(...v),g),[])},f={add:(p,d={})=>{let{name:m,override:h,aliases:y}=d,g={step:"initialize",priority:"normal",middleware:p,...d},v=ur(m,y);if(v.length>0){if(v.some(b=>n.has(b))){if(!h)throw new Error(`Duplicate middleware name '${Mt(m,y)}'`);for(let b of v){let w=e.findIndex(T=>T.name===b||T.aliases?.some(U=>U===b));if(w===-1)continue;let S=e[w];if(S.step!==g.step||g.priority!==S.priority)throw new Error(`"${Mt(S.name,S.aliases)}" middleware with ${S.priority} priority in ${S.step} step cannot be overridden by "${Mt(m,y)}" middleware with ${g.priority} priority in ${g.step} step.`);e.splice(w,1)}}for(let b of v)n.add(b)}e.push(g)},addRelativeTo:(p,d)=>{let{name:m,override:h,aliases:y}=d,g={middleware:p,...d},v=ur(m,y);if(v.length>0){if(v.some(b=>n.has(b))){if(!h)throw new Error(`Duplicate middleware name '${Mt(m,y)}'`);for(let b of v){let w=t.findIndex(T=>T.name===b||T.aliases?.some(U=>U===b));if(w===-1)continue;let S=t[w];if(S.toMiddleware!==g.toMiddleware||S.relation!==g.relation)throw new Error(`"${Mt(S.name,S.aliases)}" middleware ${S.relation} "${S.toMiddleware}" middleware cannot be overridden by "${Mt(m,y)}" middleware ${g.relation} "${g.toMiddleware}" middleware.`);t.splice(w,1)}}for(let b of v)n.add(b)}t.push(g)},clone:()=>a(zr()),use:p=>{p.applyToStack(f)},remove:p=>typeof p=="string"?s(p):i(p),removeByTag:p=>{let d=!1,m=h=>{let{tags:y,name:g,aliases:v}=h;if(y&&y.includes(p)){let b=ur(g,v);for(let w of b)n.delete(w);return d=!0,!1}return!0};return e=e.filter(m),t=t.filter(m),d},concat:p=>{let d=a(zr());return d.use(p),d.identifyOnResolve(r||d.identifyOnResolve()||(p.identifyOnResolve?.()??!1)),d},applyToStack:a,identify:()=>l(!0).map(p=>{let d=p.step??p.relation+" "+p.toMiddleware;return Mt(p.name,p.aliases)+" - "+d}),identifyOnResolve(p){return typeof p=="boolean"&&(r=p),r},resolve:(p,d)=>{for(let m of l().map(h=>h.middleware).reverse())p=m(p,d);return r&&console.log(f.identify()),p}};return f},_f={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},Ef={high:3,normal:2,low:1};var Ts=class{constructor(t){this.config=t,this.middlewareStack=zr()}send(t,r,n){let o=typeof r!="function"?r:void 0,s=typeof r=="function"?r:n,i=o===void 0&&this.config.cacheMiddleware===!0,a;if(i){this.handlers||(this.handlers=new WeakMap);let c=this.handlers;c.has(t.constructor)?a=c.get(t.constructor):(a=t.resolveMiddleware(this.middlewareStack,this.config,o),c.set(t.constructor,a))}else delete this.handlers,a=t.resolveMiddleware(this.middlewareStack,this.config,o);if(s)a(t).then(c=>s(null,c.output),c=>s(c)).catch(()=>{});else return a(t).then(c=>c.output)}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}};var xt=class{constructor(){this.middlewareStack=zr()}static classBuilder(){return new Hi}resolveMiddlewareWithContext(t,r,n,{middlewareFn:o,clientName:s,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,smithyContext:l,additionalContext:f,CommandCtor:p}){for(let g of o.bind(this)(p,t,r,n))this.middlewareStack.use(g);let d=t.concat(this.middlewareStack),{logger:m}=r,h={logger:m,clientName:s,commandName:i,inputFilterSensitiveLog:a,outputFilterSensitiveLog:c,[Zn]:{commandInstance:this,...l},...f},{requestHandler:y}=r;return d.resolve(g=>y.handle(g.request,n||{}),h)}},Hi=class{constructor(){this._init=()=>{},this._ep={},this._middlewareFn=()=>[],this._commandName="",this._clientName="",this._additionalContext={},this._smithyContext={},this._inputFilterSensitiveLog=t=>t,this._outputFilterSensitiveLog=t=>t,this._serializer=null,this._deserializer=null}init(t){this._init=t}ep(t){return this._ep=t,this}m(t){return this._middlewareFn=t,this}s(t,r,n={}){return this._smithyContext={service:t,operation:r,...n},this}c(t={}){return this._additionalContext=t,this}n(t,r){return this._clientName=t,this._commandName=r,this}f(t=n=>n,r=n=>n){return this._inputFilterSensitiveLog=t,this._outputFilterSensitiveLog=r,this}ser(t){return this._serializer=t,this}de(t){return this._deserializer=t,this}sc(t){return this._operationSchema=t,this._smithyContext.operationSchema=t,this}build(){let t=this,r;return r=class extends xt{static getEndpointParameterInstructions(){return t._ep}constructor(...[n]){super(),this.serialize=t._serializer,this.deserialize=t._deserializer,this.input=n??{},t._init(this),this.schema=t._operationSchema}resolveMiddleware(n,o,s){return this.resolveMiddlewareWithContext(n,o,s,{CommandCtor:r,middlewareFn:t._middlewareFn,clientName:t._clientName,commandName:t._commandName,inputFilterSensitiveLog:t._inputFilterSensitiveLog,outputFilterSensitiveLog:t._outputFilterSensitiveLog,smithyContext:t._smithyContext,additionalContext:t._additionalContext})}}}};var wt="***SensitiveInformation***";var _t=class extends Error{constructor(t){super(t.message),Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=t.name,this.$fault=t.$fault,this.$metadata=t.$metadata}static isInstance(t){if(!t)return!1;let r=t;return _t.prototype.isPrototypeOf(r)||Boolean(r.$fault)&&Boolean(r.$metadata)&&(r.$fault==="client"||r.$fault==="server")}static[Symbol.hasInstance](t){if(!t)return!1;let r=t;return this===_t?_t.isInstance(t):_t.isInstance(t)?r.name&&this.name?this.prototype.isPrototypeOf(t)||r.name===this.name:this.prototype.isPrototypeOf(t):!1}},ye=(e,t={})=>{Object.entries(t).filter(([,n])=>n!==void 0).forEach(([n,o])=>{(e[n]==null||e[n]==="")&&(e[n]=o)});let r=e.message||e.Message||"UnknownError";return e.message=r,delete e.Message,e};var CE=({output:e,parsedBody:t,exceptionCtor:r,errorCode:n})=>{let o=RE(e),s=o.httpStatusCode?o.httpStatusCode+"":void 0,i=new r({name:t?.code||t?.Code||n||s||"UnknownError",$fault:"client",$metadata:o});throw ye(i,t)},Sf=e=>({output:t,parsedBody:r,errorCode:n})=>{CE({output:t,parsedBody:r,exceptionCtor:e,errorCode:n})},RE=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]});var Af=e=>{switch(e){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}};var kf=e=>{let t=[];for(let r in jr){let n=jr[r];e[n]!==void 0&&t.push({algorithmId:()=>n,checksumConstructor:()=>e[n]})}return{addChecksumAlgorithm(r){t.push(r)},checksumAlgorithms(){return t}}},Tf=e=>{let t={};return e.checksumAlgorithms().forEach(r=>{t[r.algorithmId()]=r.checksumConstructor()}),t};var If=e=>({setRetryStrategy(t){e.retryStrategy=t},retryStrategy(){return e.retryStrategy}}),Cf=e=>{let t={};return t.retryStrategy=e.retryStrategy(),t};var Rf=e=>Object.assign(kf(e),If(e));var Of=e=>Object.assign(Tf(e),Cf(e));var Pf=e=>e!=null;var Wr=class{trace(){}debug(){}info(){}warn(){}error(){}};function ae(e,t,r){let n,o,s;if(typeof t>"u"&&typeof r>"u")n={},s=e;else{if(n=e,typeof t=="function")return o=t,s=r,OE(n,o,s);s=t}for(let i of Object.keys(s)){if(!Array.isArray(s[i])){n[i]=s[i];continue}Nf(n,null,s,i)}return n}var D=(e,t)=>{let r={};for(let n in t)Nf(r,e,t,n);return r},OE=(e,t,r)=>ae(e,Object.entries(r).reduce((n,[o,s])=>(Array.isArray(s)?n[o]=s:typeof s=="function"?n[o]=[t,s()]:n[o]=[t,s],n),{})),Nf=(e,t,r,n)=>{if(t!==null){let i=r[n];typeof i=="function"&&(i=[,i]);let[a=PE,c=NE,l=n]=i;(typeof a=="function"&&a(t[l])||typeof a!="function"&&a)&&(e[n]=c(t[l]));return}let[o,s]=r[n];if(typeof s=="function"){let i,a=o===void 0&&(i=s())!=null,c=typeof o=="function"&&!!o(void 0)||typeof o!="function"&&!!o;a?e[n]=i:c&&(e[n]=s())}else{let i=o===void 0&&s!=null,a=typeof o=="function"&&!!o(s)||typeof o!="function"&&!!o;(i||a)&&(e[n]=s)}},PE=e=>e!=null,NE=e=>e;var ji=e=>{if(e!==e)return"NaN";switch(e){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return e}};var C=e=>{if(e==null)return{};if(Array.isArray(e))return e.filter(t=>t!=null).map(C);if(typeof e=="object"){let t={};for(let r of Object.keys(e))e[r]!=null&&(t[r]=C(e[r]));return t}return e};var Mf=(e,t)=>to(e,t).then(r=>t.utf8Encoder(r));var _e=(e,t)=>Mf(e,t).then(r=>{if(r.length)try{return JSON.parse(r)}catch(n){throw n?.name==="SyntaxError"&&Object.defineProperty(n,"$responseBodyText",{value:r}),n}return{}}),Df=async(e,t)=>{let r=await _e(e,t);return r.message=r.message??r.Message,r},Bf=(e,t)=>{let r=(s,i)=>Object.keys(s).find(a=>a.toLowerCase()===i.toLowerCase()),n=s=>{let i=s;return typeof i=="number"&&(i=i.toString()),i.indexOf(",")>=0&&(i=i.split(",")[0]),i.indexOf(":")>=0&&(i=i.split(":")[0]),i.indexOf("#")>=0&&(i=i.split("#")[1]),i},o=r(e.headers,"x-amzn-errortype");if(o!==void 0)return n(e.headers[o]);if(t&&typeof t=="object"){let s=r(t,"code");if(s&&t[s]!==void 0)return n(t[s]);if(t.__type!==void 0)return n(t.__type)}};var $e=e=>{if(e!=null)return typeof e=="object"&&"__type"in e&&delete e.__type,wp(e)};var ME=/\d{12}\.ddb/;async function $f(e,t,r){if(r.request?.headers?.["smithy-protocol"]==="rpc-v2-cbor"&&Je(e,"PROTOCOL_RPC_V2_CBOR","M"),typeof t.retryStrategy=="function"){let s=await t.retryStrategy();typeof s.acquireInitialRetryToken=="function"?s.constructor?.name?.includes("Adaptive")?Je(e,"RETRY_MODE_ADAPTIVE","F"):Je(e,"RETRY_MODE_STANDARD","E"):Je(e,"RETRY_MODE_LEGACY","D")}if(typeof t.accountIdEndpointMode=="function"){let s=e.endpointV2;switch(String(s?.url?.hostname).match(ME)&&Je(e,"ACCOUNT_ID_ENDPOINT","O"),await t.accountIdEndpointMode?.()){case"disabled":Je(e,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":Je(e,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":Je(e,"ACCOUNT_ID_MODE_REQUIRED","R");break}}let o=e.__smithy_context?.selectedHttpAuthScheme?.identity;if(o?.$source){let s=o;s.accountId&&Je(e,"RESOLVED_ACCOUNT_ID","T");for(let[i,a]of Object.entries(s.$source??{}))Je(e,i,a)}}var Ki="user-agent",Is="x-amz-user-agent",Gi=" ",Cs="/",Uf=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,Lf=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,Vi="-";function Ff(e){let t="";for(let r in e){let n=e[r];if(t.length+n.length+1<=1024){t.length?t+=","+n:t+=n;continue}break}return t}var DE=e=>(t,r)=>async n=>{let{request:o}=n;if(!L.isInstance(o))return t(n);let{headers:s}=o,i=r?.userAgent?.map(Rs)||[],a=(await e.defaultUserAgentProvider()).map(Rs);await $f(r,e,n);let c=r;a.push(`m/${Ff(Object.assign({},r.__smithy_context?.features,c.__aws_sdk_context?.features))}`);let l=e?.customUserAgent?.map(Rs)||[],f=await e.userAgentAppId();f&&a.push(Rs([`app/${f}`]));let p=Vp(),d=(p?[p]:[]).concat([...a,...i,...l]).join(Gi),m=[...a.filter(h=>h.startsWith("aws-sdk-")),...l].join(Gi);return e.runtime!=="browser"?(m&&(s[Is]=s[Is]?`${s[Ki]} ${m}`:m),s[Ki]=d):s[Is]=d,t({...n,request:o})},Rs=e=>{let t=e[0].split(Cs).map(i=>i.replace(Uf,Vi)).join(Cs),r=e[1]?.replace(Lf,Vi),n=t.indexOf(Cs),o=t.substring(0,n),s=t.substring(n+1);return o==="api"&&(s=s.toLowerCase()),[o,s,r].filter(i=>i&&i.length>0).reduce((i,a,c)=>{switch(c){case 0:return a;case 1:return`${i}/${a}`;default:return`${i}#${a}`}},"")},BE={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Hf=e=>({applyToStack:t=>{t.add(DE(e),BE)}});var jf=function(){return jf=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},jf.apply(this,arguments)};function I2(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function Os(e,t,r,n){function o(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(f){try{l(n.next(f))}catch(p){i(p)}}function c(f){try{l(n.throw(f))}catch(p){i(p)}}function l(f){f.done?s(f.value):o(f.value).then(a,c)}l((n=n.apply(e,t||[])).next())})}function Ps(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(f){return c([l,f])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(r=0)),r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(f){l=[6,f],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Kf(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function C2(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,s;n<o;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}var qi=e=>new TextEncoder().encode(e);var $E=typeof Buffer<"u"&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:qi;function ze(e){return e instanceof Uint8Array?e:typeof e=="string"?$E(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}function Dt(e){return typeof e=="string"?e.length===0:e.byteLength===0}function Ji(e){return new Uint8Array([(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255])}function zi(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),r=0;r<e.length;)t[r]=e[r],r+=1;return t}return Uint32Array.from(e)}var UE=function(){function e(){this.crc32=new dr}return e.prototype.update=function(t){Dt(t)||this.crc32.update(ze(t))},e.prototype.digest=function(){return Os(this,void 0,void 0,function(){return Ps(this,function(t){return[2,Ji(this.crc32.digest())]})})},e.prototype.reset=function(){this.crc32=new dr},e}();var dr=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(t){var r,n;try{for(var o=Kf(t),s=o.next();!s.done;s=o.next()){var i=s.value;this.checksum=this.checksum>>>8^FE[(this.checksum^i)&255]}}catch(a){r={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return this},e.prototype.digest=function(){return(this.checksum^4294967295)>>>0},e}();var LE=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],FE=zi(LE);var Bt=class{constructor(t){if(this.bytes=t,t.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>9223372036854776e3||t<-9223372036854776e3)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);let r=new Uint8Array(8);for(let n=7,o=Math.abs(Math.round(t));n>-1&&o>0;n--,o/=256)r[n]=o;return t<0&&Gf(r),new Bt(r)}valueOf(){let t=this.bytes.slice(0),r=t[0]&128;return r&&Gf(t),parseInt(Z(t),16)*(r?-1:1)}toString(){return String(this.valueOf())}};function Gf(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,e[t]===0);t--);}var Ns=class{constructor(t,r){this.toUtf8=t,this.fromUtf8=r}format(t){let r=[];for(let s of Object.keys(t)){let i=this.fromUtf8(s);r.push(Uint8Array.from([i.byteLength]),i,this.formatHeaderValue(t[s]))}let n=new Uint8Array(r.reduce((s,i)=>s+i.byteLength,0)),o=0;for(let s of r)n.set(s,o),o+=s.byteLength;return n}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":let r=new DataView(new ArrayBuffer(3));return r.setUint8(0,3),r.setInt16(1,t.value,!1),new Uint8Array(r.buffer);case"integer":let n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,t.value,!1),new Uint8Array(n.buffer);case"long":let o=new Uint8Array(9);return o[0]=5,o.set(t.value.bytes,1),o;case"binary":let s=new DataView(new ArrayBuffer(3+t.value.byteLength));s.setUint8(0,6),s.setUint16(1,t.value.byteLength,!1);let i=new Uint8Array(s.buffer);return i.set(t.value,3),i;case"string":let a=this.fromUtf8(t.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);let l=new Uint8Array(c.buffer);return l.set(a,3),l;case"timestamp":let f=new Uint8Array(9);return f[0]=8,f.set(Bt.fromNumber(t.value.valueOf()).bytes,1),f;case"uuid":if(!WE.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);let p=new Uint8Array(17);return p[0]=9,p.set(qr(t.value.replace(/\-/g,"")),1),p}}parse(t){let r={},n=0;for(;n<t.byteLength;){let o=t.getUint8(n++),s=this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+n,o));switch(n+=o,t.getUint8(n++)){case 0:r[s]={type:qf,value:!0};break;case 1:r[s]={type:qf,value:!1};break;case 2:r[s]={type:HE,value:t.getInt8(n++)};break;case 3:r[s]={type:jE,value:t.getInt16(n,!1)},n+=2;break;case 4:r[s]={type:KE,value:t.getInt32(n,!1)},n+=4;break;case 5:r[s]={type:GE,value:new Bt(new Uint8Array(t.buffer,t.byteOffset+n,8))},n+=8;break;case 6:let i=t.getUint16(n,!1);n+=2,r[s]={type:VE,value:new Uint8Array(t.buffer,t.byteOffset+n,i)},n+=i;break;case 7:let a=t.getUint16(n,!1);n+=2,r[s]={type:qE,value:this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+n,a))},n+=a;break;case 8:r[s]={type:JE,value:new Date(new Bt(new Uint8Array(t.buffer,t.byteOffset+n,8)).valueOf())},n+=8;break;case 9:let c=new Uint8Array(t.buffer,t.byteOffset+n,16);n+=16,r[s]={type:zE,value:`${Z(c.subarray(0,4))}-${Z(c.subarray(4,6))}-${Z(c.subarray(6,8))}-${Z(c.subarray(8,10))}-${Z(c.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return r}},Vf;(function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"})(Vf||(Vf={}));var qf="boolean",HE="byte",jE="short",KE="integer",GE="long",VE="binary",qE="string",JE="timestamp",zE="uuid",WE=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;var Jf=4,$t=Jf*2,pr=4,YE=$t+pr*2;function zf({byteLength:e,byteOffset:t,buffer:r}){if(e<YE)throw new Error("Provided message too short to accommodate event stream message overhead");let n=new DataView(r,t,e),o=n.getUint32(0,!1);if(e!==o)throw new Error("Reported message length does not match received message length");let s=n.getUint32(Jf,!1),i=n.getUint32($t,!1),a=n.getUint32(e-pr,!1),c=new dr().update(new Uint8Array(r,t,$t));if(i!==c.digest())throw new Error(`The prelude checksum specified in the message (${i}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(r,t+$t,e-($t+pr))),a!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(r,t+$t+pr,s),body:new Uint8Array(r,t+$t+pr+s,o-s-($t+pr+pr))}}var Yr=class{constructor(t,r){this.headerMarshaller=new Ns(t,r),this.messageBuffer=[],this.isEndOfStream=!1}feed(t){this.messageBuffer.push(this.decode(t))}endOfStream(){this.isEndOfStream=!0}getMessage(){let t=this.messageBuffer.pop(),r=this.isEndOfStream;return{getMessage(){return t},isEndOfStream(){return r}}}getAvailableMessages(){let t=this.messageBuffer;this.messageBuffer=[];let r=this.isEndOfStream;return{getMessages(){return t},isEndOfStream(){return r}}}encode({headers:t,body:r}){let n=this.headerMarshaller.format(t),o=n.byteLength+r.byteLength+16,s=new Uint8Array(o),i=new DataView(s.buffer,s.byteOffset,s.byteLength),a=new dr;return i.setUint32(0,o,!1),i.setUint32(4,n.byteLength,!1),i.setUint32(8,a.update(s.subarray(0,8)).digest(),!1),s.set(n,12),s.set(r,n.byteLength+12),i.setUint32(o-4,a.update(s.subarray(8,o-4)).digest(),!1),s}decode(t){let{headers:r,body:n}=zf(t);return{headers:this.headerMarshaller.parse(r),body:n}}formatHeaders(t){return this.headerMarshaller.format(t)}};var Ms=class{constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let t of this.options.inputStream)yield this.options.decoder.decode(t)}};var Ds=class{constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let t of this.options.messageStream)yield this.options.encoder.encode(t);this.options.includeEndFrame&&(yield new Uint8Array(0))}};var Bs=class{constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let t of this.options.messageStream){let r=await this.options.deserializer(t);r!==void 0&&(yield r)}}};var $s=class{constructor(t){this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let t of this.options.inputStream)yield this.options.serializer(t)}};var Wf=(e,t,r,n)=>{let o=e,s={start(){},async transform(i,a){try{let c=new Date(Date.now()+await n()),l={":date":{type:"timestamp",value:c}},f=await t.sign({message:{body:i,headers:l},priorSignature:o},{signingDate:c});o=f.signature;let p=r.encode({headers:{...l,":chunk-signature":{type:"binary",value:qr(f.signature)}},body:i});a.enqueue(p)}catch(c){a.error(c)}}};return new TransformStream({...s})};var Us=class{messageSigner;eventStreamCodec;systemClockOffsetProvider;constructor(t){this.messageSigner=t.messageSigner,this.eventStreamCodec=new Yr(t.utf8Encoder,t.utf8Decoder),this.systemClockOffsetProvider=async()=>t.systemClockOffset??0}async handle(t,r,n={}){let o=r.request,{body:s,headers:i,query:a}=o;if(!(s instanceof ReadableStream))throw new Error("Eventstream payload must be a ReadableStream.");let c=new TransformStream;o.body=c.readable;let l;try{l=await t(r)}catch(h){throw o.body.cancel(),h}let p=((i.authorization||"").match(/Signature=([\w]+)$/)||[])[1]||a&&a["X-Amz-Signature"]||"",d=Wf(p,await this.messageSigner(),this.eventStreamCodec,this.systemClockOffsetProvider);return s.pipeThrough(d).pipeThrough(c),l}};var Yf=e=>new Us(e);var Ls=e=>e.protocol==="ws:"||e.protocol==="wss:";var Fs=class{signer;constructor(t){this.signer=t.signer}presign(t,r={}){return this.signer.presign(t,r)}async sign(t,r){return L.isInstance(t)&&Ls(t)?{...await this.signer.presign({...t,body:""},{...r,expiresIn:60,unsignableHeaders:new Set(Object.keys(t.headers).filter(o=>o!=="host"))}),body:t.body}:this.signer.sign(t,r)}};var Qf=e=>{let{signer:t}=e;return Object.assign(e,{signer:async r=>{let n=await t(r);if(QE(n))return new Fs({signer:n});throw new Error("Expected WebsocketSignatureV4 signer, please check the client constructor.")}})},QE=e=>!!e;function Xf(e){let{port:t,query:r}=e,{protocol:n,path:o,hostname:s}=e;n&&n.slice(-1)!==":"&&(n+=":"),t&&(s+=`:${t}`),o&&o.charAt(0)!=="/"&&(o=`/${o}`);let i=r?as(r):"";i&&i[0]!=="?"&&(i=`?${i}`);let a="";if(e.username!=null||e.password!=null){let l=e.username??"",f=e.password??"";a=`${l}:${f}@`}let c="";return e.fragment&&(c=`#${e.fragment}`),`${n}//${a}${s}${o}${i}${c}`}function Zf(e){let t=0,r=0,n=null,o=null,s=a=>{if(typeof a!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+a);t=a,r=4,n=new Uint8Array(a),new DataView(n.buffer).setUint32(0,a,!1)},i=async function*(){let a=e[Symbol.asyncIterator]();for(;;){let{value:c,done:l}=await a.next();if(l){if(t)if(t===r)yield n;else throw new Error("Truncated event message received.");else return;return}let f=c.length,p=0;for(;p<f;){if(!n){let m=f-p;o||(o=new Uint8Array(4));let h=Math.min(4-r,m);if(o.set(c.slice(p,p+h),r),r+=h,p+=h,r<4)break;s(new DataView(o.buffer).getUint32(0,!1)),o=null}let d=Math.min(t-r,f-p);n.set(c.slice(p,p+d),r),r+=d,p+=d,t&&t===r&&(yield n,n=null,t=0,r=0)}}};return{[Symbol.asyncIterator]:i}}function em(e,t){return async function(r){let{value:n}=r.headers[":message-type"];if(n==="error"){let o=new Error(r.headers[":error-message"].value||"UnknownError");throw o.name=r.headers[":error-code"].value,o}else if(n==="exception"){let o=r.headers[":exception-type"].value,s={[o]:r},i=await e(s);if(i.$unknown){let a=new Error(t(r.body));throw a.name=o,a}throw i[o]}else if(n==="event"){let o={[r.headers[":event-type"].value]:r},s=await e(o);return s.$unknown?void 0:s}else throw Error(`Unrecognizable event type: ${r.headers[":event-type"].value}`)}}var mo=class{constructor({utf8Encoder:t,utf8Decoder:r}){this.eventStreamCodec=new Yr(t,r),this.utfEncoder=t}deserialize(t,r){let n=Zf(t);return new Bs({messageStream:new Ms({inputStream:n,decoder:this.eventStreamCodec}),deserializer:em(r,this.utfEncoder)})}serialize(t,r){return new Ds({messageStream:new $s({inputStream:t,serializer:r}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};var Hs=e=>({[Symbol.asyncIterator]:async function*(){let t=e.getReader();try{for(;;){let{done:r,value:n}=await t.read();if(r)return;yield n}}finally{t.releaseLock()}}}),js=e=>{let t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(r){let{done:n,value:o}=await t.next();if(n)return r.close();r.enqueue(o)}})};var Ks=class{constructor({utf8Encoder:t,utf8Decoder:r}){this.universalMarshaller=new mo({utf8Decoder:r,utf8Encoder:t})}deserialize(t,r){let n=XE(t)?Hs(t):t;return this.universalMarshaller.deserialize(n,r)}serialize(t,r){let n=this.universalMarshaller.serialize(t,r);return typeof ReadableStream=="function"?js(n):n}},XE=e=>typeof ReadableStream=="function"&&e instanceof ReadableStream;var tm=e=>new Ks(e);var ZE=2e3,Qr=class{metadata={handlerProtocol:"websocket/h1.1"};config;configPromise;httpHandler;sockets={};static create(t,r=new vt){return typeof t?.handle=="function"?t:new Qr(t,r)}constructor(t,r=new vt){this.httpHandler=r,typeof t=="function"?(this.config={},this.configPromise=t().then(n=>this.config=n??{})):(this.config=t??{},this.configPromise=Promise.resolve(this.config))}destroy(){for(let[t,r]of Object.entries(this.sockets)){for(let n of r)n.close(1e3,"Socket closed through destroy() call");delete this.sockets[t]}}async handle(t){if(!Ls(t))return this.httpHandler.handle(t);let r=Xf(t),n=new WebSocket(r);this.sockets[r]||(this.sockets[r]=[]),this.sockets[r].push(n),n.binaryType="arraybuffer",this.config=await this.configPromise;let{connectionTimeout:o=ZE}=this.config;await this.waitForReady(n,o);let{body:s}=t,i=e0(s),a=this.connect(n,i),c=t0(a);return{response:new we({statusCode:200,body:c})}}updateHttpClientConfig(t,r){this.configPromise=this.configPromise.then(n=>(n[t]=r,n))}httpHandlerConfigs(){return this.config??{}}removeNotUsableSockets(t){this.sockets[t]=(this.sockets[t]??[]).filter(r=>![WebSocket.CLOSING,WebSocket.CLOSED].includes(r.readyState))}waitForReady(t,r){return new Promise((n,o)=>{let s=setTimeout(()=>{this.removeNotUsableSockets(t.url),o({$metadata:{httpStatusCode:500}})},r);t.onopen=()=>{clearTimeout(s),n()}})}connect(t,r){let n,o=!1,s=()=>{},i=()=>{};t.onmessage=l=>{i({done:!1,value:new Uint8Array(l.data)})},t.onerror=l=>{o=!0,t.close(),s(l)},t.onclose=()=>{this.removeNotUsableSockets(t.url),!o&&(n?s(n):i({done:!0,value:void 0}))};let a={[Symbol.asyncIterator]:()=>({next:()=>new Promise((l,f)=>{i=l,s=f})})};return(async()=>{try{for await(let l of r)t.send(l)}catch(l){n=l}finally{t.close(1e3)}})(),a}},e0=e=>e[Symbol.asyncIterator]?e:r0(e)?Hs(e):{[Symbol.asyncIterator]:async function*(){yield e}},t0=e=>typeof ReadableStream=="function"?js(e):e,r0=e=>typeof ReadableStream=="function"&&e instanceof ReadableStream;var Gs;(function(e){e.ENV="env",e.CONFIG="shared config entry"})(Gs||(Gs={}));var rm=!1;var nm=!1;var Vs=e=>typeof e=="string"&&(e.startsWith("fips-")||e.endsWith("-fips"));var Wi=e=>Vs(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e;var om=e=>{let{region:t,useFipsEndpoint:r}=e;if(!t)throw new Error("Region is missing");return Object.assign(e,{region:async()=>{if(typeof t=="string")return Wi(t);let n=await t();return Wi(n)},useFipsEndpoint:async()=>{let n=typeof t=="string"?t:await t();return Vs(n)?!0:typeof r!="function"?Promise.resolve(!!r):r()}})};var sm=e=>Object.assign(e,{eventStreamMarshaller:e.eventStreamSerdeProvider(e)});var am="content-length";function o0(e){return t=>async r=>{let n=r.request;if(L.isInstance(n)){let{body:o,headers:s}=n;if(o&&Object.keys(s).map(i=>i.toLowerCase()).indexOf(am)===-1)try{let i=e(o);n.headers={...n.headers,[am]:String(i)}}catch{}}return t({...r,request:n})}}var s0={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},im=e=>({applyToStack:t=>{t.add(o0(e.bodyLengthChecker),s0)}});var cm=async e=>{let t=e?.Bucket||"";if(typeof e.Bucket=="string"&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),u0(t)){if(e.ForcePathStyle===!0)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!l0(t)||t.indexOf(".")!==-1&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e},a0=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,i0=/(\d+\.){3}\d+/,c0=/\.\./;var l0=e=>a0.test(e)&&!i0.test(e)&&!c0.test(e),u0=e=>{let[t,r,n,,,o]=e.split(":"),s=t==="arn"&&e.split(":").length>=6,i=Boolean(s&&r&&n&&o);if(s&&!i)throw new Error(`Invalid ARN: ${e} was an invalid ARN.`);return i};var lm=(e,t,r)=>{let n=async()=>{let o=r[e]??r[t];return typeof o=="function"?o():o};return e==="credentialScope"||t==="CredentialScope"?async()=>{let o=typeof r.credentials=="function"?await r.credentials():r.credentials;return o?.credentialScope??o?.CredentialScope}:e==="accountId"||t==="AccountId"?async()=>{let o=typeof r.credentials=="function"?await r.credentials():r.credentials;return o?.accountId??o?.AccountId}:e==="endpoint"||t==="endpoint"?async()=>{if(r.isCustomEndpoint===!1)return;let o=await n();if(o&&typeof o=="object"){if("url"in o)return o.url.href;if("hostname"in o){let{protocol:s,hostname:i,port:a,path:c}=o;return`${s}//${i}${a?":"+a:""}${c}`}}return o}:n};var qs=async e=>{};var Js=e=>typeof e=="object"?"url"in e?lr(e.url):e:lr(e);var um=async(e,t,r,n)=>{if(!r.isCustomEndpoint){let i;r.serviceConfiguredEndpoint?i=await r.serviceConfiguredEndpoint():i=await qs(r.serviceId),i&&(r.endpoint=()=>Promise.resolve(Js(i)),r.isCustomEndpoint=!0)}let o=await d0(e,t,r);if(typeof r.endpointProvider!="function")throw new Error("config.endpointProvider is not set.");return r.endpointProvider(o,n)},d0=async(e,t,r)=>{let n={},o=t?.getEndpointParameterInstructions?.()||{};for(let[s,i]of Object.entries(o))switch(i.type){case"staticContextParams":n[s]=i.value;break;case"contextParams":n[s]=e[i.name];break;case"clientContextParams":case"builtInParams":n[s]=await lm(i.name,s,r)();break;case"operationContextParams":n[s]=i.get(e);break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(i))}return Object.keys(o).length===0&&Object.assign(n,r),String(r.serviceId).toLowerCase()==="s3"&&await cm(n),n};var dm=({config:e,instructions:t})=>(r,n)=>async o=>{e.isCustomEndpoint&&Ep(n,"ENDPOINT_OVERRIDE","N");let s=await um(o.input,{getEndpointParameterInstructions(){return t}},{...e},n);n.endpointV2=s,n.authSchemes=s.properties?.authSchemes;let i=n.authSchemes?.[0];if(i){n.signing_region=i.signingRegion,n.signing_service=i.signingName;let c=Ot(n)?.selectedHttpAuthScheme?.httpAuthOption;c&&(c.signingProperties=Object.assign(c.signingProperties||{},{signing_region:i.signingRegion,signingRegion:i.signingRegion,signing_service:i.signingName,signingName:i.signingName,signingRegionSet:i.signingRegionSet},i.properties))}return r({...o})};var p0={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:hi.name},Xr=(e,t)=>({applyToStack:r=>{r.addRelativeTo(dm({config:e,instructions:t}),p0)}});var pm=e=>{let t=e.tls??!0,{endpoint:r,useDualstackEndpoint:n,useFipsEndpoint:o}=e,s=r!=null?async()=>Js(await ge(r)()):void 0,a=Object.assign(e,{endpoint:s,tls:t,isCustomEndpoint:!!r,useDualstackEndpoint:ge(n??!1),useFipsEndpoint:ge(o??!1)}),c;return a.serviceConfiguredEndpoint=async()=>(e.serviceId&&!c&&(c=qs(e.serviceId)),c),a};var We;(function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"})(We||(We={}));var Ut=3,Yi=We.STANDARD;var fm=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],mm=["TimeoutError","RequestTimeout","RequestTimeoutException"],hm=[500,502,503,504],gm=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],ym=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"];var f0=e=>e.$metadata?.clockSkewCorrected,m0=e=>{let t=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return e&&e instanceof TypeError?t.has(e.message):!1},Zr=e=>e.$metadata?.httpStatusCode===429||fm.includes(e.name)||e.$retryable?.throttling==!0,ho=(e,t=0)=>f0(e)||mm.includes(e.name)||gm.includes(e?.code||"")||ym.includes(e?.code||"")||hm.includes(e.$metadata?.httpStatusCode||0)||m0(e)||e.cause!==void 0&&t<=10&&ho(e.cause,t+1),vm=e=>{if(e.$metadata?.httpStatusCode!==void 0){let t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!ho(e)}return!1};var Lt=class{constructor(t){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=t?.beta??.7,this.minCapacity=t?.minCapacity??1,this.minFillRate=t?.minFillRate??.5,this.scaleConstant=t?.scaleConstant??.4,this.smooth=t?.smooth??.8;let r=this.getCurrentTimeInSeconds();this.lastThrottleTime=r,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(t){if(this.enabled){if(this.refillTokenBucket(),t>this.currentCapacity){let r=(t-this.currentCapacity)/this.fillRate*1e3;await new Promise(n=>Lt.setTimeoutFn(n,r))}this.currentCapacity=this.currentCapacity-t}}refillTokenBucket(){let t=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=t;return}let r=(t-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+r),this.lastTimestamp=t}updateClientSendingRate(t){let r;if(this.updateMeasuredRate(),Zr(t)){let o=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=o,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),r=this.cubicThrottle(o),this.enableTokenBucket()}else this.calculateTimeWindow(),r=this.cubicSuccess(this.getCurrentTimeInSeconds());let n=Math.min(r,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(t){return this.getPrecise(t*this.beta)}cubicSuccess(t){return this.getPrecise(this.scaleConstant*Math.pow(t-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(t){this.refillTokenBucket(),this.fillRate=Math.max(t,this.minFillRate),this.maxCapacity=Math.max(t,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){let t=this.getCurrentTimeInSeconds(),r=Math.floor(t*2)/2;if(this.requestCount++,r>this.lastTxRateBucket){let n=this.requestCount/(r-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(n*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=r}}getPrecise(t){return parseFloat(t.toFixed(8))}};Lt.setTimeoutFn=setTimeout;var zs="amz-sdk-invocation-id",Ws="amz-sdk-request";var bm=()=>{let e=100;return{computeNextBackoffDelay:n=>Math.floor(Math.min(2e4,Math.random()*2**n*e)),setDelayBase:n=>{e=n}}};var Qi=({retryDelay:e,retryCount:t,retryCost:r})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(2e4,e),getRetryCost:()=>r});var fr=class{constructor(t){this.maxAttempts=t,this.mode=We.STANDARD,this.capacity=500,this.retryBackoffStrategy=bm(),this.maxAttemptsProvider=typeof t=="function"?t:async()=>t}async acquireInitialRetryToken(t){return Qi({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(t,r){let n=await this.getMaxAttempts();if(this.shouldRetry(t,r,n)){let o=r.errorType;this.retryBackoffStrategy.setDelayBase(o==="THROTTLING"?500:100);let s=this.retryBackoffStrategy.computeNextBackoffDelay(t.getRetryCount()),i=r.retryAfterHint?Math.max(r.retryAfterHint.getTime()-Date.now()||0,s):s,a=this.getCapacityCost(o);return this.capacity-=a,Qi({retryDelay:i,retryCount:t.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(t){this.capacity=Math.max(500,this.capacity+(t.getRetryCost()??1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${Ut}`),Ut}}shouldRetry(t,r,n){return t.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(r.errorType)&&this.isRetryableError(r.errorType)}getCapacityCost(t){return t==="TRANSIENT"?10:5}isRetryableError(t){return t==="THROTTLING"||t==="TRANSIENT"}};var Qs=class{constructor(t,r){this.maxAttemptsProvider=t,this.mode=We.ADAPTIVE;let{rateLimiter:n}=r??{};this.rateLimiter=n??new Lt,this.standardRetryStrategy=new fr(t)}async acquireInitialRetryToken(t){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(t)}async refreshRetryTokenForRetry(t,r){return this.rateLimiter.updateClientSendingRate(r),this.standardRetryStrategy.refreshRetryTokenForRetry(t,r)}recordSuccess(t){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(t)}};var Xs,h0=new Uint8Array(16);function Zi(){if(!Xs&&(Xs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xs(h0)}var le=[];for(let e=0;e<256;++e)le.push((e+256).toString(16).slice(1));function Sm(e,t=0){return le[e[t+0]]+le[e[t+1]]+le[e[t+2]]+le[e[t+3]]+"-"+le[e[t+4]]+le[e[t+5]]+"-"+le[e[t+6]]+le[e[t+7]]+"-"+le[e[t+8]]+le[e[t+9]]+"-"+le[e[t+10]]+le[e[t+11]]+le[e[t+12]]+le[e[t+13]]+le[e[t+14]]+le[e[t+15]]}var g0=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ec={randomUUID:g0};function y0(e,t,r){if(ec.randomUUID&&!t&&!e)return ec.randomUUID();e=e||{};let n=e.random||(e.rng||Zi)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let o=0;o<16;++o)t[r+o]=n[o];return t}return Sm(n)}var tc=y0;var rc=e=>e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):typeof e=="string"?new Error(e):new Error(`AWS SDK error wrapper for ${e}`);var Am=e=>{let{retryStrategy:t,retryMode:r,maxAttempts:n}=e,o=ge(n??Ut);return Object.assign(e,{maxAttempts:o,retryStrategy:async()=>t||(await ge(r)()===We.ADAPTIVE?new Qs(o):new fr(o))})};var km=e=>e?.body instanceof ReadableStream;var v0=e=>(t,r)=>async n=>{let o=await e.retryStrategy(),s=await e.maxAttempts();if(b0(o)){o=o;let i=await o.acquireInitialRetryToken(r.partition_id),a=new Error,c=0,l=0,{request:f}=n,p=L.isInstance(f);for(p&&(f.headers[zs]=tc());;)try{p&&(f.headers[Ws]=`attempt=${c+1}; max=${s}`);let{response:d,output:m}=await t(n);return o.recordSuccess(i),m.$metadata.attempts=c+1,m.$metadata.totalRetryDelay=l,{response:d,output:m}}catch(d){let m=x0(d);if(a=rc(d),p&&km(f))throw(r.logger instanceof Wr?console:r.logger)?.warn("An error was encountered in a non-retryable streaming request."),a;try{i=await o.refreshRetryTokenForRetry(i,m)}catch{throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=c+1,a.$metadata.totalRetryDelay=l,a}c=i.getRetryCount();let h=i.getRetryDelay();l+=h,await new Promise(y=>setTimeout(y,h))}}else return o=o,o?.mode&&(r.userAgent=[...r.userAgent||[],["cfg/retry-mode",o.mode]]),o.retry(t,n)},b0=e=>typeof e.acquireInitialRetryToken<"u"&&typeof e.refreshRetryTokenForRetry<"u"&&typeof e.recordSuccess<"u",x0=e=>{let t={error:e,errorType:w0(e)},r=E0(e.$response);return r&&(t.retryAfterHint=r),t},w0=e=>Zr(e)?"THROTTLING":ho(e)?"TRANSIENT":vm(e)?"SERVER_ERROR":"CLIENT_ERROR",_0={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Tm=e=>({applyToStack:t=>{t.add(v0(e),_0)}}),E0=e=>{if(!we.isInstance(e))return;let t=Object.keys(e.headers).find(s=>s.toLowerCase()==="retry-after");if(!t)return;let r=e.headers[t],n=Number(r);return Number.isNaN(n)?new Date(r):new Date(n*1e3)};var Im=async(e,t,r)=>({operation:Ot(t).operation,region:await ge(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function S0(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:e.region},propertiesExtractor:(t,r)=>({signingProperties:{config:t,context:r}})}}function A0(e){return{schemeId:"smithy.api#httpBearerAuth",propertiesExtractor:({profile:t,filepath:r,configFilepath:n,ignoreCache:o},s)=>({identityProperties:{profile:t,filepath:r,configFilepath:n,ignoreCache:o}})}}var Cm=e=>{let t=[];switch(e.operation){default:t.push(S0(e)),t.push(A0(e))}return t},Rm=e=>{let t=fs(e.token,ps,no),r=bf(e);return Object.assign(r,{authSchemePreference:ge(e.authSchemePreference??[]),token:t})};var Om=e=>Object.assign(e,{useDualstackEndpoint:e.useDualstackEndpoint??!1,useFipsEndpoint:e.useFipsEndpoint??!1,defaultSigningName:"bedrock"}),tn={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var Pm={name:"@aws-sdk/client-bedrock-runtime",description:"AWS SDK for JavaScript Bedrock Runtime Client for Node.js, Browser and React Native",version:"3.848.0",scripts:{build:"concurrently 'yarn:build:cjs' 'yarn:build:es' 'yarn:build:types'","build:cjs":"node ../../scripts/compilation/inline client-bedrock-runtime","build:es":"tsc -p tsconfig.es.json","build:include:deps":"lerna run --scope $npm_package_name --include-dependencies build","build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"rimraf ./dist-* && rimraf *.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo bedrock-runtime"},main:"./dist-cjs/index.js",types:"./dist-types/index.d.ts",module:"./dist-es/index.js",sideEffects:!1,dependencies:{"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"3.846.0","@aws-sdk/credential-provider-node":"3.848.0","@aws-sdk/eventstream-handler-node":"3.840.0","@aws-sdk/middleware-eventstream":"3.840.0","@aws-sdk/middleware-host-header":"3.840.0","@aws-sdk/middleware-logger":"3.840.0","@aws-sdk/middleware-recursion-detection":"3.840.0","@aws-sdk/middleware-user-agent":"3.848.0","@aws-sdk/middleware-websocket":"3.844.0","@aws-sdk/region-config-resolver":"3.840.0","@aws-sdk/token-providers":"3.848.0","@aws-sdk/types":"3.840.0","@aws-sdk/util-endpoints":"3.848.0","@aws-sdk/util-user-agent-browser":"3.840.0","@aws-sdk/util-user-agent-node":"3.848.0","@smithy/config-resolver":"^4.1.4","@smithy/core":"^3.7.0","@smithy/eventstream-serde-browser":"^4.0.4","@smithy/eventstream-serde-config-resolver":"^4.1.2","@smithy/eventstream-serde-node":"^4.0.4","@smithy/fetch-http-handler":"^5.1.0","@smithy/hash-node":"^4.0.4","@smithy/invalid-dependency":"^4.0.4","@smithy/middleware-content-length":"^4.0.4","@smithy/middleware-endpoint":"^4.1.15","@smithy/middleware-retry":"^4.1.16","@smithy/middleware-serde":"^4.0.8","@smithy/middleware-stack":"^4.0.4","@smithy/node-config-provider":"^4.1.3","@smithy/node-http-handler":"^4.1.0","@smithy/protocol-http":"^5.1.2","@smithy/smithy-client":"^4.4.7","@smithy/types":"^4.3.1","@smithy/url-parser":"^4.0.4","@smithy/util-base64":"^4.0.0","@smithy/util-body-length-browser":"^4.0.0","@smithy/util-body-length-node":"^4.0.0","@smithy/util-defaults-mode-browser":"^4.0.23","@smithy/util-defaults-mode-node":"^4.0.23","@smithy/util-endpoints":"^3.0.6","@smithy/util-middleware":"^4.0.4","@smithy/util-retry":"^4.0.6","@smithy/util-stream":"^4.2.3","@smithy/util-utf8":"^4.0.0","@types/uuid":"^9.0.1",tslib:"^2.6.2",uuid:"^9.0.1"},devDependencies:{"@tsconfig/node18":"18.2.4","@types/node":"^18.19.69",concurrently:"7.0.0","downlevel-dts":"0.10.1",rimraf:"3.0.2",typescript:"~5.8.3"},engines:{node:">=18.0.0"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["dist-*/**"],author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",browser:{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-bedrock-runtime",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-bedrock-runtime"}};var nc={name:"SHA-256"},oc={name:"HMAC",hash:nc},Nm=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);var T0={};function rn(){return typeof window<"u"?window:typeof self<"u"?self:T0}var sc=function(){function e(t){this.toHash=new Uint8Array(0),this.secret=t,this.reset()}return e.prototype.update=function(t){if(!Dt(t)){var r=ze(t),n=new Uint8Array(this.toHash.byteLength+r.byteLength);n.set(this.toHash,0),n.set(r,this.toHash.byteLength),this.toHash=n}},e.prototype.digest=function(){var t=this;return this.key?this.key.then(function(r){return rn().crypto.subtle.sign(oc,r,t.toHash).then(function(n){return new Uint8Array(n)})}):Dt(this.toHash)?Promise.resolve(Nm):Promise.resolve().then(function(){return rn().crypto.subtle.digest(nc,t.toHash)}).then(function(r){return Promise.resolve(new Uint8Array(r))})},e.prototype.reset=function(){var t=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(r,n){rn().crypto.subtle.importKey("raw",ze(t.secret),oc,!1,["sign"]).then(r,n)}),this.key.catch(function(){}))},e}();var Ee=64,Mm=32,Dm=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Bm=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],$m=Math.pow(2,53)-1;var go=function(){function e(){this.state=Int32Array.from(Bm),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var r=0,n=t.byteLength;if(this.bytesHashed+=n,this.bytesHashed*8>$m)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;n>0;)this.buffer[this.bufferLength++]=t[r++],n--,this.bufferLength===Ee&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var t=this.bytesHashed*8,r=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),n=this.bufferLength;if(r.setUint8(this.bufferLength++,128),n%Ee>=Ee-8){for(var o=this.bufferLength;o<Ee;o++)r.setUint8(o,0);this.hashBuffer(),this.bufferLength=0}for(var o=this.bufferLength;o<Ee-8;o++)r.setUint8(o,0);r.setUint32(Ee-8,Math.floor(t/4294967296),!0),r.setUint32(Ee-4,t),this.hashBuffer(),this.finished=!0}for(var s=new Uint8Array(Mm),o=0;o<8;o++)s[o*4]=this.state[o]>>>24&255,s[o*4+1]=this.state[o]>>>16&255,s[o*4+2]=this.state[o]>>>8&255,s[o*4+3]=this.state[o]>>>0&255;return s},e.prototype.hashBuffer=function(){for(var t=this,r=t.buffer,n=t.state,o=n[0],s=n[1],i=n[2],a=n[3],c=n[4],l=n[5],f=n[6],p=n[7],d=0;d<Ee;d++){if(d<16)this.temp[d]=(r[d*4]&255)<<24|(r[d*4+1]&255)<<16|(r[d*4+2]&255)<<8|r[d*4+3]&255;else{var m=this.temp[d-2],h=(m>>>17|m<<15)^(m>>>19|m<<13)^m>>>10;m=this.temp[d-15];var y=(m>>>7|m<<25)^(m>>>18|m<<14)^m>>>3;this.temp[d]=(h+this.temp[d-7]|0)+(y+this.temp[d-16]|0)}var g=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&l^~c&f)|0)+(p+(Dm[d]+this.temp[d]|0)|0)|0,v=((o>>>2|o<<30)^(o>>>13|o<<19)^(o>>>22|o<<10))+(o&s^o&i^s&i)|0;p=f,f=l,l=c,c=a+g|0,a=i,i=s,s=o,o=g+v|0}n[0]+=o,n[1]+=s,n[2]+=i,n[3]+=a,n[4]+=c,n[5]+=l,n[6]+=f,n[7]+=p},e}();var Um=function(){function e(t){this.secret=t,this.hash=new go,this.reset()}return e.prototype.update=function(t){if(!(Dt(t)||this.error))try{this.hash.update(ze(t))}catch(r){this.error=r}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return Os(this,void 0,void 0,function(){return Ps(this,function(t){return[2,this.digestSync()]})})},e.prototype.reset=function(){if(this.hash=new go,this.secret){this.outer=new go;var t=I0(this.secret),r=new Uint8Array(Ee);r.set(t);for(var n=0;n<Ee;n++)t[n]^=54,r[n]^=92;this.hash.update(t),this.outer.update(r);for(var n=0;n<t.byteLength;n++)t[n]=0}},e}();function I0(e){var t=ze(e);if(t.byteLength>Ee){var r=new go;r.update(t),t=r.digest()}var n=new Uint8Array(Ee);return n.set(t),n}var C0=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function Lm(e){if(R0(e)&&typeof e.crypto.subtle=="object"){var t=e.crypto.subtle;return O0(t)}return!1}function R0(e){if(typeof e=="object"&&typeof e.crypto=="object"){var t=e.crypto.getRandomValues;return typeof t=="function"}return!1}function O0(e){return e&&C0.every(function(t){return typeof e[t]=="function"})}var Fm=function(){function e(t){Lm(rn())?this.hash=new sc(t):this.hash=new Um(t)}return e.prototype.update=function(t,r){this.hash.update(ze(t))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}();var Hm=ct(ic()),jm=({serviceId:e,clientVersion:t})=>async r=>{let n=typeof window<"u"&&window?.navigator?.userAgent?Hm.default.parse(window.navigator.userAgent):void 0,o=[["aws-sdk-js",t],["ua","2.1"],[`os/${n?.os?.name||"other"}`,n?.os?.version],["lang/js"],["md/browser",`${n?.browser?.name??"unknown"}_${n?.browser?.version??"unknown"}`]];e&&o.push([`api/${e}`,t]);let s=await r?.userAgentAppId?.();return s&&o.push([`app/${s}`]),o};var Km=e=>()=>Promise.reject(e);var Zm="required",st="fn",at="argv",on="ref";var Gm="isSet",bo="booleanEquals",nn="error",vo="endpoint",ve="tree",cc="PartitionResult",Vm={[Zm]:!1,type:"String"},qm={[Zm]:!0,default:!1,type:"Boolean"},Jm={[on]:"Endpoint"},eh={[st]:bo,[at]:[{[on]:"UseFIPS"},!0]},th={[st]:bo,[at]:[{[on]:"UseDualStack"},!0]},ot={},zm={[st]:"getAttr",[at]:[{[on]:cc},"supportsFIPS"]},Wm={[st]:bo,[at]:[!0,{[st]:"getAttr",[at]:[{[on]:cc},"supportsDualStack"]}]},Ym=[eh],Qm=[th],Xm=[{[on]:"Region"}],P0={version:"1.0",parameters:{Region:Vm,UseDualStack:qm,UseFIPS:qm,Endpoint:Vm},rules:[{conditions:[{[st]:Gm,[at]:[Jm]}],rules:[{conditions:Ym,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:nn},{rules:[{conditions:Qm,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:nn},{endpoint:{url:Jm,properties:ot,headers:ot},type:vo}],type:ve}],type:ve},{rules:[{conditions:[{[st]:Gm,[at]:Xm}],rules:[{conditions:[{[st]:"aws.partition",[at]:Xm,assign:cc}],rules:[{conditions:[eh,th],rules:[{conditions:[{[st]:bo,[at]:[!0,zm]},Wm],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:ot,headers:ot},type:vo}],type:ve}],type:ve},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:nn}],type:ve},{conditions:Ym,rules:[{conditions:[{[st]:bo,[at]:[zm,!0]}],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:ot,headers:ot},type:vo}],type:ve}],type:ve},{error:"FIPS is enabled but this partition does not support FIPS",type:nn}],type:ve},{conditions:Qm,rules:[{conditions:[Wm],rules:[{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:ot,headers:ot},type:vo}],type:ve}],type:ve},{error:"DualStack is enabled but this partition does not support DualStack",type:nn}],type:ve},{rules:[{endpoint:{url:"https://bedrock-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:ot,headers:ot},type:vo}],type:ve}],type:ve}],type:ve},{error:"Invalid Configuration: Missing Region",type:nn}],type:ve}]},rh=P0;var N0=new ms({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),nh=(e,t={})=>N0.get(e,()=>ki(rh,{endpointParams:e,logger:t.logger}));cr.aws=Ii;var oh=e=>({apiVersion:"2023-09-30",base64Decoder:e?.base64Decoder??Gr,base64Encoder:e?.base64Encoder??Vr,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??nh,extensions:e?.extensions??[],httpAuthSchemeProvider:e?.httpAuthSchemeProvider??Cm,httpAuthSchemes:e?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4"),signer:new io},{schemeId:"smithy.api#httpBearerAuth",identityProvider:t=>t.getIdentityProvider("smithy.api#httpBearerAuth"),signer:new ds}],logger:e?.logger??new Wr,serviceId:e?.serviceId??"Bedrock Runtime",urlParser:e?.urlParser??lr,utf8Decoder:e?.utf8Decoder??Ge,utf8Encoder:e?.utf8Encoder??eo});var ah=ct(ic());var sh=["in-region","cross-region","mobile","standard","legacy"];var ih=({defaultsMode:e}={})=>Qp(async()=>{let t=typeof e=="function"?await e():e;switch(t?.toLowerCase()){case"auto":return Promise.resolve(M0()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${sh.join(", ")}, got ${t}`)}}),M0=()=>{let t=(typeof window<"u"&&window?.navigator?.userAgent?ah.default.parse(window.navigator.userAgent):void 0)?.platform?.type;return t==="tablet"||t==="mobile"};var ch=e=>{let t=ih(e),r=()=>t().then(Af),n=oh(e);return{...n,...e,runtime:"browser",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??wf,credentialDefaultProvider:e?.credentialDefaultProvider??(o=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:e?.defaultUserAgentProvider??jm({serviceId:n.serviceId,clientVersion:Pm.version}),eventStreamPayloadHandlerProvider:e?.eventStreamPayloadHandlerProvider??Yf,eventStreamSerdeProvider:e?.eventStreamSerdeProvider??tm,maxAttempts:e?.maxAttempts??Ut,region:e?.region??Km("Region is missing"),requestHandler:Qr.create(e?.requestHandler??r,vt.create(r)),retryMode:e?.retryMode??(async()=>(await r()).retryMode||Yi),sha256:e?.sha256??Fm,streamCollector:e?.streamCollector??vi,useDualstackEndpoint:e?.useDualstackEndpoint??(()=>Promise.resolve(rm)),useFipsEndpoint:e?.useFipsEndpoint??(()=>Promise.resolve(nm))}};var lh=e=>({setRegion(t){e.region=t},region(){return e.region}}),uh=e=>({region:e.region()});var dh=e=>{let t=e.httpAuthSchemes,r=e.httpAuthSchemeProvider,n=e.credentials,o=e.token;return{setHttpAuthScheme(s){let i=t.findIndex(a=>a.schemeId===s.schemeId);i===-1?t.push(s):t.splice(i,1,s)},httpAuthSchemes(){return t},setHttpAuthSchemeProvider(s){r=s},httpAuthSchemeProvider(){return r},setCredentials(s){n=s},credentials(){return n},setToken(s){o=s},token(){return o}}},ph=e=>({httpAuthSchemes:e.httpAuthSchemes(),httpAuthSchemeProvider:e.httpAuthSchemeProvider(),credentials:e.credentials(),token:e.token()});var fh=(e,t)=>{let r=Object.assign(lh(e),Rf(e),Xd(e),dh(e));return t.forEach(n=>n.configure(r)),Object.assign(e,uh(r),Of(r),Zd(r),ph(r))};var Zs=class extends Ts{config;constructor(...[t]){let r=ch(t||{});super(r),this.initConfig=r;let n=Om(r),o=Sp(n),s=Am(o),i=om(s),a=i,c=pm(a),l=sm(c),f=Rm(l),p=Qd(f),d=Qf(p),m=fh(d,t?.extensions||[]);this.config=m,this.middlewareStack.use(Hf(this.config)),this.middlewareStack.use(Tm(this.config)),this.middlewareStack.use(im(this.config)),this.middlewareStack.use(op(this.config)),this.middlewareStack.use(sp(this.config)),this.middlewareStack.use(ap(this.config)),this.middlewareStack.use(lp(this.config,{httpAuthSchemeParametersProvider:Im,identityProviderConfigProvider:async h=>new us({"aws.auth#sigv4":h.credentials,"smithy.api#httpBearerAuth":h.token})})),this.middlewareStack.use(fp(this.config))}destroy(){super.destroy()}};var se=class extends _t{constructor(t){super(t),Object.setPrototypeOf(this,se.prototype)}};var sn=class extends se{name="AccessDeniedException";$fault="client";constructor(t){super({name:"AccessDeniedException",$fault:"client",...t}),Object.setPrototypeOf(this,sn.prototype)}},mh;(function(e){e.visit=(t,r)=>t.s3OutputDataConfig!==void 0?r.s3OutputDataConfig(t.s3OutputDataConfig):r._(t.$unknown[0],t.$unknown[1])})(mh||(mh={}));var an=class extends se{name="InternalServerException";$fault="server";constructor(t){super({name:"InternalServerException",$fault:"server",...t}),Object.setPrototypeOf(this,an.prototype)}},cn=class extends se{name="ThrottlingException";$fault="client";constructor(t){super({name:"ThrottlingException",$fault:"client",...t}),Object.setPrototypeOf(this,cn.prototype)}},ln=class extends se{name="ValidationException";$fault="client";constructor(t){super({name:"ValidationException",$fault:"client",...t}),Object.setPrototypeOf(this,ln.prototype)}};var un=class extends se{name="ConflictException";$fault="client";constructor(t){super({name:"ConflictException",$fault:"client",...t}),Object.setPrototypeOf(this,un.prototype)}},dn=class extends se{name="ResourceNotFoundException";$fault="client";constructor(t){super({name:"ResourceNotFoundException",$fault:"client",...t}),Object.setPrototypeOf(this,dn.prototype)}},pn=class extends se{name="ServiceQuotaExceededException";$fault="client";constructor(t){super({name:"ServiceQuotaExceededException",$fault:"client",...t}),Object.setPrototypeOf(this,pn.prototype)}},fn=class extends se{name="ServiceUnavailableException";$fault="server";constructor(t){super({name:"ServiceUnavailableException",$fault:"server",...t}),Object.setPrototypeOf(this,fn.prototype)}};var lc;(function(e){e.visit=(t,r)=>t.bytes!==void 0?r.bytes(t.bytes):r._(t.$unknown[0],t.$unknown[1])})(lc||(lc={}));var uc;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):t.image!==void 0?r.image(t.image):r._(t.$unknown[0],t.$unknown[1])})(uc||(uc={}));var hh;(function(e){e.visit=(t,r)=>t.documentChar!==void 0?r.documentChar(t.documentChar):t.documentPage!==void 0?r.documentPage(t.documentPage):t.documentChunk!==void 0?r.documentChunk(t.documentChunk):r._(t.$unknown[0],t.$unknown[1])})(hh||(hh={}));var gh;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):r._(t.$unknown[0],t.$unknown[1])})(gh||(gh={}));var yh;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):r._(t.$unknown[0],t.$unknown[1])})(yh||(yh={}));var vh;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):r._(t.$unknown[0],t.$unknown[1])})(vh||(vh={}));var ea;(function(e){e.visit=(t,r)=>t.bytes!==void 0?r.bytes(t.bytes):t.s3Location!==void 0?r.s3Location(t.s3Location):t.text!==void 0?r.text(t.text):t.content!==void 0?r.content(t.content):r._(t.$unknown[0],t.$unknown[1])})(ea||(ea={}));var ta;(function(e){e.visit=(t,r)=>t.bytes!==void 0?r.bytes(t.bytes):r._(t.$unknown[0],t.$unknown[1])})(ta||(ta={}));var ra;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):t.image!==void 0?r.image(t.image):r._(t.$unknown[0],t.$unknown[1])})(ra||(ra={}));var na;(function(e){e.visit=(t,r)=>t.bytes!==void 0?r.bytes(t.bytes):t.s3Location!==void 0?r.s3Location(t.s3Location):r._(t.$unknown[0],t.$unknown[1])})(na||(na={}));var oa;(function(e){e.visit=(t,r)=>t.reasoningText!==void 0?r.reasoningText(t.reasoningText):t.redactedContent!==void 0?r.redactedContent(t.redactedContent):r._(t.$unknown[0],t.$unknown[1])})(oa||(oa={}));var sa;(function(e){e.visit=(t,r)=>t.bytes!==void 0?r.bytes(t.bytes):t.s3Location!==void 0?r.s3Location(t.s3Location):r._(t.$unknown[0],t.$unknown[1])})(sa||(sa={}));var aa;(function(e){e.visit=(t,r)=>t.json!==void 0?r.json(t.json):t.text!==void 0?r.text(t.text):t.image!==void 0?r.image(t.image):t.document!==void 0?r.document(t.document):t.video!==void 0?r.video(t.video):r._(t.$unknown[0],t.$unknown[1])})(aa||(aa={}));var ia;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):t.image!==void 0?r.image(t.image):t.document!==void 0?r.document(t.document):t.video!==void 0?r.video(t.video):t.toolUse!==void 0?r.toolUse(t.toolUse):t.toolResult!==void 0?r.toolResult(t.toolResult):t.guardContent!==void 0?r.guardContent(t.guardContent):t.cachePoint!==void 0?r.cachePoint(t.cachePoint):t.reasoningContent!==void 0?r.reasoningContent(t.reasoningContent):t.citationsContent!==void 0?r.citationsContent(t.citationsContent):r._(t.$unknown[0],t.$unknown[1])})(ia||(ia={}));var bh;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):r._(t.$unknown[0],t.$unknown[1])})(bh||(bh={}));var ca;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):t.guardContent!==void 0?r.guardContent(t.guardContent):t.cachePoint!==void 0?r.cachePoint(t.cachePoint):r._(t.$unknown[0],t.$unknown[1])})(ca||(ca={}));var xh;(function(e){e.visit=(t,r)=>t.auto!==void 0?r.auto(t.auto):t.any!==void 0?r.any(t.any):t.tool!==void 0?r.tool(t.tool):r._(t.$unknown[0],t.$unknown[1])})(xh||(xh={}));var la;(function(e){e.visit=(t,r)=>t.json!==void 0?r.json(t.json):r._(t.$unknown[0],t.$unknown[1])})(la||(la={}));var ua;(function(e){e.visit=(t,r)=>t.toolSpec!==void 0?r.toolSpec(t.toolSpec):t.cachePoint!==void 0?r.cachePoint(t.cachePoint):r._(t.$unknown[0],t.$unknown[1])})(ua||(ua={}));var wh;(function(e){e.visit=(t,r)=>t.message!==void 0?r.message(t.message):r._(t.$unknown[0],t.$unknown[1])})(wh||(wh={}));var mn=class extends se{name="ModelErrorException";$fault="client";originalStatusCode;resourceName;constructor(t){super({name:"ModelErrorException",$fault:"client",...t}),Object.setPrototypeOf(this,mn.prototype),this.originalStatusCode=t.originalStatusCode,this.resourceName=t.resourceName}},hn=class extends se{name="ModelNotReadyException";$fault="client";$retryable={};constructor(t){super({name:"ModelNotReadyException",$fault:"client",...t}),Object.setPrototypeOf(this,hn.prototype)}},gn=class extends se{name="ModelTimeoutException";$fault="client";constructor(t){super({name:"ModelTimeoutException",$fault:"client",...t}),Object.setPrototypeOf(this,gn.prototype)}};var _h;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):t.redactedContent!==void 0?r.redactedContent(t.redactedContent):t.signature!==void 0?r.signature(t.signature):r._(t.$unknown[0],t.$unknown[1])})(_h||(_h={}));var Eh;(function(e){e.visit=(t,r)=>t.text!==void 0?r.text(t.text):t.toolUse!==void 0?r.toolUse(t.toolUse):t.reasoningContent!==void 0?r.reasoningContent(t.reasoningContent):t.citation!==void 0?r.citation(t.citation):r._(t.$unknown[0],t.$unknown[1])})(Eh||(Eh={}));var Sh;(function(e){e.visit=(t,r)=>t.toolUse!==void 0?r.toolUse(t.toolUse):r._(t.$unknown[0],t.$unknown[1])})(Sh||(Sh={}));var yn=class extends se{name="ModelStreamErrorException";$fault="client";originalStatusCode;originalMessage;constructor(t){super({name:"ModelStreamErrorException",$fault:"client",...t}),Object.setPrototypeOf(this,yn.prototype),this.originalStatusCode=t.originalStatusCode,this.originalMessage=t.originalMessage}},Ah;(function(e){e.visit=(t,r)=>t.messageStart!==void 0?r.messageStart(t.messageStart):t.contentBlockStart!==void 0?r.contentBlockStart(t.contentBlockStart):t.contentBlockDelta!==void 0?r.contentBlockDelta(t.contentBlockDelta):t.contentBlockStop!==void 0?r.contentBlockStop(t.contentBlockStop):t.messageStop!==void 0?r.messageStop(t.messageStop):t.metadata!==void 0?r.metadata(t.metadata):t.internalServerException!==void 0?r.internalServerException(t.internalServerException):t.modelStreamErrorException!==void 0?r.modelStreamErrorException(t.modelStreamErrorException):t.validationException!==void 0?r.validationException(t.validationException):t.throttlingException!==void 0?r.throttlingException(t.throttlingException):t.serviceUnavailableException!==void 0?r.serviceUnavailableException(t.serviceUnavailableException):r._(t.$unknown[0],t.$unknown[1])})(Ah||(Ah={}));var dc;(function(e){e.visit=(t,r)=>t.chunk!==void 0?r.chunk(t.chunk):r._(t.$unknown[0],t.$unknown[1])})(dc||(dc={}));var kh;(function(e){e.visit=(t,r)=>t.chunk!==void 0?r.chunk(t.chunk):t.internalServerException!==void 0?r.internalServerException(t.internalServerException):t.modelStreamErrorException!==void 0?r.modelStreamErrorException(t.modelStreamErrorException):t.validationException!==void 0?r.validationException(t.validationException):t.throttlingException!==void 0?r.throttlingException(t.throttlingException):t.modelTimeoutException!==void 0?r.modelTimeoutException(t.modelTimeoutException):t.serviceUnavailableException!==void 0?r.serviceUnavailableException(t.serviceUnavailableException):r._(t.$unknown[0],t.$unknown[1])})(kh||(kh={}));var Th;(function(e){e.visit=(t,r)=>t.chunk!==void 0?r.chunk(t.chunk):t.internalServerException!==void 0?r.internalServerException(t.internalServerException):t.modelStreamErrorException!==void 0?r.modelStreamErrorException(t.modelStreamErrorException):t.validationException!==void 0?r.validationException(t.validationException):t.throttlingException!==void 0?r.throttlingException(t.throttlingException):t.modelTimeoutException!==void 0?r.modelTimeoutException(t.modelTimeoutException):t.serviceUnavailableException!==void 0?r.serviceUnavailableException(t.serviceUnavailableException):r._(t.$unknown[0],t.$unknown[1])})(Th||(Th={}));var Ih=e=>{if(e.text!==void 0)return{text:e.text};if(e.image!==void 0)return{image:wt};if(e.$unknown!==void 0)return{[e.$unknown[0]]:"UNKNOWN"}};var B0=e=>{if(e.text!==void 0)return{text:e.text};if(e.image!==void 0)return{image:e.image};if(e.document!==void 0)return{document:e.document};if(e.video!==void 0)return{video:e.video};if(e.toolUse!==void 0)return{toolUse:e.toolUse};if(e.toolResult!==void 0)return{toolResult:e.toolResult};if(e.guardContent!==void 0)return{guardContent:Ih(e.guardContent)};if(e.cachePoint!==void 0)return{cachePoint:e.cachePoint};if(e.reasoningContent!==void 0)return{reasoningContent:wt};if(e.citationsContent!==void 0)return{citationsContent:e.citationsContent};if(e.$unknown!==void 0)return{[e.$unknown[0]]:"UNKNOWN"}},pc=e=>({...e,...e.content&&{content:e.content.map(t=>B0(t))}}),Ch=e=>{if(e.text!==void 0)return{text:e.text};if(e.guardContent!==void 0)return{guardContent:Ih(e.guardContent)};if(e.cachePoint!==void 0)return{cachePoint:e.cachePoint};if(e.$unknown!==void 0)return{[e.$unknown[0]]:"UNKNOWN"}},Rh=e=>({...e,...e.messages&&{messages:e.messages.map(t=>pc(t))},...e.system&&{system:e.system.map(t=>Ch(t))},...e.toolConfig&&{toolConfig:e.toolConfig},...e.promptVariables&&{promptVariables:wt},...e.requestMetadata&&{requestMetadata:wt}}),$0=e=>{if(e.message!==void 0)return{message:pc(e.message)};if(e.$unknown!==void 0)return{[e.$unknown[0]]:"UNKNOWN"}},Oh=e=>({...e,...e.output&&{output:$0(e.output)}}),Ph=e=>({...e,...e.messages&&{messages:e.messages.map(t=>pc(t))},...e.system&&{system:e.system.map(t=>Ch(t))},...e.toolConfig&&{toolConfig:e.toolConfig},...e.promptVariables&&{promptVariables:wt},...e.requestMetadata&&{requestMetadata:wt}});var Nh=e=>({...e,...e.stream&&{stream:"STREAMING_CONTENT"}}),Mh=e=>({...e,...e.body&&{body:wt}}),Dh=e=>({...e,...e.body&&{body:wt}});var $h=async(e,t)=>{let r=ro(e,t),n={"content-type":"application/json"};r.bp("/model/{modelId}/converse"),r.p("modelId",()=>e.modelId,"{modelId}",!1);let o;return o=JSON.stringify(D(e,{additionalModelRequestFields:s=>xo(s,t),additionalModelResponseFieldPaths:s=>C(s),guardrailConfig:s=>C(s),inferenceConfig:s=>Qh(s,t),messages:s=>Xh(s,t),performanceConfig:s=>C(s),promptVariables:s=>C(s),requestMetadata:s=>C(s),system:s=>Zh(s,t),toolConfig:s=>eg(s,t)})),r.m("POST").h(n).b(o),r.build()},Uh=async(e,t)=>{let r=ro(e,t),n={"content-type":"application/json"};r.bp("/model/{modelId}/converse-stream"),r.p("modelId",()=>e.modelId,"{modelId}",!1);let o;return o=JSON.stringify(D(e,{additionalModelRequestFields:s=>xo(s,t),additionalModelResponseFieldPaths:s=>C(s),guardrailConfig:s=>C(s),inferenceConfig:s=>Qh(s,t),messages:s=>Xh(s,t),performanceConfig:s=>C(s),promptVariables:s=>C(s),requestMetadata:s=>C(s),system:s=>Zh(s,t),toolConfig:s=>eg(s,t)})),r.m("POST").h(n).b(o),r.build()};var Lh=async(e,t)=>{let r=ro(e,t),n=ae({},Pf,{[cg]:e[ig]||"application/octet-stream",[Bh]:e[Bh],[tA]:e[XS],[ZS]:e[YS],[eA]:e[QS],[ug]:e[lg]});r.bp("/model/{modelId}/invoke"),r.p("modelId",()=>e.modelId,"{modelId}",!1);let o;return e.body!==void 0&&(o=e.body),r.m("POST").h(n).b(o),r.build()};var Fh=async(e,t)=>{if(e.statusCode!==200&&e.statusCode>=300)return fc(e,t);let r=ae({$metadata:be(e)}),n=xp(wi(await _e(e.body,t)),"body"),o=D(n,{additionalModelResponseFields:s=>da(s,t),metrics:C,output:s=>kS($e(s),t),performanceConfig:C,stopReason:P,trace:s=>CS(s,t),usage:C});return Object.assign(r,o),r},Hh=async(e,t)=>{if(e.statusCode!==200&&e.statusCode>=300)return fc(e,t);let r=ae({$metadata:be(e)}),n=e.body;return r.stream=q0(n,t),r};var jh=async(e,t)=>{if(e.statusCode!==200&&e.statusCode>=300)return fc(e,t);let r=ae({$metadata:be(e),[ig]:[,e.headers[cg]],[lg]:[,e.headers[ug]]}),n=await to(e.body,t);return r.body=n,r};var fc=async(e,t)=>{let r={...e,body:await Df(e.body,t)},n=Bf(e,r.body);switch(n){case"AccessDeniedException":case"com.amazonaws.bedrockruntime#AccessDeniedException":throw await L0(r,t);case"InternalServerException":case"com.amazonaws.bedrockruntime#InternalServerException":throw await Kh(r,t);case"ResourceNotFoundException":case"com.amazonaws.bedrockruntime#ResourceNotFoundException":throw await G0(r,t);case"ServiceQuotaExceededException":case"com.amazonaws.bedrockruntime#ServiceQuotaExceededException":throw await V0(r,t);case"ThrottlingException":case"com.amazonaws.bedrockruntime#ThrottlingException":throw await qh(r,t);case"ValidationException":case"com.amazonaws.bedrockruntime#ValidationException":throw await Jh(r,t);case"ModelErrorException":case"com.amazonaws.bedrockruntime#ModelErrorException":throw await H0(r,t);case"ModelNotReadyException":case"com.amazonaws.bedrockruntime#ModelNotReadyException":throw await j0(r,t);case"ModelTimeoutException":case"com.amazonaws.bedrockruntime#ModelTimeoutException":throw await K0(r,t);case"ServiceUnavailableException":case"com.amazonaws.bedrockruntime#ServiceUnavailableException":throw await Vh(r,t);case"ModelStreamErrorException":case"com.amazonaws.bedrockruntime#ModelStreamErrorException":throw await Gh(r,t);case"ConflictException":case"com.amazonaws.bedrockruntime#ConflictException":throw await F0(r,t);default:let o=r.body;return U0({output:e,parsedBody:o,errorCode:n})}},U0=Sf(se),L0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new sn({$metadata:be(e),...r});return ye(s,e.body)},F0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new un({$metadata:be(e),...r});return ye(s,e.body)},Kh=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new an({$metadata:be(e),...r});return ye(s,e.body)},H0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P,originalStatusCode:ls,resourceName:P});Object.assign(r,o);let s=new mn({$metadata:be(e),...r});return ye(s,e.body)},j0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new hn({$metadata:be(e),...r});return ye(s,e.body)},Gh=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P,originalMessage:P,originalStatusCode:ls});Object.assign(r,o);let s=new yn({$metadata:be(e),...r});return ye(s,e.body)},K0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new gn({$metadata:be(e),...r});return ye(s,e.body)},G0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new dn({$metadata:be(e),...r});return ye(s,e.body)},V0=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new pn({$metadata:be(e),...r});return ye(s,e.body)},Vh=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new fn({$metadata:be(e),...r});return ye(s,e.body)},qh=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new cn({$metadata:be(e),...r});return ye(s,e.body)},Jh=async(e,t)=>{let r=ae({}),n=e.body,o=D(n,{message:P});Object.assign(r,o);let s=new ln({$metadata:be(e),...r});return ye(s,e.body)};var q0=(e,t)=>t.eventStreamMarshaller.deserialize(e,async r=>r.messageStart!=null?{messageStart:await X0(r.messageStart,t)}:r.contentBlockStart!=null?{contentBlockStart:await z0(r.contentBlockStart,t)}:r.contentBlockDelta!=null?{contentBlockDelta:await J0(r.contentBlockDelta,t)}:r.contentBlockStop!=null?{contentBlockStop:await W0(r.contentBlockStop,t)}:r.messageStop!=null?{messageStop:await Z0(r.messageStop,t)}:r.metadata!=null?{metadata:await Y0(r.metadata,t)}:r.internalServerException!=null?{internalServerException:await Q0(r.internalServerException,t)}:r.modelStreamErrorException!=null?{modelStreamErrorException:await eS(r.modelStreamErrorException,t)}:r.validationException!=null?{validationException:await nS(r.validationException,t)}:r.throttlingException!=null?{throttlingException:await rS(r.throttlingException,t)}:r.serviceUnavailableException!=null?{serviceUnavailableException:await tS(r.serviceUnavailableException,t)}:{$unknown:r});var J0=async(e,t)=>{let r={},n=await _e(e.body,t);return Object.assign(r,SS(n,t)),r},z0=async(e,t)=>{let r={},n=await _e(e.body,t);return Object.assign(r,C(n)),r},W0=async(e,t)=>{let r={},n=await _e(e.body,t);return Object.assign(r,C(n)),r},Y0=async(e,t)=>{let r={},n=await _e(e.body,t);return Object.assign(r,TS(n,t)),r},Q0=async(e,t)=>{let r={...e,body:await _e(e.body,t)};return Kh(r,t)},X0=async(e,t)=>{let r={},n=await _e(e.body,t);return Object.assign(r,C(n)),r},Z0=async(e,t)=>{let r={},n=await _e(e.body,t);return Object.assign(r,jS(n,t)),r},eS=async(e,t)=>{let r={...e,body:await _e(e.body,t)};return Gh(r,t)};var tS=async(e,t)=>{let r={...e,body:await _e(e.body,t)};return Vh(r,t)},rS=async(e,t)=>{let r={...e,body:await _e(e.body,t)};return qh(r,t)},nS=async(e,t)=>{let r={...e,body:await _e(e.body,t)};return Jh(r,t)};var oS=(e,t)=>ia.visit(e,{cachePoint:r=>({cachePoint:C(r)}),citationsContent:r=>({citationsContent:C(r)}),document:r=>({document:zh(r,t)}),guardContent:r=>({guardContent:Wh(r,t)}),image:r=>({image:Yh(r,t)}),reasoningContent:r=>({reasoningContent:dS(r,t)}),text:r=>({text:r}),toolResult:r=>({toolResult:hS(r,t)}),toolUse:r=>({toolUse:xS(r,t)}),video:r=>({video:tg(r,t)}),_:(r,n)=>({[r]:n})}),sS=(e,t)=>e.filter(r=>r!=null).map(r=>oS(r,t)),zh=(e,t)=>D(e,{citations:C,context:[],format:[],name:[],source:r=>aS(r,t)}),aS=(e,t)=>ea.visit(e,{bytes:r=>({bytes:t.base64Encoder(r)}),content:r=>({content:C(r)}),s3Location:r=>({s3Location:C(r)}),text:r=>({text:r}),_:(r,n)=>({[r]:n})});var Wh=(e,t)=>ra.visit(e,{image:r=>({image:iS(r,t)}),text:r=>({text:C(r)}),_:(r,n)=>({[r]:n})}),iS=(e,t)=>D(e,{format:[],source:r=>cS(r,t)}),cS=(e,t)=>ta.visit(e,{bytes:r=>({bytes:t.base64Encoder(r)}),_:(r,n)=>({[r]:n})});var Yh=(e,t)=>D(e,{format:[],source:r=>lS(r,t)}),lS=(e,t)=>na.visit(e,{bytes:r=>({bytes:t.base64Encoder(r)}),s3Location:r=>({s3Location:C(r)}),_:(r,n)=>({[r]:n})}),Qh=(e,t)=>D(e,{maxTokens:[],stopSequences:C,temperature:ji,topP:ji}),uS=(e,t)=>D(e,{content:r=>sS(r,t),role:[]}),Xh=(e,t)=>e.filter(r=>r!=null).map(r=>uS(r,t));var dS=(e,t)=>oa.visit(e,{reasoningText:r=>({reasoningText:C(r)}),redactedContent:r=>({redactedContent:t.base64Encoder(r)}),_:(r,n)=>({[r]:n})}),pS=(e,t)=>ca.visit(e,{cachePoint:r=>({cachePoint:C(r)}),guardContent:r=>({guardContent:Wh(r,t)}),text:r=>({text:r}),_:(r,n)=>({[r]:n})}),Zh=(e,t)=>e.filter(r=>r!=null).map(r=>pS(r,t)),fS=(e,t)=>ua.visit(e,{cachePoint:r=>({cachePoint:C(r)}),toolSpec:r=>({toolSpec:bS(r,t)}),_:(r,n)=>({[r]:n})}),eg=(e,t)=>D(e,{toolChoice:C,tools:r=>vS(r,t)}),mS=(e,t)=>la.visit(e,{json:r=>({json:xo(r,t)}),_:(r,n)=>({[r]:n})}),hS=(e,t)=>D(e,{content:r=>yS(r,t),status:[],toolUseId:[]}),gS=(e,t)=>aa.visit(e,{document:r=>({document:zh(r,t)}),image:r=>({image:Yh(r,t)}),json:r=>({json:xo(r,t)}),text:r=>({text:r}),video:r=>({video:tg(r,t)}),_:(r,n)=>({[r]:n})}),yS=(e,t)=>e.filter(r=>r!=null).map(r=>gS(r,t)),vS=(e,t)=>e.filter(r=>r!=null).map(r=>fS(r,t)),bS=(e,t)=>D(e,{description:[],inputSchema:r=>mS(r,t),name:[]}),xS=(e,t)=>D(e,{input:r=>xo(r,t),name:[],toolUseId:[]}),tg=(e,t)=>D(e,{format:[],source:r=>wS(r,t)}),wS=(e,t)=>sa.visit(e,{bytes:r=>({bytes:t.base64Encoder(r)}),s3Location:r=>({s3Location:C(r)}),_:(r,n)=>({[r]:n})}),xo=(e,t)=>e;var _S=(e,t)=>e.cachePoint!=null?{cachePoint:C(e.cachePoint)}:e.citationsContent!=null?{citationsContent:C(e.citationsContent)}:e.document!=null?{document:rg(e.document,t)}:e.guardContent!=null?{guardContent:$S($e(e.guardContent),t)}:e.image!=null?{image:sg(e.image,t)}:e.reasoningContent!=null?{reasoningContent:KS($e(e.reasoningContent),t)}:P(e.text)!==void 0?{text:P(e.text)}:e.toolResult!=null?{toolResult:VS(e.toolResult,t)}:e.toolUse!=null?{toolUse:zS(e.toolUse,t)}:e.video!=null?{video:ag(e.video,t)}:{$unknown:Object.entries(e)[0]},ES=(e,t)=>e.citation!=null?{citation:C(e.citation)}:e.reasoningContent!=null?{reasoningContent:GS($e(e.reasoningContent),t)}:P(e.text)!==void 0?{text:P(e.text)}:e.toolUse!=null?{toolUse:C(e.toolUse)}:{$unknown:Object.entries(e)[0]},SS=(e,t)=>D(e,{contentBlockIndex:ls,delta:r=>ES($e(r),t)}),AS=(e,t)=>(e||[]).filter(n=>n!=null).map(n=>_S($e(n),t)),kS=(e,t)=>e.message!=null?{message:HS(e.message,t)}:{$unknown:Object.entries(e)[0]},TS=(e,t)=>D(e,{metrics:C,performanceConfig:C,trace:r=>IS(r,t),usage:C}),IS=(e,t)=>D(e,{guardrail:r=>og(r,t),promptRouter:C}),CS=(e,t)=>D(e,{guardrail:r=>og(r,t),promptRouter:C}),rg=(e,t)=>D(e,{citations:C,context:P,format:P,name:P,source:r=>RS($e(r),t)}),RS=(e,t)=>e.bytes!=null?{bytes:t.base64Decoder(e.bytes)}:e.content!=null?{content:C(e.content)}:e.s3Location!=null?{s3Location:C(e.s3Location)}:P(e.text)!==void 0?{text:P(e.text)}:{$unknown:Object.entries(e)[0]},ng=(e,t)=>D(e,{contentPolicy:C,contextualGroundingPolicy:r=>BS(r,t),invocationMetrics:C,sensitiveInformationPolicy:C,topicPolicy:C,wordPolicy:C}),OS=(e,t)=>(e||[]).filter(n=>n!=null).map(n=>ng(n,t)),PS=(e,t)=>Object.entries(e).reduce((r,[n,o])=>(o===null||(r[n]=OS(o,t)),r),{}),NS=(e,t)=>Object.entries(e).reduce((r,[n,o])=>(o===null||(r[n]=ng(o,t)),r),{}),MS=(e,t)=>D(e,{action:P,detected:bp,score:_i,threshold:_i,type:P}),DS=(e,t)=>(e||[]).filter(n=>n!=null).map(n=>MS(n,t)),BS=(e,t)=>D(e,{filters:r=>DS(r,t)}),$S=(e,t)=>e.image!=null?{image:US(e.image,t)}:e.text!=null?{text:C(e.text)}:{$unknown:Object.entries(e)[0]},US=(e,t)=>D(e,{format:P,source:r=>LS($e(r),t)}),LS=(e,t)=>e.bytes!=null?{bytes:t.base64Decoder(e.bytes)}:{$unknown:Object.entries(e)[0]},og=(e,t)=>D(e,{actionReason:P,inputAssessment:r=>NS(r,t),modelOutput:C,outputAssessments:r=>PS(r,t)}),sg=(e,t)=>D(e,{format:P,source:r=>FS($e(r),t)}),FS=(e,t)=>e.bytes!=null?{bytes:t.base64Decoder(e.bytes)}:e.s3Location!=null?{s3Location:C(e.s3Location)}:{$unknown:Object.entries(e)[0]},HS=(e,t)=>D(e,{content:r=>AS(r,t),role:P}),jS=(e,t)=>D(e,{additionalModelResponseFields:r=>da(r,t),stopReason:P});var KS=(e,t)=>e.reasoningText!=null?{reasoningText:C(e.reasoningText)}:e.redactedContent!=null?{redactedContent:t.base64Decoder(e.redactedContent)}:{$unknown:Object.entries(e)[0]},GS=(e,t)=>e.redactedContent!=null?{redactedContent:t.base64Decoder(e.redactedContent)}:P(e.signature)!==void 0?{signature:P(e.signature)}:P(e.text)!==void 0?{text:P(e.text)}:{$unknown:Object.entries(e)[0]},VS=(e,t)=>D(e,{content:r=>JS(r,t),status:P,toolUseId:P}),qS=(e,t)=>e.document!=null?{document:rg(e.document,t)}:e.image!=null?{image:sg(e.image,t)}:e.json!=null?{json:da(e.json,t)}:P(e.text)!==void 0?{text:P(e.text)}:e.video!=null?{video:ag(e.video,t)}:{$unknown:Object.entries(e)[0]},JS=(e,t)=>(e||[]).filter(n=>n!=null).map(n=>qS($e(n),t)),zS=(e,t)=>D(e,{input:r=>da(r,t),name:P,toolUseId:P}),ag=(e,t)=>D(e,{format:P,source:r=>WS($e(r),t)}),WS=(e,t)=>e.bytes!=null?{bytes:t.base64Decoder(e.bytes)}:e.s3Location!=null?{s3Location:C(e.s3Location)}:{$unknown:Object.entries(e)[0]},da=(e,t)=>e,be=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]});var Bh="accept",ig="contentType",cg="content-type",YS="guardrailIdentifier",QS="guardrailVersion";var lg="performanceConfigLatency";var XS="trace";var ZS="x-amzn-bedrock-guardrailidentifier",eA="x-amzn-bedrock-guardrailversion",ug="x-amzn-bedrock-performanceconfig-latency",tA="x-amzn-bedrock-trace";var pa=class extends xt.classBuilder().ep(tn).m(function(t,r,n,o){return[Kr(n,this.serialize,this.deserialize),Xr(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","Converse",{}).n("BedrockRuntimeClient","ConverseCommand").f(Rh,Oh).ser($h).de(Fh).build(){};var fa=class extends xt.classBuilder().ep(tn).m(function(t,r,n,o){return[Kr(n,this.serialize,this.deserialize),Xr(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","ConverseStream",{eventStream:{output:!0}}).n("BedrockRuntimeClient","ConverseStreamCommand").f(Ph,Nh).ser(Uh).de(Hh).build(){};var ma=class extends xt.classBuilder().ep(tn).m(function(t,r,n,o){return[Kr(n,this.serialize,this.deserialize),Xr(n,t.getEndpointParameterInstructions())]}).s("AmazonBedrockFrontendService","InvokeModel",{}).n("BedrockRuntimeClient","InvokeModelCommand").f(Mh,Dh).ser(Lh).de(jh).build(){};function rA(e){var t;let r=(t=e.tools)!=null&&t.length?e.tools:void 0;if(r==null)return{toolConfig:{tools:void 0,toolChoice:void 0},toolWarnings:[]};let n=[],o=[];for(let a of r)a.type==="provider-defined"?n.push({type:"unsupported-tool",tool:a}):o.push({toolSpec:{name:a.name,description:a.description,inputSchema:{json:a.parameters}}});let s=e.toolChoice;if(s==null)return{toolConfig:{tools:o,toolChoice:void 0},toolWarnings:n};let i=s.type;switch(i){case"auto":return{toolConfig:{tools:o,toolChoice:{auto:{}}},toolWarnings:n};case"required":return{toolConfig:{tools:o,toolChoice:{any:{}}},toolWarnings:n};case"none":return{toolConfig:{tools:void 0,toolChoice:void 0},toolWarnings:n};case"tool":return{toolConfig:{tools:o,toolChoice:{tool:{name:s.toolName}}},toolWarnings:n};default:{let a=i;throw new Rt({functionality:`Unsupported tool choice type: ${a}`})}}}var nA=di({prefix:"file",size:16});function oA(e){var t,r,n,o,s;let i=sA(e),a,c=[];for(let l=0;l<i.length;l++){let f=i[l],p=l===i.length-1,d=f.type;switch(d){case"system":{if(c.length>0)throw new Rt({functionality:"Multiple system messages that are separated by user/assistant messages"});a=f.messages.map(({content:m})=>m).join(`
`);break}case"user":{let m=[];for(let h of f.messages){let{role:y,content:g}=h;switch(y){case"user":{for(let v=0;v<g.length;v++){let b=g[v];switch(b.type){case"text":{m.push({text:b.text});break}case"image":{if(b.image instanceof URL)throw new Rt({functionality:"Image URLs in user messages"});m.push({image:{format:(r=(t=b.mimeType)==null?void 0:t.split("/"))==null?void 0:r[1],source:{bytes:(n=b.image)!=null?n:b.image}}});break}case"file":{if(b.data instanceof URL)throw new Rt({functionality:"File URLs in user messages"});m.push({document:{format:(s=(o=b.mimeType)==null?void 0:o.split("/"))==null?void 0:s[1],name:nA(),source:{bytes:Buffer.from(b.data,"base64")}}});break}}}break}case"tool":{for(let v=0;v<g.length;v++){let b=g[v];m.push({toolResult:{toolUseId:b.toolCallId,content:[{text:JSON.stringify(b.result)}]}})}break}default:{let v=y;throw new Error(`Unsupported role: ${v}`)}}}c.push({role:"user",content:m});break}case"assistant":{let m=[];for(let h=0;h<f.messages.length;h++){let y=f.messages[h],g=h===f.messages.length-1,{content:v}=y;for(let b=0;b<v.length;b++){let w=v[b],S=b===v.length-1;switch(w.type){case"text":{m.push({text:p&&g&&S?w.text.trim():w.text});break}case"tool-call":{m.push({toolUse:{toolUseId:w.toolCallId,name:w.toolName,input:w.args}});break}}}}c.push({role:"assistant",content:m});break}default:{let m=d;throw new Error(`Unsupported type: ${m}`)}}}return{system:a,messages:c}}function sA(e){let t=[],r;for(let n of e){let{role:o}=n;switch(o){case"system":{r?.type!=="system"&&(r={type:"system",messages:[]},t.push(r)),r.messages.push(n);break}case"assistant":{r?.type!=="assistant"&&(r={type:"assistant",messages:[]},t.push(r)),r.messages.push(n);break}case"user":{r?.type!=="user"&&(r={type:"user",messages:[]},t.push(r)),r.messages.push(n);break}case"tool":{r?.type!=="user"&&(r={type:"user",messages:[]},t.push(r)),r.messages.push(n);break}default:{let s=o;throw new Error(`Unsupported role: ${s}`)}}}return t}function dg(e){switch(e){case"stop_sequence":case"end_turn":return"stop";case"max_tokens":return"length";case"content_filtered":case"guardrail_intervened":return"content-filter";case"tool_use":return"tool-calls";default:return"unknown"}}var aA=class{constructor(e,t,r){this.specificationVersion="v1",this.provider="amazon-bedrock",this.defaultObjectGenerationMode="tool",this.supportsImageUrls=!1,this.modelId=e,this.settings=t,this.config=r}getArgs({mode:e,prompt:t,maxTokens:r,temperature:n,topP:o,topK:s,frequencyPenalty:i,presencePenalty:a,stopSequences:c,responseFormat:l,seed:f,providerMetadata:p,headers:d}){var m,h;let y=e.type,g=[];i!=null&&g.push({type:"unsupported-setting",setting:"frequencyPenalty"}),a!=null&&g.push({type:"unsupported-setting",setting:"presencePenalty"}),f!=null&&g.push({type:"unsupported-setting",setting:"seed"}),d!=null&&g.push({type:"unsupported-setting",setting:"headers"}),s!=null&&g.push({type:"unsupported-setting",setting:"topK"}),l!=null&&l.type!=="text"&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{system:v,messages:b}=oA(t),w={modelId:this.modelId,system:v?[{text:v}]:void 0,additionalModelRequestFields:this.settings.additionalModelRequestFields,inferenceConfig:{maxTokens:r,temperature:n,topP:o,stopSequences:c},messages:b,guardrailConfig:(m=p?.bedrock)==null?void 0:m.guardrailConfig};switch(y){case"regular":{let{toolConfig:S,toolWarnings:T}=rA(e);return{command:{...w,...(h=S.tools)!=null&&h.length?{toolConfig:S}:{}},warnings:[...g,...T]}}case"object-json":throw new Rt({functionality:"json-mode object generation"});case"object-tool":return{command:{...w,toolConfig:{tools:[{toolSpec:{name:e.tool.name,description:e.tool.description,inputSchema:{json:e.tool.parameters}}}],toolChoice:{tool:{name:e.tool.name}}}},warnings:g};default:{let S=y;throw new Error(`Unsupported type: ${S}`)}}}async doGenerate(e){var t,r,n,o,s,i,a,c,l,f,p,d;let{command:m,warnings:h}=this.getArgs(e),y=await this.config.client.send(new pa(m)),{messages:g,...v}=m,b=y.trace?{bedrock:{trace:y.trace}}:void 0;return{text:(o=(n=(r=(t=y.output)==null?void 0:t.message)==null?void 0:r.content)==null?void 0:n.map(w=>{var S;return(S=w.text)!=null?S:""}).join(""))!=null?o:void 0,toolCalls:(c=(a=(i=(s=y.output)==null?void 0:s.message)==null?void 0:i.content)==null?void 0:a.filter(w=>!!w.toolUse))==null?void 0:c.map(w=>{var S,T,U,I,G,F;return{toolCallType:"function",toolCallId:(T=(S=w.toolUse)==null?void 0:S.toolUseId)!=null?T:this.config.generateId(),toolName:(I=(U=w.toolUse)==null?void 0:U.name)!=null?I:`tool-${this.config.generateId()}`,args:JSON.stringify((F=(G=w.toolUse)==null?void 0:G.input)!=null?F:"")}}),finishReason:dg(y.stopReason),usage:{promptTokens:(f=(l=y.usage)==null?void 0:l.inputTokens)!=null?f:Number.NaN,completionTokens:(d=(p=y.usage)==null?void 0:p.outputTokens)!=null?d:Number.NaN},rawCall:{rawPrompt:g,rawSettings:v},warnings:h,providerMetadata:b}}async doStream(e){let{command:t,warnings:r}=this.getArgs(e),n=await this.config.client.send(new fa(t)),{messages:o,...s}=t,i="unknown",a={promptTokens:Number.NaN,completionTokens:Number.NaN},c;if(!n.stream)throw new Error("No stream found");let l=new ReadableStream({async start(p){for await(let d of n.stream)p.enqueue({success:!0,value:d});p.close()}}),f={};return{stream:l.pipeThrough(new TransformStream({transform(p,d){var m,h,y,g,v,b,w,S,T;function U(J){i="error",d.enqueue({type:"error",error:J})}if(!p.success){U(p.error);return}let I=p.value;if(I.internalServerException){U(I.internalServerException);return}if(I.modelStreamErrorException){U(I.modelStreamErrorException);return}if(I.throttlingException){U(I.throttlingException);return}if(I.validationException){U(I.validationException);return}I.messageStop&&(i=dg(I.messageStop.stopReason)),I.metadata&&(a={promptTokens:(h=(m=I.metadata.usage)==null?void 0:m.inputTokens)!=null?h:Number.NaN,completionTokens:(g=(y=I.metadata.usage)==null?void 0:y.outputTokens)!=null?g:Number.NaN},I.metadata.trace&&(c={bedrock:{trace:I.metadata.trace}})),(b=(v=I.contentBlockDelta)==null?void 0:v.delta)!=null&&b.text&&d.enqueue({type:"text-delta",textDelta:I.contentBlockDelta.delta.text});let G=I.contentBlockStart;if(((w=G?.start)==null?void 0:w.toolUse)!=null){let J=G.start.toolUse;f[G.contentBlockIndex]={toolCallId:J.toolUseId,toolName:J.name,jsonText:""}}let F=I.contentBlockDelta;if((S=F?.delta)!=null&&S.toolUse){let J=f[F.contentBlockIndex],ee=(T=F.delta.toolUse.input)!=null?T:"";d.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:J.toolCallId,toolName:J.toolName,argsTextDelta:ee}),J.jsonText+=ee}let q=I.contentBlockStop;if(q!=null){let J=q.contentBlockIndex,ee=f[J];ee!=null&&(d.enqueue({type:"tool-call",toolCallType:"function",toolCallId:ee.toolCallId,toolName:ee.toolName,args:ee.jsonText}),delete f[J])}},flush(p){p.enqueue({type:"finish",finishReason:i,usage:a,providerMetadata:c})}})),rawCall:{rawPrompt:o,rawSettings:s},warnings:r}}},iA=class{constructor(e,t,r){this.specificationVersion="v1",this.provider="amazon-bedrock",this.maxEmbeddingsPerCall=void 0,this.supportsParallelCalls=!0,this.modelId=e,this.config=r,this.settings=t}async doEmbed({values:e}){let t=async o=>{let s={inputText:o,dimensions:this.settings.dimensions,normalize:this.settings.normalize},i=new ma({contentType:"application/json",body:JSON.stringify(s),modelId:this.modelId}),a=await this.config.client.send(i);return JSON.parse(new TextDecoder().decode(a.body))};return(await Promise.all(e.map(t))).reduce((o,s)=>(o.embeddings.push(s.embedding),o.usage.tokens+=s.inputTextTokenCount,o),{embeddings:[],usage:{tokens:0}})}};function mc(e={}){let t=()=>{var s;return new Zs((s=e.bedrockOptions)!=null?s:{region:ss({settingValue:e.region,settingName:"region",environmentVariableName:"AWS_REGION",description:"AWS region"}),credentials:{accessKeyId:ss({settingValue:e.accessKeyId,settingName:"accessKeyId",environmentVariableName:"AWS_ACCESS_KEY_ID",description:"AWS access key ID"}),secretAccessKey:ss({settingValue:e.secretAccessKey,settingName:"secretAccessKey",environmentVariableName:"AWS_SECRET_ACCESS_KEY",description:"AWS secret access key"}),sessionToken:Yd({settingValue:e.sessionToken,environmentVariableName:"AWS_SESSION_TOKEN"})}})},r=(s,i={})=>new aA(s,i,{client:t(),generateId:Wd}),n=function(s,i){if(new.target)throw new Error("The Amazon Bedrock model function cannot be called with the new keyword.");return r(s,i)},o=(s,i={})=>new iA(s,i,{client:t()});return n.languageModel=r,n.embedding=o,n.textEmbedding=o,n.textEmbeddingModel=o,n}var KK=mc();var wo=class extends M{name="AmazonBedrock";getApiKeyLink="https://console.aws.amazon.com/iam/home";config={apiTokenKey:"AWS_BEDROCK_CONFIG"};staticModels=[{name:"anthropic.claude-3-5-sonnet-20241022-v2:0",label:"Claude 3.5 Sonnet v2 (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:2e5},{name:"anthropic.claude-3-5-sonnet-20240620-v1:0",label:"Claude 3.5 Sonnet (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:4096},{name:"anthropic.claude-3-sonnet-20240229-v1:0",label:"Claude 3 Sonnet (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:4096},{name:"anthropic.claude-3-haiku-20240307-v1:0",label:"Claude 3 Haiku (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:4096},{name:"amazon.nova-pro-v1:0",label:"Amazon Nova Pro (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:5120},{name:"amazon.nova-lite-v1:0",label:"Amazon Nova Lite (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:5120},{name:"mistral.mistral-large-2402-v1:0",label:"Mistral Large 24.02 (Bedrock)",provider:"AmazonBedrock",maxTokenAllowed:8192}];_parseAndValidateConfig(t){let r;try{r=JSON.parse(t)}catch{throw new Error("Invalid AWS Bedrock configuration format. Please provide a valid JSON string containing region, accessKeyId, and secretAccessKey.")}let{region:n,accessKeyId:o,secretAccessKey:s,sessionToken:i}=r;if(!n||!o||!s)throw new Error("Missing required AWS credentials. Configuration must include region, accessKeyId, and secretAccessKey.");return{region:n,accessKeyId:o,secretAccessKey:s,...i&&{sessionToken:i}}}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"AWS_BEDROCK_CONFIG"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);let a=this._parseAndValidateConfig(i);return mc(a)(r)}};var _o=class extends M{name="Github";getApiKeyLink="https://github.com/settings/personal-access-tokens";config={apiTokenKey:"GITHUB_API_KEY"};staticModels=[{name:"openai/gpt-4o",label:"GPT-4o",provider:"Github",maxTokenAllowed:131072,maxCompletionTokens:4096},{name:"openai/gpt-4o-mini",label:"GPT-4o Mini",provider:"Github",maxTokenAllowed:131072,maxCompletionTokens:4096},{name:"openai/o1-preview",label:"o1-preview",provider:"Github",maxTokenAllowed:128e3,maxCompletionTokens:32e3},{name:"openai/o1-mini",label:"o1-mini",provider:"Github",maxTokenAllowed:128e3,maxCompletionTokens:65e3},{name:"openai/o1",label:"o1",provider:"Github",maxTokenAllowed:2e5,maxCompletionTokens:1e5},{name:"openai/gpt-4.1",label:"GPT-4.1",provider:"Github",maxTokenAllowed:1048576,maxCompletionTokens:32768},{name:"openai/gpt-4.1-mini",label:"GPT-4.1-mini",provider:"Github",maxTokenAllowed:1048576,maxCompletionTokens:32768},{name:"deepseek/deepseek-r1",label:"DeepSeek-R1",provider:"Github",maxTokenAllowed:128e3,maxCompletionTokens:4096}];async getDynamicModels(t,r,n){let{apiKey:o}=this.getProviderBaseUrlAndKey({apiKeys:t,providerSettings:r,serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"GITHUB_API_KEY"});if(!o)return console.log("GitHub: No API key found. Make sure GITHUB_API_KEY is set in your .env.local file"),this.staticModels;console.log("GitHub: API key found, attempting to fetch dynamic models...");try{let s=await fetch("https://models.github.ai/v1/models",{headers:{Authorization:`Bearer ${o}`}});if(s.ok){let i=await s.json();if(console.log("GitHub: Successfully fetched models from API"),i.data&&Array.isArray(i.data))return i.data.map(a=>({name:a.id,label:a.name||a.id.split("/").pop()||a.id,provider:"Github",maxTokenAllowed:a.limits?.max_input_tokens||128e3,maxCompletionTokens:a.limits?.max_output_tokens||16384}))}else console.warn("GitHub: API request failed with status:",s.status,s.statusText)}catch(s){console.warn("GitHub: Failed to fetch models, using static models:",s)}return console.log("GitHub: Using static models as fallback"),this.staticModels}getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t;console.log(`GitHub: Creating model instance for ${r}`);let{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"GITHUB_API_KEY"});if(!i)throw console.error("GitHub: No API key found"),new Error(`Missing API key for ${this.name} provider`);console.log(`GitHub: Using API key (first 8 chars): ${i.substring(0,8)}...`);let a=X({baseURL:"https://models.github.ai/inference",apiKey:i});return console.log(`GitHub: Created OpenAI client, requesting model: ${r}`),a(r)}};var Eo=class extends M{name="Moonshot";getApiKeyLink="https://platform.moonshot.ai/console/api-keys";config={apiTokenKey:"MOONSHOT_API_KEY"};staticModels=[{name:"moonshot-v1-8k",label:"Moonshot v1 8K",provider:"Moonshot",maxTokenAllowed:8e3},{name:"moonshot-v1-32k",label:"Moonshot v1 32K",provider:"Moonshot",maxTokenAllowed:32e3},{name:"moonshot-v1-128k",label:"Moonshot v1 128K",provider:"Moonshot",maxTokenAllowed:128e3},{name:"moonshot-v1-auto",label:"Moonshot v1 Auto",provider:"Moonshot",maxTokenAllowed:128e3},{name:"moonshot-v1-8k-vision-preview",label:"Moonshot v1 8K Vision",provider:"Moonshot",maxTokenAllowed:8e3},{name:"moonshot-v1-32k-vision-preview",label:"Moonshot v1 32K Vision",provider:"Moonshot",maxTokenAllowed:32e3},{name:"moonshot-v1-128k-vision-preview",label:"Moonshot v1 128K Vision",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-latest",label:"Kimi Latest",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-k2-0711-preview",label:"Kimi K2 Preview",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-k2-turbo-preview",label:"Kimi K2 Turbo",provider:"Moonshot",maxTokenAllowed:128e3},{name:"kimi-thinking-preview",label:"Kimi Thinking",provider:"Moonshot",maxTokenAllowed:128e3}];getModelInstance(t){let{model:r,serverEnv:n,apiKeys:o,providerSettings:s}=t,{apiKey:i}=this.getProviderBaseUrlAndKey({apiKeys:o,providerSettings:s?.[this.name],serverEnv:n,defaultBaseUrlKey:"",defaultApiTokenKey:"MOONSHOT_API_KEY"});if(!i)throw new Error(`Missing API key for ${this.name} provider`);return X({baseURL:"https://api.moonshot.ai/v1",apiKey:i})(r)}};var it=vc("LLMManager"),vn=class{_providers=new Map;_modelList=[];_env={};constructor(t){this._registerProvidersFromDirectory(),this._env=t}static getInstance(t={}){return vn._instance||(vn._instance=new vn(t)),vn._instance}get env(){return this._env}async _registerProvidersFromDirectory(){try{for(let t of Object.values(hc))if(typeof t=="function"&&t.prototype instanceof M){let r=new t;try{this.registerProvider(r)}catch(n){it.warn("Failed To Register Provider: ",r.name,"error:",n.message)}}}catch(t){it.error("Error registering providers:",t)}}registerProvider(t){if(this._providers.has(t.name)){it.warn(`Provider ${t.name} is already registered. Skipping.`);return}it.info("Registering Provider: ",t.name),this._providers.set(t.name,t),this._modelList=[...this._modelList,...t.staticModels]}getProvider(t){return this._providers.get(t)}getAllProviders(){return Array.from(this._providers.values())}getModelList(){return this._modelList}async updateModelList(t){let{apiKeys:r,providerSettings:n,serverEnv:o}=t,s=Array.from(this._providers.values()).map(d=>d.name);n&&Object.keys(n).length>0&&(s=s.filter(d=>n[d].enabled));let i=await Promise.all(Array.from(this._providers.values()).filter(d=>s.includes(d.name)).filter(d=>!!d.getDynamicModels).map(async d=>{let m=d.getModelsFromCache(t);return m||await d.getDynamicModels(r,n?.[d.name],o).then(y=>(it.info(`Caching ${y.length} dynamic models for ${d.name}`),d.storeDynamicModels(t,y),y)).catch(y=>(it.error(`Error getting dynamic models ${d.name} :`,y),[]))})),a=Array.from(this._providers.values()).flatMap(d=>d.staticModels||[]),c=i.flat(),l=c.map(d=>`${d.name}-${d.provider}`),f=a.filter(d=>!l.includes(`${d.name}-${d.provider}`)),p=[...c,...f];return p.sort((d,m)=>d.name.localeCompare(m.name)),this._modelList=p,p}getStaticModelList(){return[...this._providers.values()].flatMap(t=>t.staticModels||[])}async getModelListFromProvider(t,r){let n=this._providers.get(t.name);if(!n)throw new Error(`Provider ${t.name} not found`);let o=n.staticModels||[];if(!n.getDynamicModels)return o;let{apiKeys:s,providerSettings:i,serverEnv:a}=r,c=n.getModelsFromCache({apiKeys:s,providerSettings:i,serverEnv:a});if(c)return it.info(`Found ${c.length} cached models for ${n.name}`),[...c,...o];it.info(`Getting dynamic models for ${n.name}`);let l=await n.getDynamicModels?.(s,i?.[n.name],a).then(m=>(it.info(`Got ${m.length} dynamic models for ${n.name}`),n.storeDynamicModels(r,m),m)).catch(m=>(it.error(`Error getting dynamic models ${n.name} :`,m),[])),f=l.map(m=>m.name),p=o.filter(m=>!f.includes(m.name)),d=[...l,...p];return d.sort((m,h)=>m.name.localeCompare(h.name)),d}getStaticModelListFromProvider(t){let r=this._providers.get(t.name);if(!r)throw new Error(`Provider ${t.name} not found`);return[...r.staticModels||[]]}getDefaultProvider(){let t=this._providers.values().next().value;if(!t)throw new Error("No providers registered");return t}},rr=vn;yc(rr,"_instance");var cA="project",kG=`/home/${cA}`,TG="bolt_file_modifications",IG=/^\[Model: (.*?)\]\n\n/,CG=/\[Provider: (.*?)\]\n\n/,RG="claude-3-5-sonnet-latest",OG="cachedPrompt",PG={APPROVE:"Yes, approved.",REJECT:"No, rejected."},NG="Error: No execute function found on tool",MG="Error: User denied access to tool execution",DG="Error: An error occured while calling tool",pg=rr.getInstance(import.meta.env),lA=pg.getAllProviders(),BG=pg.getDefaultProvider(),uA={};lA.forEach(e=>{uA[e.name]={baseUrlKey:e.config.baseUrlKey,apiTokenKey:e.config.apiTokenKey}});var $G=[{name:"Expo App",label:"Expo App",description:"Expo starter template for building cross-platform mobile apps",githubRepo:"xKevIsDev/bolt-expo-template",tags:["mobile","expo","mobile-app","android","iphone"],icon:"i-bolt:expo"},{name:"Basic Astro",label:"Astro Basic",description:"Lightweight Astro starter template for building fast static websites",githubRepo:"xKevIsDev/bolt-astro-basic-template",tags:["astro","blog","performance"],icon:"i-bolt:astro"},{name:"NextJS Shadcn",label:"Next.js with shadcn/ui",description:"Next.js starter fullstack template integrated with shadcn/ui components and styling system",githubRepo:"xKevIsDev/bolt-nextjs-shadcn-template",tags:["nextjs","react","typescript","shadcn","tailwind"],icon:"i-bolt:nextjs"},{name:"Vite Shadcn",label:"Vite with shadcn/ui",description:"Vite starter fullstack template integrated with shadcn/ui components and styling system",githubRepo:"xKevIsDev/vite-shadcn",tags:["vite","react","typescript","shadcn","tailwind"],icon:"i-bolt:shadcn"},{name:"Qwik Typescript",label:"Qwik TypeScript",description:"Qwik framework starter with TypeScript for building resumable applications",githubRepo:"xKevIsDev/bolt-qwik-ts-template",tags:["qwik","typescript","performance","resumable"],icon:"i-bolt:qwik"},{name:"Remix Typescript",label:"Remix TypeScript",description:"Remix framework starter with TypeScript for full-stack web applications",githubRepo:"xKevIsDev/bolt-remix-ts-template",tags:["remix","typescript","fullstack","react"],icon:"i-bolt:remix"},{name:"Slidev",label:"Slidev Presentation",description:"Slidev starter template for creating developer-friendly presentations using Markdown",githubRepo:"xKevIsDev/bolt-slidev-template",tags:["slidev","presentation","markdown"],icon:"i-bolt:slidev"},{name:"Sveltekit",label:"SvelteKit",description:"SvelteKit starter template for building fast, efficient web applications",githubRepo:"bolt-sveltekit-template",tags:["svelte","sveltekit","typescript"],icon:"i-bolt:svelte"},{name:"Vanilla Vite",label:"Vanilla + Vite",description:"Minimal Vite starter template for vanilla JavaScript projects",githubRepo:"xKevIsDev/vanilla-vite-template",tags:["vite","vanilla-js","minimal"],icon:"i-bolt:vite"},{name:"Vite React",label:"React + Vite + typescript",description:"React starter template powered by Vite for fast development experience",githubRepo:"xKevIsDev/bolt-vite-react-ts-template",tags:["react","vite","frontend","website","app"],icon:"i-bolt:react"},{name:"Vite Typescript",label:"Vite + TypeScript",description:"Vite starter template with TypeScript configuration for type-safe development",githubRepo:"xKevIsDev/bolt-vite-ts-template",tags:["vite","typescript","minimal"],icon:"i-bolt:typescript"},{name:"Vue",label:"Vue.js",description:"Vue.js starter template with modern tooling and best practices",githubRepo:"xKevIsDev/bolt-vue-template",tags:["vue","typescript","frontend"],icon:"i-bolt:vue"},{name:"Angular",label:"Angular Starter",description:"A modern Angular starter template with TypeScript support and best practices configuration",githubRepo:"xKevIsDev/bolt-angular-template",tags:["angular","typescript","frontend","spa"],icon:"i-bolt:angular"},{name:"SolidJS",label:"SolidJS Tailwind",description:"Lightweight SolidJS starter template for building fast static websites",githubRepo:"xKevIsDev/solidjs-ts-tw",tags:["solidjs"],icon:"i-bolt:solidjs"}];export{hr as a,Ht as b,O as c,u as d,jf as e,I2 as f,C2 as g,cA as h,kG as i,TG as j,IG as k,CG as l,RG as m,OG as n,PG as o,NG as p,MG as q,DG as r,lA as s,BG as t,uA as u,$G as v};
